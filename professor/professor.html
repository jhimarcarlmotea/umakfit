<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UmakFit - Professor Dashboard</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.2/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Manrope:600,800|Inter:300,500,400,700" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * { -webkit-font-smoothing: antialiased; box-sizing: border-box; }
        body { font-family: 'Inter', Helvetica, sans-serif; margin: 0; padding: 0; background-color: #f8fafc; }
        
        .header-top { 
            background-color: #ffffff; 
            padding: 15px 0; 
            box-shadow: 0 2px 10px rgba(0,0,0,0.08); 
            position: fixed; 
            top: 0; 
            width: 100%; 
            z-index: 1000; 
            border-bottom: 1px solid #e2e8f0;
        }
        .header-top .container { 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
        }
        .logo-text { 
            font-family: "Inter", Helvetica; 
            font-weight: 700; 
            color: #1e3a8a; 
            font-size: 24px; 
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .logo-text i {
            color: #f59e0b;
            font-size: 26px;
        }
        .header-actions { 
            display: flex; 
            align-items: center; 
            gap: 15px; 
        }
        .logout-btn { 
            padding: 8px 20px; 
            background: linear-gradient(90deg, rgba(251, 191, 36, 1) 0%, rgba(245, 158, 11, 1) 100%); 
            border: none; 
            border-radius: 8px; 
            color: #000; 
            font-weight: 600; 
            font-size: 14px; 
            cursor: pointer; 
            transition: all 0.3s; 
            box-shadow: 0 2px 4px rgba(245, 158, 11, 0.3);
        }
        .logout-btn:hover { 
            transform: translateY(-2px); 
            box-shadow: 0 4px 8px rgba(245, 158, 11, 0.4); 
        }
        .account-circle { 
            width: 44px; 
            height: 44px; 
            cursor: pointer; 
            border-radius: 50%;
            border: 2px solid #e2e8f0;
            transition: all 0.3s;
        }
        .account-circle:hover {
            border-color: #f59e0b;
        }
        
        .nav-section { 
            background: linear-gradient(180deg, rgba(30, 58, 138, 1) 0%, rgba(59, 130, 246, 1) 100%); 
            padding: 20px 0; 
            margin-top: 74px; 
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .nav-container {
            display: flex;
            align-items: center;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 20px;
        }
        .nav-brand { 
            display: flex;
            align-items: center;
            gap: 15px;
            font-family: "Manrope", Helvetica; 
            font-weight: 800; 
            font-size: 28px; 
            background: linear-gradient(90deg, rgba(245, 158, 11, 1) 0%, rgba(255, 229, 0, 1) 100%); 
            -webkit-background-clip: text; 
            background-clip: text; 
            -webkit-text-fill-color: transparent;
            margin: 0;
        }
        .nav-brand-logo {
            height: 60px;
            width: auto;
        }
        .nav-pills-custom { 
            display: flex; 
            flex-wrap: wrap; 
            gap: 8px; 
            padding: 0; 
            margin: 0;
        }
        .nav-pills-custom .nav-link { 
            font-family: "Manrope", Helvetica; 
            font-weight: 600; 
            color: #000000; 
            font-size: 14px; 
            padding: 12px 18px;
            border-radius: 8px; 
            background-color: #ffffff; 
            transition: all 0.3s; 
            border: none; 
            display: flex;
            align-items: center;
            gap: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }
        .nav-pills-custom .nav-link.active { 
            background: linear-gradient(90deg, rgba(251, 191, 36, 1) 0%, rgba(245, 158, 11, 1) 100%); 
            box-shadow: 0 4px 8px rgba(245, 158, 11, 0.3);
        }
        .nav-pills-custom .nav-link:hover { 
            transform: translateY(-2px); 
            box-shadow: 0 4px 8px rgba(0,0,0,0.15); 
        }
        
        .main-content { 
            background: linear-gradient(180deg, rgba(248, 250, 252, 1) 0%, rgba(241, 245, 249, 1) 100%); 
            padding: 40px 0 80px 0; 
            min-height: calc(100vh - 200px); 
        }
        
        .profile-section { 
            background: white; 
            border-radius: 16px; 
            padding: 30px; 
            margin-bottom: 40px; 
            box-shadow: 0 4px 12px rgba(0,0,0,0.08); 
            border: 1px solid #e2e8f0;
        }
        .profile-header { 
            display: flex; 
            align-items: center; 
            gap: 20px; 
            margin-bottom: 20px; 
        }
        .profile-logo { 
            width: 77px; 
            height: 90px; 
        }
        .profile-title { 
            font-family: "Inter", Helvetica; 
            font-weight: 700; 
            color: #1e3a8a; 
            font-size: 32px; 
        }
        .profile-divider { 
            width: 100%; 
            height: 2px; 
            background: linear-gradient(90deg, transparent, #e5e7eb, transparent); 
            margin: 20px 0; 
        }
        .profile-content { 
            display: flex; 
            align-items: center; 
            gap: 30px; 
            padding: 25px; 
            background: #f9fafb; 
            border-radius: 12px; 
            border: 1px solid #f1f5f9;
        }
        .profile-photo { 
            width: 60px; 
            height: 60px; 
            border-radius: 50%; 
            object-fit: cover; 
            border: 3px solid #e2e8f0;
        }
        .profile-info { 
            display: flex; 
            gap: 80px; 
            flex: 1; 
            flex-wrap: wrap; 
        }
        .profile-field { 
            flex: 1; 
            min-width: 150px; 
        }
        .profile-label { 
            font-family: "Inter", Helvetica; 
            font-weight: 500; 
            color: #64748b; 
            font-size: 13px; 
            margin-bottom: 5px; 
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        .profile-value { 
            font-family: "Inter", Helvetica; 
            font-weight: 700; 
            color: #1e3a8a; 
            font-size: 16px; 
        }
        .profile-value.email { 
            font-weight: 500; 
            color: #475569; 
        }
        
        .stats-row { 
            margin-bottom: 40px; 
        }
        .stat-card { 
            border-radius: 16px; 
            padding: 25px; 
            color: white; 
            transition: all 0.3s; 
            border: none;
            height: 100%; 
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            position: relative;
            overflow: hidden;
        }
        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 80px;
            height: 80px;
            background: rgba(255,255,255,0.1);
            border-radius: 50%;
            transform: translate(30px, -30px);
        }
        .stat-card:hover { 
            transform: translateY(-5px); 
            box-shadow: 0 8px 20px rgba(0,0,0,0.15); 
        }
        .stat-card.purple { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .stat-card.blue { background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%); }
        .stat-card.green { background: linear-gradient(135deg, #10b981 0%, #059669 100%); }
        .stat-card.orange { background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); }
        .stat-card.red { background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%); }
        .stat-card.cyan { background: linear-gradient(135deg, #06b6d4 0%, #0891b2 100%); }
        .stat-label { 
            font-family: "Inter", Helvetica; 
            font-weight: 600; 
            font-size: 14px; 
            margin-bottom: 10px; 
            opacity: 0.95; 
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .stat-value { 
            font-family: "Inter", Helvetica; 
            font-weight: 800; 
            font-size: 32px; 
        }
        
        .monitoring-container { 
            background: white; 
            border-radius: 16px; 
            padding: 25px; 
            box-shadow: 0 4px 12px rgba(0,0,0,0.08); 
            border: 1px solid #e2e8f0;
        }
        .monitoring-header { 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            margin-bottom: 20px; 
            flex-wrap: wrap; 
        }
        .monitoring-title { 
            font-family: "Inter", Helvetica; 
            font-weight: 700; 
            color: #1f2937; 
            font-size: 22px; 
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .live-indicator { 
            display: flex; 
            align-items: center; 
            gap: 8px; 
            font-family: "Inter", Helvetica; 
            font-weight: 600; 
            color: #10b981; 
            font-size: 14px; 
            background: #ecfdf5;
            padding: 6px 12px;
            border-radius: 20px;
            border: 1px solid #d1fae5;
        }
        .live-dot { 
            width: 8px; 
            height: 8px; 
            background: #10b981; 
            border-radius: 50%; 
            animation: pulse 2s infinite; 
        }
        @keyframes pulse { 
            0%, 100% { opacity: 1; } 
            50% { opacity: 0.5; } 
        }
        
        /* Enhanced Monitoring Grid */
        .monitoring-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        .monitoring-card {
            background: #f8fafc;
            border-radius: 12px;
            padding: 20px;
            border: 1px solid #e2e8f0;
        }
        .monitoring-card-title {
            font-family: "Inter", Helvetica;
            font-weight: 600;
            color: #374151;
            font-size: 16px;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .student-list {
            max-height: 300px;
            overflow-y: auto;
        }
        .student-item {
            display: flex;
            align-items: center;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 8px;
            background: white;
            border: 1px solid #f1f5f9;
            transition: all 0.3s;
        }
        .student-item:hover {
            background: #f8fafc;
            transform: translateX(4px);
        }
        .student-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #e2e8f0;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 12px;
            font-weight: 600;
            color: #64748b;
        }
        .student-info {
            flex: 1;
        }
        .student-name {
            font-weight: 600;
            color: #1e293b;
            margin-bottom: 4px;
        }
        .student-details {
            display: flex;
            gap: 15px;
            font-size: 12px;
            color: #64748b;
        }
        .student-status {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 12px;
            font-weight: 600;
        }
        .status-online {
            color: #10b981;
        }
        .status-offline {
            color: #64748b;
        }
        .status-active {
            color: #3b82f6;
        }
        .status-dot {
            width: 6px;
            height: 6px;
            border-radius: 50%;
        }
        .status-dot.online {
            background: #10b981;
        }
        .status-dot.offline {
            background: #64748b;
        }
        .status-dot.active {
            background: #3b82f6;
        }
        
        .monitoring-table { 
            width: 100%; 
            border-collapse: collapse; 
        }
        .monitoring-table thead { 
            background: #f8fafc; 
        }
        .monitoring-table th { 
            font-family: "Inter", Helvetica; 
            font-weight: 600; 
            color: #64748b; 
            font-size: 12px; 
            text-transform: uppercase; 
            padding: 14px 12px; 
            text-align: left; 
            border-bottom: 2px solid #e2e8f0; 
            letter-spacing: 0.5px;
        }
        .monitoring-table td { 
            font-family: "Inter", Helvetica; 
            font-weight: 500; 
            color: #475569; 
            font-size: 14px; 
            padding: 16px 12px; 
            border-bottom: 1px solid #f1f5f9; 
        }
        .monitoring-table tr:hover {
            background-color: #f8fafc;
        }
        .progress-bar-container { 
            display: flex; 
            align-items: center; 
            gap: 10px; 
        }
        .progress-bar-custom { 
            flex: 1; 
            height: 8px; 
            background: #e2e8f0; 
            border-radius: 4px; 
            overflow: hidden; 
        }
        .progress-fill { 
            height: 100%; 
            background: linear-gradient(90deg, #3b82f6 0%, #2563eb 100%); 
            border-radius: 4px; 
            transition: width 0.3s; 
        }
        .progress-text { 
            font-family: "Inter", Helvetica; 
            font-weight: 600; 
            color: #64748b; 
            font-size: 12px; 
            min-width: 40px; 
        }
        .btn-monitor, .btn-interrupt { 
            padding: 6px 12px; 
            border: none; 
            border-radius: 6px; 
            font-family: "Inter", Helvetica; 
            font-weight: 600; 
            font-size: 12px; 
            cursor: pointer; 
            transition: all 0.3s; 
            display: inline-flex;
            align-items: center;
            gap: 5px;
        }
        .btn-monitor { 
            background: #10b981; 
            color: white; 
        }
        .btn-monitor:hover { 
            background: #059669; 
            transform: translateY(-1px);
            box-shadow: 0 2px 4px rgba(16, 185, 129, 0.3);
        }
        .btn-interrupt { 
            background: #ef4444; 
            color: white; 
        }
        .btn-interrupt:hover { 
            background: #dc2626; 
            transform: translateY(-1px);
            box-shadow: 0 2px 4px rgba(239, 68, 68, 0.3);
        }
        
        .empty-state { 
            padding: 60px 40px; 
            text-align: center; 
        }
        .empty-icon { 
            font-size: 64px; 
            margin-bottom: 20px; 
            opacity: 0.4; 
        }
        .empty-title { 
            font-family: "Inter", Helvetica; 
            font-weight: 700; 
            color: #1f2937; 
            font-size: 20px; 
            margin-bottom: 12px; 
        }
        .empty-text { 
            font-family: "Inter", Helvetica; 
            font-weight: 400; 
            color: #64748b; 
            font-size: 14px; 
            line-height: 1.6; 
            max-width: 600px; 
            margin: 0 auto; 
        }
        
        .footer { 
            background: linear-gradient(180deg, #1e293b 0%, #0f172a 100%); 
            padding: 40px 0; 
            margin-top: 40px; 
        }
        .footer-title { 
            font-family: "Inter", Helvetica; 
            font-weight: 700; 
            color: #f59e0b; 
            font-size: 18px; 
            text-align: center; 
            margin-bottom: 20px; 
        }
        .footer-text { 
            font-family: "Inter", Helvetica; 
            font-weight: 400; 
            color: #cbd5e1; 
            font-size: 13px; 
            line-height: 1.6; 
        }
        
        .loading { 
            position: fixed; 
            top: 0; 
            left: 0; 
            width: 100%; 
            height: 100%; 
            background: rgba(255,255,255,0.95); 
            display: flex; 
            justify-content: center; 
            align-items: center; 
            z-index: 9999; 
            flex-direction: column;
            gap: 20px;
        }
        .loading-text {
            font-family: "Inter", Helvetica;
            font-weight: 500;
            color: #475569;
            font-size: 16px;
        }
        .spinner { 
            border: 4px solid #f1f5f9; 
            border-top: 4px solid #3b82f6; 
            border-radius: 50%; 
            width: 50px; 
            height: 50px; 
            animation: spin 1s linear infinite; 
        }
        @keyframes spin { 
            0% { transform: rotate(0deg); } 
            100% { transform: rotate(360deg); } 
        }
        
        @media (max-width: 992px) {
            .nav-container {
                flex-direction: column;
                align-items: flex-start;
            }
            .nav-pills-custom {
                width: 100%;
                justify-content: center;
            }
        }
        @media (max-width: 768px) {
            .header-top .container { padding: 0 15px; }
            .logo-text { font-size: 20px; }
            .profile-content { flex-direction: column; align-items: flex-start; }
            .profile-info { gap: 20px; }
            .stat-value { font-size: 24px; }
            .monitoring-table { font-size: 12px; }
            .monitoring-table th, .monitoring-table td { padding: 10px 6px; }
            .monitoring-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 15px;
            }
            .nav-pills-custom {
                flex-wrap: nowrap;
                overflow-x: auto;
                padding-bottom: 5px;
            }
            .nav-brand-logo {
                height: 50px;
            }
            .nav-brand {
                font-size: 24px;
            }
            .monitoring-grid {
                grid-template-columns: 1fr;
            }
        }
        .umak-logo {
            height: 40px;
            width: auto;
        }
    </style>
</head>
<body>
    <div id="loadingScreen" class="loading">
        <div class="spinner"></div>
        <div class="loading-text">Loading Dashboard...</div>
    </div>
    
    <div id="dashboardContent" style="display: none;">
        <div class="header-top">
            <div class="container">
                <div class="logo-text">
                    <img class="umak-logo" src="umaklogo.png" alt="University of Makati">
                    University of Makati
                </div>
                <div class="header-actions">
                    <button class="logout-btn" onclick="handleLogout()">
                        <i class="fas fa-sign-out-alt"></i> Logout
                    </button>
                    <img class="account-circle" src="https://c.animaapp.com/tzMzyNnw/img/icon.svg" alt="Account">
                </div>
            </div>
        </div>
        
        <div class="nav-section">
            <div class="container">
                <div class="nav-container">
                    <div class="nav-brand">
                        <img class="nav-brand-logo" src="logo.png" alt="UMakFit">
                        UMakFit
                    </div>
                    <ul class="nav nav-pills-custom">
                        <li class="nav-item">
                            <a class="nav-link active" href="#">
                                <i class="fas fa-tachometer-alt"></i> Dashboard
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="studentmanagement.html">
                                <i class="fas fa-users"></i> Student Management
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="addactivities.html">
                                <i class="fas fa-dumbbell"></i> Add Activities
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="addlesson.html">
                                <i class="fas fa-book-open"></i> Add Lesson
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="monitoringactivities.html">
                                <i class="fas fa-chart-bar"></i> Monitoring Activities
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="grades.html">
                                <i class="fas fa-graduation-cap"></i> Grades
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
        
        <div class="main-content">
            <div class="container">
                <div class="profile-section">
                    <div class="profile-header">
                        <div class="profile-title">Professor Profile</div>
                    </div>
                    <div class="profile-divider"></div>
                    <div class="profile-content">
                        <img class="profile-photo" id="userPhoto" src="https://c.animaapp.com/tzMzyNnw/img/image-13@2x.png" alt="Profile">
                        <div class="profile-info">
                            <div class="profile-field">
                                <div class="profile-label">Name</div>
                                <div class="profile-value" id="userName">Loading...</div>
                            </div>
                            <div class="profile-field">
                                <div class="profile-label">College</div>
                                <div class="profile-value" id="userCollege">College of Human Kinetics</div>
                            </div>
                            <div class="profile-field">
                                <div class="profile-label">Email</div>
                                <div class="profile-value email" id="userEmail">Loading...</div>
                            </div>
                            <div class="profile-field">
                                <div class="profile-label">Assigned Sections</div>
                                <div class="profile-value" id="assignedSections">0</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="row stats-row g-3">
                    <div class="col-12 col-sm-6 col-lg-4 col-xl-2">
                        <div class="stat-card purple">
                            <div class="stat-label">
                                <i class="fas fa-layer-group"></i> My Sections
                            </div>
                            <div class="stat-value" id="statSections">0</div>
                        </div>
                    </div>
                    <div class="col-12 col-sm-6 col-lg-4 col-xl-2">
                        <div class="stat-card blue">
                            <div class="stat-label">
                                <i class="fas fa-user-graduate"></i> My Students
                            </div>
                            <div class="stat-value" id="statStudents">0</div>
                        </div>
                    </div>
                    <div class="col-12 col-sm-6 col-lg-4 col-xl-2">
                        <div class="stat-card green">
                            <div class="stat-label">
                                <i class="fas fa-check-circle"></i> Activities Completed
                            </div>
                            <div class="stat-value" id="statCompleted">0</div>
                        </div>
                    </div>
                    <div class="col-12 col-sm-6 col-lg-4 col-xl-2">
                        <div class="stat-card orange">
                            <div class="stat-label">
                                <i class="fas fa-chart-line"></i> Average Score
                            </div>
                            <div class="stat-value" id="statAverage">0</div>
                        </div>
                    </div>
                    <div class="col-12 col-sm-6 col-lg-4 col-xl-2">
                        <div class="stat-card red">
                            <div class="stat-label">
                                <i class="fas fa-clock"></i> Pending Activities
                            </div>
                            <div class="stat-value" id="statPending">0</div>
                        </div>
                    </div>
                    <div class="col-12 col-sm-6 col-lg-4 col-xl-2">
                        <div class="stat-card cyan">
                            <div class="stat-label">
                                <i class="fas fa-percentage"></i> Completion Rate
                            </div>
                            <div class="stat-value" id="statRate">0%</div>
                        </div>
                    </div>
                </div>
                
                <div class="monitoring-container">
                    <div class="monitoring-header">
                        <div class="monitoring-title">
                            <i class="fas fa-desktop"></i> Real-time Activity Monitoring
                        </div>
                        <div class="live-indicator">
                            <div class="live-dot"></div>
                            <span>Live Updates</span>
                        </div>
                    </div>
                    
                    <!-- Enhanced Monitoring Grid -->
                    <div class="monitoring-grid">
                        <div class="monitoring-card">
                            <div class="monitoring-card-title">
                                <i class="fas fa-user-check" style="color: #10b981;"></i>
                                Active Activity Sessions
                            </div>
                            <div class="student-list" id="activeTestsList">
                                <div class="empty-state">
                                    <div class="empty-icon">ðŸ‘¥</div>
                                    <div class="empty-title">No Active Activities</div>
                                    <div class="empty-text">Students will appear here when they start activities</div>
                                </div>
                            </div>
                        </div>
                        <div class="monitoring-card">
                            <div class="monitoring-card-title">
                                <i class="fas fa-wifi" style="color: #3b82f6;"></i>
                                Students Online Now
                            </div>
                            <div class="student-list" id="onlineStudentsList">
                                <div class="empty-state">
                                    <div class="empty-icon">ðŸ“±</div>
                                    <div class="empty-title">No Students Online</div>
                                    <div class="empty-text">Students will appear here when they log in</div>
                                </div>
                            </div>
                        </div>
                        <div class="monitoring-card">
                            <div class="monitoring-card-title">
                                <i class="fas fa-history" style="color: #f59e0b;"></i>
                                Recent Activity Completions
                            </div>
                            <div class="student-list" id="recentCompletions">
                                <div class="empty-state">
                                    <div class="empty-icon">âœ…</div>
                                    <div class="empty-title">No Recent Activities</div>
                                    <div class="empty-text">Completed activities will appear here</div>
                                </div>
                            </div>
                        </div>
                    </div>
                
                </div>
            </div>
        </div>
        
        <div class="footer">
            <div class="container">
                <div class="footer-title">About CTBL</div>
                <div class="row g-4">
                    <div class="col-12 col-md-4">
                        <div class="footer-text">
                            The Center for Technology Based Learning serves as the learning management system operating hub, 
                            reporting to the university MANCOM officials, with a director on duty who manages and handles the 
                            center's daily operations.
                        </div>
                    </div>
                    <div class="col-12 col-md-4">
                        <div class="footer-text">
                            Working closely with the Office of the President, the Center for Information Technology, and the 
                            Deans and Directors to support the LMS end-users' day-to-day activity.
                        </div>
                    </div>
                    <div class="col-12 col-md-4">
                        <div class="footer-text">
                            The center focuses on implementing new forms of training and determining the validity of data to 
                            support the university's educational objectives.
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.2/js/bootstrap.bundle.min.js"></script>
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getAuth, onAuthStateChanged, signOut } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';
        import { getFirestore, doc, getDoc, collection, query, where, getDocs, onSnapshot, setDoc, updateDoc, orderBy } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';

        const firebaseConfig = {
            apiKey: "AIzaSyAgaLunqEf2gs6dSpF_sz1hV5XQ5Wm52jo",
            authDomain: "umakfit-e3b1d.firebaseapp.com",
            projectId: "umakfit-e3b1d",
            storageBucket: "umakfit-e3b1d.appspot.com",
            messagingSenderId: "276569891504",
            appId: "1:276569891504:web:39b1732b519f4d8b785175"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        let currentProfessor = null;
        let allStudents = [];
        let assignedSections = [];

        onAuthStateChanged(auth, async (user) => {
            const loadingScreen = document.getElementById('loadingScreen');
            const dashboardContent = document.getElementById('dashboardContent');
            
            if (user) {
                try {
                    console.log('=== PROFESSOR AUTHENTICATION ===');
                    console.log('User authenticated:', user.email);
                    console.log('User UID:', user.uid);
                    
                    // Normalize email
                    const userEmail = user.email.toLowerCase();
                    
                    let professorData = null;
                    let userRole = null;
                    
                    // Step 1: Check users collection by UID
                    console.log('Step 1: Checking users collection...');
                    const userRef = doc(db, 'users', user.uid);
                    const userDoc = await getDoc(userRef);
                    
                    if (userDoc.exists()) {
                        const userData = userDoc.data();
                        userRole = userData.role;
                        console.log('âœ“ User found, role:', userRole);
                        
                        // Verify this is a professor account
                        if (userRole !== 'professor' && userRole !== 'professor') {
                            console.error('âŒ Not a professor account, role is:', userRole);
                            alert('This account is not authorized to access the professor dashboard.');
                            await signOut(auth);
                            window.location.href = '/login/index.html';
                            return;
                        }
                        
                        professorData = userData;
                        console.log('âœ“ Professor data loaded from users collection');
                        
                    } else {
                        // Step 2: Try email lookup
                        console.log('Step 2: User not found by UID, checking email lookup...');
                        const emailKey = userEmail.replace(/\./g, '_');
                        const emailLookupRef = doc(db, 'usersByEmail', emailKey);
                        const emailLookupSnap = await getDoc(emailLookupRef);
                        
                        if (emailLookupSnap.exists()) {
                            const emailData = emailLookupSnap.data();
                            userRole = emailData.role;
                            console.log('âœ“ Found via email lookup, role:', userRole);
                            
                            if (userRole !== 'professor' && userRole !== 'professor') {
                                console.error('âŒ Not a professor account');
                                alert('This account is not authorized to access the professor dashboard.');
                                await signOut(auth);
                                window.location.href = '/login/index.html';
                                return;
                            }
                            
                            // Get actual user data
                            if (emailData.uid) {
                                const actualUserRef = doc(db, 'users', emailData.uid);
                                const actualUserSnap = await getDoc(actualUserRef);
                                if (actualUserSnap.exists()) {
                                    professorData = actualUserSnap.data();
                                }
                            }
                        } else {
                            // Step 3: Check professorProfiles as fallback
                            console.log('Step 3: Checking professorProfiles...');
                            const profileRef = doc(db, 'professorProfiles', userEmail);
                            const profileSnap = await getDoc(profileRef);
                            
                            if (profileSnap.exists()) {
                                professorData = profileSnap.data();
                                userRole = 'professor';
                                console.log('âœ“ Found in professorProfiles, auto-setting role to professor');
                                
                                // Create user record with professor role
                                await setDoc(doc(db, 'users', user.uid), {
                                    ...professorData,
                                    role: 'professor',
                                    uid: user.uid,
                                    updatedAt: new Date()
                                }, { merge: true });
                                
                            } else {
                                throw new Error('Professor profile not found. Please contact the administrator.');
                            }
                        }
                    }
                    
                    if (!professorData) {
                        throw new Error('Unable to load professor data.');
                    }
                    
                    // Set current professor
                    currentProfessor = { id: user.uid, ...professorData };
                    console.log('âœ“ Current professor set:', currentProfessor);
                    
                    // Update UI with professor information
                    document.getElementById('userName').textContent = professorData.name || professorData.displayName || 'Professor';
                    document.getElementById('userEmail').textContent = userEmail;
                    
                    // Set College to "College of Human Kinetics" by default
                    document.getElementById('userCollege').textContent = 'College of Human Kinetics';
                    
                    if (professorData.photoURL || user.photoURL) {
                        document.getElementById('userPhoto').src = professorData.photoURL || user.photoURL;
                    }
                    
                    // Load dashboard data
                    console.log('Loading dashboard statistics...');
                    await loadProfessorStatistics(user.uid, professorData);
                    await loadAssignedSections(user.uid);
                    await loadAllStudents();
                    setupRealtimeMonitoring(user.uid);
                    
                    console.log('âœ“ Dashboard loaded successfully');
                    console.log('=== AUTHENTICATION COMPLETE ===');
                    
                    // Show dashboard
                    loadingScreen.style.display = 'none';
                    dashboardContent.style.display = 'block';
                    
                } catch (error) {
                    console.error('=== ERROR IN AUTHENTICATION ===');
                    console.error('Error:', error);
                    console.error('Error message:', error.message);
                    
                    loadingScreen.style.display = 'none';
                    alert(error.message || 'Error loading dashboard. Please try again.');
                    await signOut(auth);
                    window.location.href = '/login/index.html';
                }
            } else {
                console.log('No user authenticated, redirecting to login...');
                window.location.href = '/login/index.html';
            }
        });

        async function loadProfessorStatistics(professorId, userData) {
            try {
                // Load from user data (updated by Head Admin)
                document.getElementById('statCompleted').textContent = userData.activitiesCompleted || 0;
                document.getElementById('statAverage').textContent = userData.averageScore || 0;
                document.getElementById('statPending').textContent = userData.pendingActivities || 0;
                document.getElementById('statRate').textContent = (userData.completionRate || 0) + '%';
                
                // Update total students from user data
                document.getElementById('statStudents').textContent = userData.totalStudents || 0;
                
            } catch (error) {
                console.error('Error loading statistics:', error);
            }
        }

        async function loadAssignedSections(professorId) {
            try {
                // Query sections where this professor is assigned
                const sectionsQuery = query(
                    collection(db, 'sections'), 
                    where('professorId', '==', professorId)
                );
                const sectionsSnapshot = await getDocs(sectionsQuery);
                
                let totalStudents = 0;
                let sectionCount = 0;
                
                sectionsSnapshot.forEach((doc) => {
                    const sectionData = doc.data();
                    sectionCount++;
                    totalStudents += sectionData.studentCount || 0;
                    assignedSections.push({
                        id: doc.id,
                        ...sectionData
                    });
                });
                
                // Update UI with calculated data
                if (sectionCount > 0) {
                    document.getElementById('statSections').textContent = sectionCount;
                    document.getElementById('assignedSections').textContent = sectionCount;
                    document.getElementById('statStudents').textContent = totalStudents;
                }
                
                console.log(`Loaded ${sectionCount} sections with ${totalStudents} total students`);
                
            } catch (error) {
                console.error('Error loading assigned sections:', error);
            }
        }

        async function loadAllStudents() {
            try {
                allStudents = [];
                const studentIds = new Set();
                
                // Load students from all assigned sections
                for (const section of assignedSections) {
                    const studentsQuery = query(
                        collection(db, 'students'),
                        where('section', '==', section.name)
                    );
                    const studentsSnapshot = await getDocs(studentsQuery);
                    
                    studentsSnapshot.forEach((doc) => {
                        const studentData = doc.data();
                        const uniqueId = studentData.email || studentData.umakId || doc.id;
                        
                        if (!studentIds.has(uniqueId)) {
                            studentIds.add(uniqueId);
                            allStudents.push({
                                id: doc.id,
                                ...studentData,
                                section: section.name,
                                uniqueId: uniqueId
                            });
                        }
                    });
                }
                
                console.log('Loaded unique students:', allStudents.length);
                
            } catch (error) {
                console.error('Error loading students:', error);
            }
        }

        function setupRealtimeMonitoring(professorId) {
            try {
                // Set up real-time listener for active tests
                const activeTestsQuery = query(
                    collection(db, 'activeTests'),
                    where('professorId', '==', professorId),
                    where('status', '==', 'active')
                );
                
                onSnapshot(activeTestsQuery, (snapshot) => {
                    updateActiveTestsList(snapshot);
                }, (error) => {
                    console.error('Error setting up real-time monitoring:', error);
                });
                
                // Set up real-time listener for recent completions
                const recentCompletionsQuery = query(
                    collection(db, 'activityResults'),
                    where('professorEmail', '==', currentProfessor.email),
                    orderBy('submittedAt', 'desc')
                );
                
                onSnapshot(recentCompletionsQuery, (snapshot) => {
                    updateRecentCompletions(snapshot);
                });
                
                // Set up real-time listener for online students
                setupOnlineStudentsMonitoring();
                
            } catch (error) {
                console.error('Error in setupRealtimeMonitoring:', error);
            }
        }

        function updateActiveTestsList(snapshot) {
            const container = document.getElementById('activeTestsList');
            
            if (snapshot.empty) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">ðŸ‘¥</div>
                        <div class="empty-title">No Active Activities</div>
                        <div class="empty-text">Students will appear here when they start activities</div>
                    </div>
                `;
                return;
            }
            
            let html = '';
            snapshot.forEach((doc) => {
                const activity = doc.data();
                const progress = activity.progress || 0;
                const studentName = activity.studentName || 'Unknown Student';
                const initials = getInitials(studentName);
                
                html += `
                    <div class="student-item">
                        <div class="student-avatar">${initials}</div>
                        <div class="student-info">
                            <div class="student-name">${studentName}</div>
                            <div class="student-details">
                                <span>${activity.section || 'N/A'}</span>
                                <span>${activity.activityName || 'Unnamed Activity'}</span>
                            </div>
                        </div>
                        <div class="student-status">
                            <div class="status-dot active"></div>
                            <span class="status-active">${progress}%</span>
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }

        function updateRecentCompletions(snapshot) {
            const container = document.getElementById('recentCompletions');
            
            if (snapshot.empty) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">âœ…</div>
                        <div class="empty-title">No Recent Activities</div>
                        <div class="empty-text">Completed activities will appear here</div>
                    </div>
                `;
                return;
            }
            
            let html = '';
            let count = 0;
            snapshot.forEach((doc) => {
                if (count >= 5) return; // Show only 5 most recent
                count++;
                
                const result = doc.data();
                const studentName = result.studentName || 'Unknown Student';
                const activityName = result.activityName || 'Unknown Activity';
                const score = calculateActivityScore(result.activityName, result.result, result.activityTarget);
                const initials = getInitials(studentName);
                
                html += `
                    <div class="student-item">
                        <div class="student-avatar">${initials}</div>
                        <div class="student-info">
                            <div class="student-name">${studentName}</div>
                            <div class="student-details">
                                <span>${activityName}</span>
                                <span>Score: ${score}</span>
                            </div>
                        </div>
                        <div class="student-status">
                            <span>Completed</span>
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }

        function setupOnlineStudentsMonitoring() {
            // Update online students list
            updateOnlineStudentsList();
            
            // Update online students list periodically
            setInterval(() => {
                updateOnlineStudentsList();
            }, 30000); // Update every 30 seconds
        }

        function updateOnlineStudentsList() {
            const container = document.getElementById('onlineStudentsList');
            
            // Show actual students from database
            const onlineStudents = allStudents.slice(0, Math.min(8, allStudents.length));
            
            if (onlineStudents.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">ðŸ“±</div>
                        <div class="empty-title">No Students Online</div>
                        <div class="empty-text">Students will appear here when they log in</div>
                    </div>
                `;
                return;
            }
            
            let html = '';
            onlineStudents.forEach(student => {
                const firstName = student.firstName || 'Unknown';
                const lastName = student.lastName || 'Student';
                const initials = (firstName.charAt(0) + lastName.charAt(0)).toUpperCase();
                
                html += `
                    <div class="student-item">
                        <div class="student-avatar">${initials}</div>
                        <div class="student-info">
                            <div class="student-name">${firstName} ${lastName}</div>
                            <div class="student-details">
                                <span>${student.section || 'N/A'}</span>
                                <span>ID: ${student.umakId || student.id.substring(0, 8)}</span>
                            </div>
                        </div>
                        <div class="student-status">
                            <div class="status-dot online"></div>
                            <span class="status-online">Online</span>
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }

        function getInitials(name) {
            const nameParts = name.split(' ');
            if (nameParts.length >= 2) {
                return (nameParts[0].charAt(0) + nameParts[nameParts.length - 1].charAt(0)).toUpperCase();
            }
            return name.substring(0, 2).toUpperCase();
        }

        function calculateActivityScore(activityName, result, activityTarget = null) {
            if (!activityName || !result) return 0;
            
            const normalized = activityName.toLowerCase();
            let numericValue = 0;

            // Extract numeric value from result
            if (typeof result === 'string') {
                const match = result.match(/(\d+\.?\d*)/);
                if (match) numericValue = parseFloat(match[1]);
            } else {
                numericValue = parseFloat(result) || 0;
            }

            // If professor set a target, use target-based scoring
            if (activityTarget && activityTarget > 0) {
                if (normalized.includes('push-up') || normalized.includes('pushup') || 
                    normalized.includes('sit-up') || normalized.includes('situp')) {
                    // For rep-based activities
                    const reps = parseInt(result);
                    if (reps >= activityTarget) return 100;
                    if (reps >= activityTarget * 0.9) return 95;
                    if (reps >= activityTarget * 0.8) return 90;
                    if (reps >= activityTarget * 0.7) return 85;
                    if (reps >= activityTarget * 0.6) return 80;
                    if (reps >= activityTarget * 0.5) return 75;
                    return Math.max(50, Math.round((reps / activityTarget) * 100));
                } else if (normalized.includes('plank')) {
                    // For plank (time-based in seconds)
                    const seconds = parseInt(result.split(':')[1] || result);
                    if (seconds >= activityTarget) return 100;
                    if (seconds >= activityTarget * 0.9) return 95;
                    if (seconds >= activityTarget * 0.8) return 90;
                    if (seconds >= activityTarget * 0.7) return 85;
                    if (seconds >= activityTarget * 0.6) return 80;
                    if (seconds >= activityTarget * 0.5) return 75;
                    return Math.max(50, Math.round((seconds / activityTarget) * 100));
                }
            }

            // Fallback to default scoring
            if (normalized.includes('push-up') || normalized.includes('pushup')) {
                const reps = numericValue;
                if (reps >= 40) return 100;
                if (reps >= 30) return 90;
                if (reps >= 20) return 80;
                if (reps >= 15) return 70;
                if (reps >= 10) return 60;
                return 50;
            } else if (normalized.includes('sit-up') || normalized.includes('situp')) {
                const reps = numericValue;
                if (reps >= 50) return 100;
                if (reps >= 40) return 90;
                if (reps >= 30) return 80;
                if (reps >= 20) return 70;
                if (reps >= 15) return 60;
                return 50;
            } else if (normalized.includes('plank')) {
                const seconds = numericValue;
                if (seconds >= 120) return 100;
                if (seconds >= 90) return 90;
                if (seconds >= 60) return 80;
                if (seconds >= 45) return 70;
                if (seconds >= 30) return 60;
                return 50;
            }

            return numericValue > 0 ? 75 : 0; // Default score for unknown activities
        }

        window.monitorActivity = function(activityId) {
            console.log('Monitoring activity:', activityId);
            alert(`Opening detailed monitoring view for activity: ${activityId}\n\nThis will show:\n- Student video feed\n- Exercise form analysis\n- Rep counting\n- Real-time performance metrics`);
        };

        window.interruptActivity = async function(activityId) {
            if (!confirm('Are you sure you want to interrupt this activity? The student will be notified.')) {
                return;
            }
            
            try {
                const activityRef = doc(db, 'activeTests', activityId);
                await updateDoc(activityRef, { 
                    status: 'interrupted',
                    interruptedBy: currentProfessor.id,
                    interruptedAt: new Date()
                });
                
                alert('Activity interrupted successfully. The student has been notified.');
                
            } catch (error) {
                console.error('Error interrupting activity:', error);
                alert('Failed to interrupt activity. Please try again.');
            }
        };

        async function handleLogout() {
            if (confirm('Are you sure you want to logout?')) {
                try {
                    await signOut(auth);
                    window.location.href = '/login/index.html';
                } catch (error) {
                    console.error('Error logging out:', error);
                    alert('Error logging out. Please try again.');
                }
            }
        }

        // Make handleLogout globally available
        window.handleLogout = handleLogout;

    </script>
</body>
</html>