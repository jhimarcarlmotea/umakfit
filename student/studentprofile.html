<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student Profile - UMakFit</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Manrope:wght@600;800&display=swap" rel="stylesheet">
    <style>
    * {
        font-family: 'Inter', sans-serif;
        box-sizing: border-box;
        -webkit-font-smoothing: antialiased;
    }
    
    body {
        background: linear-gradient(135deg, #f5f7fa 0%, #e8eef5 100%);
        margin: 0;
        padding: 0;
    }
    
        /* Navigation */
        .navbar-custom {
            background: linear-gradient(180deg, rgba(30, 58, 138, 1) 0%, rgba(59, 130, 246, 1) 100%);
            padding: 20px 0;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            border-bottom: none;
            height: auto;
        }

        .navbar-brand {
            display: flex;
            align-items: center;
            gap: 15px;
            margin: 0;
            padding: 0;
        }

        .navbar-brand-img {
            height: 60px;
            width: auto;
            object-fit: contain;
        }

        .navbar-brand-text {
            font-family: "Manrope", Helvetica;
            font-weight: 800;
            font-size: 28px;
            background: linear-gradient(90deg, rgba(245, 158, 11, 1) 0%, rgba(255, 229, 0, 1) 100%);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            line-height: 1;
        }

        .nav-container {
            display: flex;
            align-items: center;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 20px;
        }

        .nav-pills-custom {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            padding: 0;
            margin: 0;
            list-style: none;
        }

        .nav-link-custom {
            font-family: "Manrope", Helvetica;
            font-weight: 600;
            color: #000000;
            font-size: 14px;
            padding: 12px 18px;
            border-radius: 8px;
            background-color: #ffffff;
            transition: all 0.3s;
            border: none;
            display: flex;
            align-items: center;
            gap: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            text-decoration: none;
        }

        .nav-link-custom:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
            color: #000000;
        }

        .nav-link-custom i {
            font-size: 14px;
        }

        .nav-link-custom.active {
            background: linear-gradient(90deg, rgba(251, 191, 36, 1) 0%, rgba(245, 158, 11, 1) 100%);
            box-shadow: 0 4px 8px rgba(245, 158, 11, 0.3);
        }

        .notification-bell-btn {
            background: rgba(255, 255, 255, 0.2);
            border: 2px solid rgba(255, 255, 255, 0.3);
            color: white;
            width: 42px;
            height: 42px;
            border-radius: 50%;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 0;
        }

        .notification-bell-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            border-color: rgba(255, 255, 255, 0.5);
            transform: scale(1.1);
        }

        .notification-bell-btn i {
            font-size: 20px;
        }

        .btn-logout-nav {
            background: linear-gradient(90deg, rgba(251, 191, 36, 1) 0%, rgba(245, 158, 11, 1) 100%);
            border: none;
            color: #000000;
            padding: 8px 20px;
            border-radius: 8px;
            font-family: "Manrope", Helvetica;
            font-weight: 600;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 2px 4px rgba(245, 158, 11, 0.3);
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-logout-nav:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(245, 158, 11, 0.4);
        }

        .notification-bell-badge {
            position: absolute;
            top: -4px;
            right: -4px;
            background: #ef4444;
            color: white;
            font-size: 10px;
            font-weight: 700;
            padding: 0.15rem 0.4rem;
            border-radius: 10px;
            min-width: 18px;
            height: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        .notification-bell-container {
            position: relative;
            display: inline-block;
        }

        .notification-dropdown {
            position: absolute;
            top: 100%;
            right: 0;
            background: white;
            border-radius: 12px;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.2);
            width: 380px;
            max-height: 480px;
            overflow-y: auto;
            z-index: 1050;
            display: none;
            margin-top: 0.5rem;
            animation: slideDown 0.3s ease;
        }

        .notification-dropdown.show {
            display: block;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .notification-dropdown-header {
            padding: 1rem 1.25rem;
            border-bottom: 2px solid #e5e7eb;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: linear-gradient(135deg, #f8fafc, #ffffff);
            border-radius: 12px 12px 0 0;
        }

        .notification-dropdown-header h6 {
            margin: 0;
            font-size: 16px;
            font-weight: 700;
            color: #111827;
        }

        .notification-dropdown-body {
            max-height: 360px;
            overflow-y: auto;
        }

        .notification-dropdown-item {
            padding: 1rem 1.25rem;
            border-bottom: 1px solid #f3f4f6;
            transition: background-color 0.2s ease;
            cursor: pointer;
        }

        .notification-dropdown-item:hover {
            background-color: #f9fafb;
        }

        .notification-dropdown-item:last-child {
            border-bottom: none;
        }

        .notification-dropdown-item strong {
            color: #111827;
            font-size: 14px;
            display: block;
            margin-bottom: 0.35rem;
            font-weight: 600;
        }

        .notification-dropdown-item p {
            color: #6b7280;
            font-size: 13px;
            margin: 0;
            line-height: 1.5;
        }

        .notification-dropdown-item small {
            color: #9ca3af;
            font-size: 11px;
            display: block;
            margin-top: 0.35rem;
        }

        .notification-dropdown-footer {
            padding: 0.75rem 1.25rem;
            border-top: 2px solid #e5e7eb;
            text-align: center;
            background-color: #f9fafb;
            border-radius: 0 0 12px 12px;
        }

        .btn-view-all-dropdown {
            background: linear-gradient(135deg, #3b82f6, #2563eb);
            color: white;
            border: none;
            padding: 0.5rem 1.25rem;
            border-radius: 8px;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
        }

        .btn-view-all-dropdown:hover {
            background: linear-gradient(135deg, #2563eb, #1e40af);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(59, 130, 246, 0.3);
        }

        .notification-dropdown-empty {
            padding: 2rem 1.25rem;
            text-align: center;
            color: #9ca3af;
        }

        .notification-dropdown-empty i {
            font-size: 48px;
            color: #d1d5db;
            margin-bottom: 0.75rem;
            display: block;
        }

        .notification-dropdown-empty p {
            color: #6b7280;
            font-size: 14px;
            margin: 0;
        }

        .navbar-toggler {
            background-color: #ffffff;
            border: none;
            padding: 8px 12px;
            border-radius: 6px;
        }

        .navbar-toggler:focus {
            box-shadow: 0 0 0 0.25rem rgba(255,255,255,0.25);
        }

        .navbar-toggler-icon {
            background-image: url("data:image/svg+xml;charset=utf8,%3Csvg viewBox='0 0 30 30' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath stroke='rgba(0,0,0,1)' stroke-width='2' stroke-linecap='round' stroke-miterlimit='10' d='M4 7h22M4 15h22M4 23h22'/%3E%3C/svg%3E") !important;
        }
            @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .slide-down {
            animation: slideDown 0.3s ease;
        }

        /* Ensure dropdown z-index is high enough */
        #profileDropdown,
        #profileDropdownMobile,
        #notificationDropdown {
            z-index: 9999 !important;
        }

   
        .profile-title {
        font-family: "Inter", sans-serif;
        font-weight: 600;
        color: #0f172a;
        font-size: 2rem;
        line-height: 1.3;
        letter-spacing: -0.5px;
        margin-top: 2rem;
        margin-bottom: 2rem;
        text-align: left;
        position: relative;
        padding-left: 1rem;
        border-left: 4px solid #3b82f6;
    }

    .profile-title::after {
        content: "";
        display: block;
        width: 80px;
        height: 2px;
        background: linear-gradient(90deg, #3b82f6, transparent);
        margin-top: 0.75rem;
        border-radius: 2px;
    }


    
    .profile-sidebar {
        background-color: #ffffff;
        border-radius: 8px;
        padding: 2rem 1.5rem;
    }
    
    .profile-avatar {
    width: 120px;
    height: 120px;
    background-color: transparent;
    border-radius: 50%;
    margin: 0 auto 1.5rem;
    display: flex;
    align-items: center;
    justify-content: center;
    position: relative;
    overflow: hidden;
    border: 3px solid #3b82f6;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }

    .profile-avatar i {
        font-size: 82px;
        color: #666;
    }

    .profile-avatar img {
        width: 100%;
        height: 100%;
        object-fit: cover;
    }
    
    .profile-name {
        font-family: 'Inter', Helvetica;
        font-weight: 600;
        color: #000000;
        font-size: 18px;
        letter-spacing: -0.18px;
        line-height: 25.2px;
        text-align: center;
        margin-bottom: 0.5rem;
    }
    
    .profile-id {
        font-family: 'Inter', Helvetica;
        font-weight: 400;
        color: #000000;
        font-size: 13px;
        letter-spacing: -0.13px;
        line-height: 18.2px;
        text-align: center;
        margin-bottom: 1.5rem;
    }
    
    .profile-section-badge {
        background-color: #1e3a8a;
        border-radius: 18px;
        padding: 0.5rem 1rem;
        color: #ffffff;
        font-family: 'Inter', Helvetica;
        font-weight: 400;
        font-size: 12px;
        letter-spacing: -0.12px;
        line-height: 16.8px;
        text-align: center;
        margin: 0 auto 1.5rem;
    }
    
    .profile-info-item {
        border-top: 1px solid #e0e0e0;
        padding: 1rem 0;
    }
    
    .profile-info-label {
        font-family: 'Inter', Helvetica;
        font-weight: 400;
        color: rgba(0, 0, 0, 0.5);
        font-size: 8px;
        letter-spacing: -0.08px;
        line-height: 11.2px;
        text-transform: uppercase;
        margin-bottom: 0.25rem;
    }
    
    .profile-info-value {
        font-family: 'Inter', Helvetica;
        font-weight: 400;
        color: #000000;
        font-size: 11px;
        letter-spacing: -0.11px;
        line-height: 15.4px;
    }
    
    .medical-condition-box {
        background-color: #ffffff;
        border: 1px solid #1e3a8a;
        border-radius: 2px;
        padding: 1rem;
        min-height: 83px;
        margin-top: 1rem;
    }
    
    .edit-profile-btn {
        background: linear-gradient(90deg, rgba(18, 27, 103, 1) 0%, rgba(59, 130, 246, 1) 100%);
        color: #ffffff;
        border: none;
        border-radius: 7px;
        padding: 0.5rem;
        width: 100%;
        font-family: 'Inter', Helvetica;
        font-weight: 400;
        font-size: 14px;
        letter-spacing: -0.14px;
        line-height: 19.6px;
        margin-top: 1rem;
        cursor: pointer;
        transition: all 0.3s ease;
    }
    
    .edit-profile-btn:hover {
        opacity: 0.9;
        transform: translateY(-2px);
    }
    
    .physiological-card,
    .test-history-card {
        background-color: #ffffff;
        border-radius: 7px;
        padding: 1.5rem;
        margin-bottom: 1.5rem;
        overflow: hidden;
    }
    
    .card-title-custom {
        font-family: 'Inter', Helvetica;
        font-weight: 600;
        color: #000000;
        font-size: 18px;
        letter-spacing: -0.18px;
        line-height: 25.2px;
        margin-bottom: 1.5rem;
    }
    
    .physio-box {
        background-color: #eceff8;
        border: 1px solid #9f9f9f;
        border-radius: 6px;
        padding: 1.5rem;
        text-align: center;
    }
    
    .physio-icon {
        width: 45px;
        height: 45px;
        margin-bottom: 0.5rem;
        object-fit: cover;
    }
    
    .physio-label {
        font-family: 'Inter', Helvetica;
        font-weight: 400;
        color: #000000;
        font-size: 13px;
        letter-spacing: -0.13px;
        line-height: 18.2px;
        margin-bottom: 0.5rem;
    }
    
    .physio-value {
        font-family: 'Inter', Helvetica;
        font-weight: 700;
        color: #000000;
        font-size: 24px;
        letter-spacing: -0.24px;
        line-height: 33.6px;
    }
    
    .physio-unit {
        font-size: 13px;
        font-weight: 400;
        letter-spacing: -0.13px;
        line-height: 18.2px;
    }
    
    .test-history-table {
        width: 100%;
    }
    
    .test-history-header {
        background-color: #eceff8;
        border: 1px solid #9f9f9f;
    }
    
    .test-history-header th {
        font-family: 'Inter', Helvetica;
        font-weight: 600;
        color: #000000;
        font-size: 18px;
        letter-spacing: -0.18px;
        line-height: 25.2px;
        padding: 1rem;
    }
    
    .test-history-row {
        border-bottom: 2px solid #e0e0e0;
    }
    
    .test-history-cell {
        font-family: 'Inter', Helvetica;
        font-weight: 600;
        color: #000000;
        font-size: 18px;
        letter-spacing: -0.18px;
        line-height: 25.2px;
        padding: 1rem;
    }
    
    .test-badge {
        padding: 0.25rem 0.75rem;
        border-radius: 14px;
        font-family: 'Inter', Helvetica;
        font-weight: 600;
        font-size: 11px;
        letter-spacing: 0;
        line-height: 17.4px;
        display: inline-block;
    }
    
    .badge-excellent {
        background-color: #a4fbb1;
        color: #000000;
    }
    
    .badge-good {
        background-color: #3b82f6;
        color: #000000;
    }
    
    .badge-needs-improvement {
        background-color: #fbbf24;
        color: #000000;
    }
    
    .empty-state {
        text-align: center;
        padding: 3rem 1.5rem;
        color: #64748b;
    }
    
    .empty-state i {
        font-size: 56px;
        color: #cbd5e1;
        margin-bottom: 1rem;
    }
    
    

/* Footer responsive fix */
@media (min-width: 768px) {
    .footer-custom .container-fluid {
        max-width: 100%;
        padding-left: 2rem;
        padding-right: 2rem;
    }
}

@media (min-width: 992px) {
    .footer-custom .container-fluid {
        max-width: 100%;
        padding-left: 3rem;
        padding-right: 3rem;
    }
}

@media (min-width: 1200px) {
    .footer-custom .container-fluid {
        max-width: 100%;
        padding-left: 4rem;
        padding-right: 4rem;
    }
}
    
    .loading {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(255,255,255,0.98);
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 9999;
        flex-direction: column;
        gap: 20px;
    }
    
    .spinner {
        border: 4px solid #e5e7eb;
        border-top: 4px solid #3b82f6;
        border-radius: 50%;
        width: 50px;
        height: 50px;
        animation: spin 1s linear infinite;
    }
    
    @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }
    
   @media (max-width: 991px) {
    .nav-link-custom {
        width: 100%;
        justify-content: flex-start;
    }
    
    .btn-logout-nav {
        width: 100%;
        justify-content: center;
    }
    
    .notification-bell-container {
        width: 100%;
        display: flex;
        justify-content: center;
    }
}
    @keyframes slide-in {
    from {
        transform: translateX(400px);
        opacity: 0;
    }
    to {
        transform: translateX(0);
        opacity: 1;
    }
}

    .animate-slide-in {
        animation: slide-in 0.3s ease-out;
    }
        /* Hamburger Menu Styles */
    .hamburger {
        display: none;
        flex-direction: column;
        gap: 4px;
        cursor: pointer;
        z-index: 60;
    }

    .hamburger span {
        width: 25px;
        height: 3px;
        background: linear-gradient(135deg, #EAD38A 0%, #C5A046 50%, #8B6D2D 100%);
        border-radius: 2px;
        transition: all 0.3s ease;
    }

    .hamburger.active span:nth-child(1) {
        transform: rotate(45deg) translate(5px, 5px);
    }

    .hamburger.active span:nth-child(2) {
        opacity: 0;
    }

    .hamburger.active span:nth-child(3) {
        transform: rotate(-45deg) translate(7px, -6px);
    }

    /* Mobile Drawer */
    .mobile-drawer {
        position: fixed;
        top: 0;
        right: -100%;
        width: 280px;
        height: 100vh;
        background: linear-gradient(135deg, #0D1B2A 0%, #1A2B3C 50%, #2C4A5E 100%);
        z-index: 55;
        transition: right 0.3s ease;
        box-shadow: -5px 0 15px rgba(0, 0, 0, 0.3);
        overflow-y: auto;
    }

    .mobile-drawer.active {
        right: 0;
    }

    .drawer-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100vh;
        background: rgba(0, 0, 0, 0.5);
        z-index: 50;
        opacity: 0;
        visibility: hidden;
        transition: opacity 0.3s ease, visibility 0.3s ease;
    }

    .drawer-overlay.active {
        opacity: 1;
        visibility: visible;
    }

    @media (max-width: 1023px) {
        .hamburger {
            display: flex;
        }
    }
</style>
</head>
<body>
    <!-- Loading Screen -->
<div id="loadingScreen" class="fixed inset-0 bg-white/98 flex flex-col items-center justify-center z-50">
    <img src="UMakfit Logo (2).png" alt="UMakFit Logo" class="h-40 sm:h-48 w-auto object-contain mb-4 animate-pulse">
    <div class="spinner"></div>
    <div class="mt-5 text-gray-600 font-medium text-sm md:text-base">Loading Profile...</div>
</div>

    <div id="mainContent" style="display: none;">
        <!-- Navigation -->
<nav class="shadow-lg" style="background: linear-gradient(135deg, #0D1B2A 0%, #1A2B3C 50%, #2C4A5E 100%);">
    <div class="container mx-auto px-3 sm:px-4 py-4 sm:py-5">
        <div class="flex flex-wrap items-center justify-between gap-3 sm:gap-4">
            <!-- Logo -->
            <a href="#" class="flex items-center gap-2 sm:gap-3">
                <img src="UMakfit Logo (2).png" 
                     alt="UMak Logo" class="h-12 sm:h-14 md:h-16 w-auto object-contain">
               <span class="text-xl sm:text-2xl md:text-3xl font-extrabold font-manrope" style="background: linear-gradient(135deg, #EAD38A 0%, #C5A046 50%, #8B6D2D 100%); -webkit-background-clip: text; background-clip: text; -webkit-text-fill-color: transparent;">
                    UMakFit
                </span>
            </a>
            
            <!-- Desktop Navigation -->
            <div class="hidden lg:flex items-center gap-2 flex-wrap">
                <a href="./studentDashboard.html" class="px-3 xl:px-4 py-2.5 xl:py-3 bg-white/20 text-white rounded-lg font-semibold text-sm flex items-center gap-2 hover:bg-white/30 transition-all">
                    <i class="bi bi-speedometer2"></i> 
                    <span class="hidden xl:inline">Dashboard</span>
                </a>
                <a href="./test.html" class="px-3 xl:px-4 py-2.5 xl:py-3 bg-white/20 text-white rounded-lg font-semibold text-sm flex items-center gap-2 hover:bg-white/30 transition-all">
                    <i class="bi bi-clipboard-check"></i> 
                    <span class="hidden xl:inline">Test</span>
                </a>
                <a href="./studentlesson.html" class="px-3 xl:px-4 py-2.5 xl:py-3 bg-white/20 text-white rounded-lg font-semibold text-sm flex items-center gap-2 hover:bg-white/30 transition-all">
                    <i class="bi bi-book"></i> 
                    <span class="hidden xl:inline">Lesson</span>
                </a>
                <a href="./studentgrades.html" class="px-3 xl:px-4 py-2.5 xl:py-3 bg-white/20 text-white rounded-lg font-semibold text-sm flex items-center gap-2 hover:bg-white/30 transition-all">
                    <i class="bi bi-award"></i> 
                    <span class="hidden xl:inline">Grades</span>
                </a>
                <a href="./progress.html" class="px-3 xl:px-4 py-2.5 xl:py-3 bg-white/20 text-white rounded-lg font-semibold text-sm flex items-center gap-2 hover:bg-white/30 transition-all">
                    <i class="bi bi-graph-up"></i> 
                    <span class="hidden xl:inline">Progress</span>
                </a>
                <a href="./achievements.html" class="px-3 xl:px-4 py-2.5 xl:py-3 bg-white/20 text-white rounded-lg font-semibold text-sm flex items-center gap-2 hover:bg-white/30 transition-all">
                    <i class="bi bi-trophy"></i> 
                    <span class="hidden xl:inline">Achievements</span>
                </a>
                
                <!-- Notification Bell -->
                <div class="relative">
                    <button id="notificationBellBtn" 
                            class="w-9 h-9 xl:w-10 xl:h-10 bg-white/20 border-2 border-white/30 rounded-full flex items-center justify-center text-white hover:bg-white/30 hover:scale-110 transition-all">
                        <i class="bi bi-bell-fill text-base xl:text-lg"></i>
                        <span id="navNotificationCount" class="hidden absolute -top-1 -right-1 bg-red-500 text-white text-xs font-bold px-1.5 py-0.5 rounded-full min-w-[18px] h-4.5 flex items-center justify-center">0</span>
                    </button>
                    
                    <!-- Notification Dropdown -->
                    <div id="notificationDropdown" class="hidden absolute right-0 mt-2 w-96 max-w-[calc(100vw-2rem)] bg-white rounded-xl shadow-2xl z-[9999] max-h-[480px] overflow-y-auto">
                        <div class="p-4 border-b-2 border-gray-200 bg-gradient-to-r from-gray-50 to-white flex justify-between items-center rounded-t-xl sticky top-0 z-10">
                            <h6 class="font-bold text-gray-900 text-base flex items-center gap-2">
                                <i class="bi bi-bell-fill text-blue-500"></i> Notifications
                            </h6>
                            <button onclick="closeNotificationDropdown()" class="text-gray-400 hover:text-gray-600 p-1">
                                <i class="bi bi-x-lg"></i>
                            </button>
                        </div>
                        <div id="notificationDropdownBody" class="max-h-96 overflow-y-auto">
                            <div class="p-8 text-center text-gray-400">
                                <i class="bi bi-bell-slash text-5xl mb-3 block"></i>
                                <p class="text-gray-600">No notifications yet</p>
                            </div>
                        </div>
                    </div>
                </div>
                            
                <!-- Profile Dropdown -->
                <div class="relative">
                    <img src="" alt="Profile" id="profilePictureBtn" onclick="toggleProfileDropdown()"
                        class="w-9 h-9 xl:w-10 xl:h-10 rounded-full border-2 border-white/30 cursor-pointer hover:border-white/60 hover:scale-105 transition-all object-cover">
                    
                    <div id="profileDropdown" class="hidden absolute right-0 mt-2 w-64 sm:w-72 bg-white rounded-xl shadow-2xl z-[9999] slide-down">
                        <div class="p-4 sm:p-6 border-b-2 border-gray-200 text-center">
                            <img src="" alt="Profile" id="profileDropdownPicture" class="w-16 h-16 sm:w-20 sm:h-20 rounded-full mx-auto mb-2 sm:mb-3 border-3 border-blue-500 object-cover">
                            <h6 id="profileDropdownName" class="font-bold text-gray-900 text-base sm:text-lg">Loading...</h6>
                            <p id="profileDropdownEmail" class="text-xs sm:text-sm text-gray-500 mt-1 truncate px-2">Loading...</p>
                        </div>
                        <div class="p-2">
                            <a href="./studentProfile.html" class="flex items-center gap-3 px-3 sm:px-4 py-2.5 sm:py-3 rounded-lg hover:bg-gray-100 transition-colors">
                                <i class="bi bi-person-circle text-blue-500 text-lg sm:text-xl"></i>
                                <span class="font-medium text-gray-700 text-sm sm:text-base">View Profile</span>
                            </a>
                            <div class="h-px bg-gray-200 my-1 sm:my-2"></div>
                            <div onclick="handleLogout()" class="flex items-center gap-3 px-3 sm:px-4 py-2.5 sm:py-3 rounded-lg hover:bg-red-50 transition-colors cursor-pointer text-red-500">
                                <i class="bi bi-box-arrow-right text-lg sm:text-xl"></i>
                                <span class="font-medium text-sm sm:text-base">Logout</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Mobile Right Icons -->
        <div class="flex lg:hidden items-center gap-2 sm:gap-3">
            <!-- Mobile Notification Bell -->
            <div class="relative">
                <button id="notificationBellBtnMobile" 
        onclick="toggleNotificationDropdownMobile(event)"
        class="w-9 h-9 sm:w-10 sm:h-10 bg-white/20 border-2 border-white/30 rounded-full flex items-center justify-center text-white hover:bg-white/30 hover:scale-110 transition-all">
                    <i class="bi bi-bell-fill text-base sm:text-lg"></i>
                    <span id="navNotificationCountMobile" class="hidden absolute -top-1 -right-1 bg-red-500 text-white text-xs font-bold px-1.5 py-0.5 rounded-full min-w-[18px] h-4.5 flex items-center justify-center">0</span>
                </button>
                
                <!-- Mobile Notification Dropdown -->
                <div id="notificationDropdownMobile" class="hidden fixed right-2 top-20 w-96 max-w-[calc(100vw-2rem)] bg-white rounded-xl shadow-2xl z-[9999] max-h-[480px] overflow-y-auto">
                    <div class="p-4 border-b-2 border-gray-200 bg-gradient-to-r from-gray-50 to-white flex justify-between items-center rounded-t-xl sticky top-0 z-10">
                        <h6 class="font-bold text-gray-900 text-base flex items-center gap-2">
                            <i class="bi bi-bell-fill text-blue-500"></i> Notifications
                        </h6>
                        <button onclick="closeNotificationDropdownMobile()" class="text-gray-400 hover:text-gray-600 p-1">
                            <i class="bi bi-x-lg"></i>
                        </button>
                    </div>
                    <div id="notificationDropdownBodyMobile" class="max-h-96 overflow-y-auto">
                        <div class="p-8 text-center text-gray-400">
                            <i class="bi bi-bell-slash text-5xl mb-3 block"></i>
                            <p class="text-gray-600">No notifications yet</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Mobile Profile -->
            <div class="relative">
                <img src="" alt="Profile" id="profilePictureBtnMobile" onclick="toggleProfileDropdown()"
                    class="w-9 h-9 sm:w-10 sm:h-10 rounded-full border-2 border-white/30 cursor-pointer hover:border-white/60 object-cover">
                
                <!-- Mobile Profile Dropdown -->
                <div id="profileDropdownMobile" class="hidden fixed right-2 top-20 w-64 sm:w-72 bg-white rounded-xl shadow-2xl z-[9999] slide-down">
                    <div class="p-4 sm:p-6 border-b-2 border-gray-200 text-center">
                        <img src="" alt="Profile" id="profileDropdownPictureMobile" class="w-16 h-16 sm:w-20 sm:h-20 rounded-full mx-auto mb-2 sm:mb-3 border-3 border-blue-500 object-cover">
                        <h6 id="profileDropdownNameMobile" class="font-bold text-gray-900 text-base sm:text-lg">Loading...</h6>
                        <p id="profileDropdownEmailMobile" class="text-xs sm:text-sm text-gray-500 mt-1 truncate px-2">Loading...</p>
                    </div>
                    <div class="p-2">
                        <a href="./studentProfile.html" class="flex items-center gap-3 px-3 sm:px-4 py-2.5 sm:py-3 rounded-lg hover:bg-gray-100 transition-colors">
                            <i class="bi bi-person-circle text-blue-500 text-lg sm:text-xl"></i>
                            <span class="font-medium text-gray-700 text-sm sm:text-base">View Profile</span>
                        </a>
                        <div class="h-px bg-gray-200 my-1 sm:my-2"></div>
                        <div onclick="handleLogout()" class="flex items-center gap-3 px-3 sm:px-4 py-2.5 sm:py-3 rounded-lg hover:bg-red-50 transition-colors cursor-pointer text-red-500">
                            <i class="bi bi-box-arrow-right text-lg sm:text-xl"></i>
                            <span class="font-medium text-sm sm:text-base">Logout</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Hamburger Menu Button -->
            <div class="hamburger" id="hamburger">
                <span></span>
                <span></span>
                <span></span>
            </div>
        </div>
        </nav>
        <!-- Mobile Drawer Overlay -->
<div class="drawer-overlay" id="drawerOverlay"></div>

<!-- Mobile Drawer Overlay -->
<div class="drawer-overlay" id="drawerOverlay"></div>

<!-- Mobile Drawer -->
<div class="mobile-drawer" id="mobileDrawer">
    <div class="p-6 pt-8">
        <!-- Drawer Header -->
        <div class="flex items-center gap-3 mb-8 pb-6 border-b border-white/20">
            <img src="https://c.animaapp.com/vkhEa8zW/img/screenshot-2025-09-19-2-53-51-pm-removebg-preview-3@2x.png" 
                 alt="UMak Logo" class="h-12 w-auto object-contain">
            <span class="text-2xl font-extrabold font-manrope" style="background: linear-gradient(135deg, #EAD38A 0%, #C5A046 50%, #8B6D2D 100%); -webkit-background-clip: text; background-clip: text; -webkit-text-fill-color: transparent;">
                UMakFIT
            </span>
        </div>

        <!-- Navigation Links - BAGUHIN MO LANG YUNG ACTIVE LINK BASED SA PAGE -->
        <nav class="space-y-2">
            <a href="./studentDashboard.html" class="mobile-nav-link block text-white/80 hover:text-white hover:bg-white/10 font-medium py-3 px-4 rounded-lg transition-all">
                <i class="bi bi-speedometer2 mr-3"></i>Dashboard
            </a>
            <a href="./test.html" class="mobile-nav-link block text-white/80 hover:text-white hover:bg-white/10 font-medium py-3 px-4 rounded-lg transition-all">
                <i class="bi bi-clipboard-check mr-3"></i>Test
            </a>
            <a href="./studentlesson.html" class="mobile-nav-link block text-white/80 hover:text-white hover:bg-white/10 font-medium py-3 px-4 rounded-lg transition-all">
                <i class="bi bi-book mr-3"></i>Lessons
            </a>
            <a href="./studentgrades.html" class="mobile-nav-link block text-white/80 hover:text-white hover:bg-white/10 font-medium py-3 px-4 rounded-lg transition-all">
                <i class="bi bi-award mr-3"></i>Grades
            </a>
            <a href="./progress.html" class="mobile-nav-link block text-white/80 hover:text-white hover:bg-white/10 font-medium py-3 px-4 rounded-lg transition-all">
                <i class="bi bi-graph-up mr-3"></i>Progress
            </a>
            <a href="./achievements.html" class="mobile-nav-link block text-white/80 hover:text-white hover:bg-white/10 font-medium py-3 px-4 rounded-lg transition-all">
                <i class="bi bi-trophy mr-3"></i>Achievements
            </a>
        </nav>
    </div>
</div>
        <!-- Profile Content -->
        <div class="container" style="max-width: 1400px;">
           <div class="relative mb-8 sm:mb-10 mt-8 sm:mt-12">
    <div class="flex items-center gap-3 mb-3">
        <div class="w-10 h-10 sm:w-12 sm:h-12 bg-gradient-to-br from-blue-500 to-blue-600 rounded-xl flex items-center justify-center shadow-md flex-shrink-0">
            <i class="bi bi-person-circle text-xl sm:text-2xl text-white"></i>
        </div>
        <h1 class="text-2xl sm:text-3xl md:text-4xl font-bold bg-gradient-to-r from-blue-600 to-yellow-500 bg-clip-text text-transparent leading-tight">
            Student Profile
        </h1>
    </div>
</div>
            
            <div class="row">
                <!-- Left Sidebar -->
                <div class="col-lg-3">
                    <div class="profile-sidebar">
                       <div class="profile-avatar">
                            <img src="" alt="Profile" id="profileAvatarImage" class="w-100 h-100 rounded-circle object-cover" style="display: none;">
                            <i class="bi bi-person-circle" id="profileAvatarIcon"></i>
                        </div>
                        <div class="profile-name" id="profileName">Student Name</div>
                        <div class="profile-id" id="profileId">ID: 000000</div>
                        <div class="profile-section-badge" id="profileSection">Section</div>
                        
                        <div class="profile-info-item">
                            <div class="profile-info-label">Age & Gender</div>
                            <div class="profile-info-value" id="profileAgeGender">-- years - --</div>
                        </div>
                        
                        <div class="profile-info-item">
                            <div class="profile-info-label">Email Address</div>
                            <div class="profile-info-value" id="profileEmail">email@umak.edu.ph</div>
                        </div>
                        
                        <div class="profile-info-item">
                            <div class="profile-info-label">Contact Number</div>
                            <div class="profile-info-value" id="profileContact">+63 000000000</div>
                        </div>
                        
                        <div class="profile-info-item" style="border-bottom: 1px solid #e0e0e0;">
                            <div class="profile-info-label">Medical Condition</div>
                        </div>
                        
                        <div class="medical-condition-box">
                            <div class="profile-info-value" id="profileMedical">None</div>
                        </div>
                        
                        <button class="edit-profile-btn" onclick="editProfile()">Edit Profile</button>
                        <!-- Edit Profile Modal -->
<div class="modal fade" id="editProfileModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header" style="background: linear-gradient(135deg, #1e3a8a, #3b82f6); color: white;">
                <h5 class="modal-title"><i class="bi bi-pencil-square me-2"></i>Edit Profile</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="editProfileForm">
                    <div class="row g-3">
                        <div class="col-md-6">
                            <label class="form-label fw-bold">Age</label>
                            <input type="number" class="form-control" id="editAge" min="15" max="100" required>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label fw-bold">Gender</label>
                            <select class="form-select" id="editGender" required>
                                <option value="">Select Gender</option>
                                <option value="Male">Male</option>
                                <option value="Female">Female</option>
                            </select>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label fw-bold">Email Address</label>
                            <input type="email" class="form-control" id="editEmail" required>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label fw-bold">Contact Number</label>
                            <input type="tel" class="form-control" id="editContact" placeholder="+63 9XXXXXXXXX" required>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label fw-bold">Height (cm)</label>
                            <input type="number" class="form-control" id="editHeight" min="100" max="250" required>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label fw-bold">Weight (kg)</label>
                            <input type="number" class="form-control" id="editWeight" min="30" max="200" required>
                        </div>
                       
                        <div class="col-12">
                            <label class="form-label fw-bold">Medical Condition</label>
                            <textarea class="form-control" id="editMedical" rows="3" placeholder="Enter any medical conditions or allergies"></textarea>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" onclick="saveProfile()" style="background: linear-gradient(135deg, #1e3a8a, #3b82f6); border: none;">
                    <i class="bi bi-save me-2"></i>Save Changes
                </button>
            </div>
        </div>
    </div>
</div>
                    </div>
                </div>

                <!-- Right Content -->
                <div class="col-lg-9">
                    <!-- Physiological Data -->
                    <div class="physiological-card">
                        <h5 class="card-title-custom">Physiological Data</h5>
                        <div class="row g-3">
                            <div class="col-md-4">
                                <div class="physio-box">
                                    <img src="https://c.animaapp.com/vkhEa8zW/img/image-126@2x.png" alt="Height" class="physio-icon">
                                    <div class="physio-label">HEIGHT</div>
                                    <div class="physio-value">
                                        <span id="profileHeight">0</span>
                                        <span class="physio-unit">CM</span>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="physio-box">
                                    <img src="https://c.animaapp.com/vkhEa8zW/img/image-127@2x.png" alt="Weight" class="physio-icon">
                                    <div class="physio-label">WEIGHT</div>
                                    <div class="physio-value">
                                        <span id="profileWeight">0</span>
                                        <span class="physio-unit">KG</span>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="physio-box">
                                    <img src="https://c.animaapp.com/vkhEa8zW/img/image-127@2x.png" alt="BMI" class="physio-icon">
                                    <div class="physio-label">BMI</div>
                                    <div class="physio-value" id="profileBMI">0.00</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Account Activity -->
<div class="test-history-card">
    <h5 class="card-title-custom">Account Activity</h5>
    <div class="row g-3">
        <div class="col-md-6">
            <div class="physio-box">
                <i class="bi bi-clock-history" style="font-size: 45px; color: #3b82f6;"></i>
                <div class="physio-label">LAST LOGIN</div>
                <div class="physio-value" style="font-size: 16px;" id="lastLogin">Never</div>
            </div>
        </div>
        <div class="col-md-6">
            <div class="physio-box">
                <i class="bi bi-calendar-check" style="font-size: 45px; color: #10b981;"></i>
                <div class="physio-label">ACCOUNT CREATED</div>
                <div class="physio-value" style="font-size: 16px;" id="accountCreated">N/A</div>
            </div>
        </div>
    </div>
</div>
            </div>
        </div>
        </div>

        <!-- Footer -->
<footer class="bg-gradient-to-r from-blue-900 to-blue-800 text-white mt-12 sm:mt-16 py-8 sm:py-12">
    <div class="container mx-auto px-4 sm:px-6 lg:px-8 max-w-7xl">
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8 lg:gap-12 text-center lg:text-left">
            <!-- About UmakFit & College of Human Kinetics -->
            <div>
                <div class="flex items-center justify-center lg:justify-start gap-3 mb-4">
                    <img src="https://c.animaapp.com/vkhEa8zW/img/screenshot-2025-09-19-2-53-51-pm-removebg-preview-3@2x.png" 
                         alt="UMak Logo" class="h-12 w-auto object-contain">
                    <div>
                        <h6 class="text-yellow-400 font-bold text-lg lg:text-xl mb-1">UMakFit</h6>
                        <p class="text-xs lg:text-sm text-blue-200 font-medium">College of Human Kinetics</p>
                    </div>
                </div>
                <p class="text-sm lg:text-base leading-relaxed text-blue-100">
                    UMakFit is the official fitness assessment and tracking platform of the College of Human Kinetics at University of Makati. 
                    Our mission is to promote health, wellness, and physical fitness through comprehensive assessment and personalized tracking.
                </p>
                <div class="mt-4 flex flex-wrap gap-2 justify-center lg:justify-start">
                    <span class="bg-blue-700/50 px-3 py-1 rounded-full text-xs font-semibold">Fitness Tracking</span>
                    <span class="bg-blue-700/50 px-3 py-1 rounded-full text-xs font-semibold">Performance Assessment</span>
                    <span class="bg-blue-700/50 px-3 py-1 rounded-full text-xs font-semibold">Health & Wellness</span>
                </div>
            </div>

            <!-- Quick Links -->
            <div>
                <h6 class="text-yellow-400 font-bold text-lg lg:text-xl mb-4 lg:mb-6">Quick Links</h6>
                <div class="grid grid-cols-2 gap-4 lg:gap-6">
                    <div class="space-y-3">
                        <a href="./studentlesson.html" class="block text-blue-100 hover:text-yellow-300 hover:translate-x-1 transition-all duration-200 text-sm lg:text-base">
                            <i class="bi bi-book mr-2"></i>Lessons
                        </a>
                        <a href="./test.html" class="block text-blue-100 hover:text-yellow-300 hover:translate-x-1 transition-all duration-200 text-sm lg:text-base">
                            <i class="bi bi-clipboard-check mr-2"></i>Tests
                        </a>
                        <a href="./progress.html" class="block text-blue-100 hover:text-yellow-300 hover:translate-x-1 transition-all duration-200 text-sm lg:text-base">
                            <i class="bi bi-graph-up mr-2"></i>Progress
                        </a>
                    </div>
                    <div class="space-y-3">
                        <a href="./studentgrades.html" class="block text-blue-100 hover:text-yellow-300 hover:translate-x-1 transition-all duration-200 text-sm lg:text-base">
                            <i class="bi bi-award mr-2"></i>Grades
                        </a>
                        <a href="./studentProfile.html" class="block text-blue-100 hover:text-yellow-300 hover:translate-x-1 transition-all duration-200 text-sm lg:text-base">
                            <i class="bi bi-person-circle mr-2"></i>Profile
                        </a>
                        <a href="./achievements.html" class="block text-blue-100 hover:text-yellow-300 hover:translate-x-1 transition-all duration-200 text-sm lg:text-base">
                            <i class="bi bi-trophy mr-2"></i>Achievements
                        </a>
                    </div>
                </div>
            </div>

            <!-- Contact & Social -->
            <div>
                <h6 class="text-yellow-400 font-bold text-lg lg:text-xl mb-4 lg:mb-6">Get In Touch</h6>
                <div class="space-y-4 lg:space-y-5">
                    <div class="flex items-start gap-3">
                        <i class="bi bi-geo-alt-fill text-yellow-400 text-lg lg:text-xl mt-1"></i>
                        <p class="text-sm lg:text-base text-blue-100">
                            College of Human Kinetics<br>
                            University of Makati<br>
                            3rd floor, Administration Building, University of Makati, 
                            JP Rizal Ext., West Rembo, Taguig City<br>
                            
                        </p>
                    </div>
                    <div class="flex items-center gap-3">
                        <i class="bi bi-envelope-fill text-yellow-400 text-lg lg:text-xl"></i>
                        <a href="mailto:chk@umak.edu.ph" class="text-blue-100 hover:text-yellow-300 transition-colors text-sm lg:text-base">
                            chk@umak.edu.ph
                        </a>
                    </div>
                    <div class="flex items-center gap-3">
                        <i class="bi bi-telephone-fill text-yellow-400 text-lg lg:text-xl"></i>
                        <span class="text-blue-100 text-sm lg:text-base">+63 933 189 7230</span>
                    </div>
                    <div class="flex items-center gap-4 pt-3">
                        <a href="https://www.facebook.com/profile.php?id=61577064971920" target="_blank" class="bg-blue-700 hover:bg-blue-600 p-2.5 rounded-lg transition-all duration-200 hover:scale-110">
                            <i class="bi bi-facebook text-white text-lg lg:text-xl"></i>
                        </a>
                        <a href="#" class="bg-blue-700 hover:bg-blue-600 p-2.5 rounded-lg transition-all duration-200 hover:scale-110">
                            <i class="bi bi-twitter text-white text-lg lg:text-xl"></i>
                        </a>
                        <a href="#" class="bg-blue-700 hover:bg-blue-600 p-2.5 rounded-lg transition-all duration-200 hover:scale-110">
                            <i class="bi bi-instagram text-white text-lg lg:text-xl"></i>
                        </a>
                        <a href="#" class="bg-blue-700 hover:bg-blue-600 p-2.5 rounded-lg transition-all duration-200 hover:scale-110">
                            <i class="bi bi-youtube text-white text-lg lg:text-xl"></i>
                        </a>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Divider -->
        <div class="border-t border-blue-600/50 mt-8 lg:mt-12 pt-6 lg:pt-8">
            <div class="flex flex-col lg:flex-row justify-between items-center gap-4">
                <div class="text-center lg:text-left">
                    <p class="text-xs lg:text-sm text-blue-200">
                         2025 University of Makati - College of Human Kinetics. All Rights Reserved.
                    </p>
                </div>
                <div class="flex flex-wrap justify-center gap-3 lg:gap-4">
                    <a href="https://umak.edu.ph" target="_blank" class="text-xs lg:text-sm text-blue-200 hover:text-yellow-300 transition-colors">
                        University of Makati
                    </a>
                    <span class="text-blue-400"></span>
                    <a href="https://library.umak.edu.ph" target="_blank" class="text-xs lg:text-sm text-blue-200 hover:text-yellow-300 transition-colors">
                        UMak Online Library
                    </a>
                    <span class="text-blue-400"></span>
                    <a href="https://tbl.umak.edu.ph" target="_blank" class="text-xs lg:text-sm text-blue-200 hover:text-yellow-300 transition-colors">
                        TBL Hub
                    </a>
                </div>
            </div>
        </div>
    </div>
</footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script type="module">
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
    import { getAuth, onAuthStateChanged, signOut } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';
    import { getFirestore, doc, getDoc, collection, query, where, getDocs, updateDoc } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';

    const firebaseConfig = {
        apiKey: "AIzaSyAgaLunqEf2gs6dSpF_sz1hV5XQ5Wm52jo",
        authDomain: "umakfit-e3b1d.firebaseapp.com",
        projectId: "umakfit-e3b1d",
        storageBucket: "umakfit-e3b1d.appspot.com",
        messagingSenderId: "276569891504",
        appId: "1:276569891504:web:39b1732b519f4d8b785175"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    window.auth = auth;
    window.signOut = signOut;

    // Helper function to capitalize names
    function capitalize(str) {
        if (!str) return '';
        return str.charAt(0).toUpperCase() + str.slice(1).toLowerCase();
    }

    // Function to extract UMak ID from email
    function extractUmakIdFromEmail(email) {
        if (!email) return 'Not Assigned';
        
        const emailLower = email.toLowerCase();
        
        // Remove @umak.edu.ph if present
        let emailWithoutDomain = emailLower.replace('@umak.edu.ph', '');
        
        // Split by dots to get all parts
        const parts = emailWithoutDomain.split('.');
        
        // The ID should be the last part
        if (parts.length >= 1) {
            const lastPart = parts[parts.length - 1];
            
            // Check if it looks like an ID (starts with letter then numbers)
            // Pattern: starts with a letter, followed by digits (e.g., a12345758)
            const idPattern = /^[a-z][0-9]+$/i;
            
            if (idPattern.test(lastPart)) {
                return lastPart.toUpperCase(); // Return as uppercase
            }
            
            // Also check for alphanumeric patterns that might be IDs
            const alnumPattern = /^[a-z0-9]+$/i;
            if (alnumPattern.test(lastPart) && lastPart.length >= 7) {
                return lastPart.toUpperCase();
            }
            
            // If it's the only part and contains letters/numbers, it's likely the ID
            if (parts.length === 1 && alnumPattern.test(lastPart)) {
                return lastPart.toUpperCase();
            }
        }
        
        return 'Not Assigned';
    }

    // Function to extract name from email
    function extractNameFromEmail(email) {
        if (!email) return { firstName: 'Student', lastName: '' };
        
        const emailLower = email.toLowerCase();
        const emailWithoutDomain = emailLower.replace('@umak.edu.ph', '');
        const parts = emailWithoutDomain.split('.');
        
        if (parts.length === 1) {
            // Just ID pattern (e.g., a12345758@umak.edu.ph)
            return { firstName: 'Student', lastName: '' };
        } else if (parts.length === 2) {
            // firstname.id pattern (e.g., mtapalla.a12345758)
            return { 
                firstName: capitalize(parts[0]), 
                lastName: '' 
            };
        } else if (parts.length >= 3) {
            
            const firstName = parts[0];
            const lastName = parts[parts.length - 2]; 
            
            return {
                firstName: capitalize(firstName),
                lastName: capitalize(lastName)
            };
        }
        
        return { firstName: 'Student', lastName: '' };
    }

    function calculateBMI(weight, height) {
        const heightInMeters = height / 100;
        return (weight / (heightInMeters * heightInMeters)).toFixed(2);
    }
    function getBMICategory(bmi) {
    const bmiValue = parseFloat(bmi);
    if (bmiValue < 18.5) return 'Underweight';
    if (bmiValue >= 18.5 && bmiValue < 25) return 'Normal';
    if (bmiValue >= 25 && bmiValue < 30) return 'Overweight';
    return 'Obese';
}
    async function loadStudentProfile(user) {
        try {
            console.log('Loading student profile for:', user.email);
            
            // First, try to find student by email in students collection
            const studentsQuery = query(
                collection(db, 'students'),
                where('email', '==', user.email)
            );
            const studentsSnapshot = await getDocs(studentsQuery);
            
            let studentData = null;
            let studentDocId = null;
            
            if (!studentsSnapshot.empty) {
                console.log('Found student by email query');
                studentsSnapshot.forEach((doc) => {
                    studentData = doc.data();
                    studentDocId = doc.id;
                    console.log('Student data found:', studentData);
                });
            } else {
                console.log('No student found by email, trying by UID');
                // Try to get by UID as fallback
                const studentRef = doc(db, 'students', user.uid);
                const studentDoc = await getDoc(studentRef);
                if (studentDoc.exists()) {
                    studentData = studentDoc.data();
                    studentDocId = user.uid;
                    console.log('Student data found by UID:', studentData);
                } else {
                    console.log('No student profile found at all');
                    // Create minimal student data from Firebase auth
                    // Extract UMak ID and name from email
                    const extractedId = extractUmakIdFromEmail(user.email);
                    const nameInfo = extractNameFromEmail(user.email);
                    
                    studentData = {
                        firstName: nameInfo.firstName,
                        lastName: nameInfo.lastName,
                        umakId: extractedId,
                        section: 'Not Assigned',
                        department: 'Not Assigned',
                        yearLevel: 'Not Assigned',
                        age: 0,
                        gender: 'Not Specified',
                        email: user.email,
                        contactNumber: 'Not Provided',
                        height: 0,
                        weight: 0,
                        medicalCondition: 'None',
                        emergencyContactName: 'Not provided',
                        emergencyContactNumber: 'Not provided',
                        emergencyContactRelation: 'Not provided',
                        createdAt: new Date().toISOString(),
                        lastLogin: new Date().toISOString()
                    };
                    studentDocId = user.uid;
                    console.log('Created minimal student data:', studentData);
                }
            }
            
            if (studentData) {
                window.currentStudentId = studentDocId;
                window.currentStudentData = studentData;
                
                // Update profile display
                let displayName = '';
                if (user.displayName) {
                    // Use the actual Google account display name
                    displayName = user.displayName;
                    
                    // Also update studentData with the display name for consistency
                    const nameParts = user.displayName.split(' ');
                    if (nameParts.length >= 2) {
                        studentData.firstName = nameParts[0];
                        studentData.lastName = nameParts.slice(1).join(' ');
                    } else {
                        studentData.firstName = user.displayName;
                        studentData.lastName = '';
                    }
                } else if (studentData.firstName || studentData.lastName) {
                    displayName = `${studentData.firstName || ''} ${studentData.lastName || ''}`.trim();
                } else {
                    displayName = user.email.split('@')[0];
                }

                document.getElementById('profileName').textContent = displayName;
                
                
                // Display UMak ID - if stored in database, use it, otherwise extract from email
                let displayId = studentData.umakId;
                if (!displayId || displayId === 'Not Assigned') {
                    displayId = extractUmakIdFromEmail(user.email);
                }
                document.getElementById('profileId').textContent = `ID: ${displayId}`;
                
                // Build section info
                let sectionInfo = '';
                if (studentData.section && studentData.section !== 'Not Assigned') {
                    sectionInfo = studentData.section;
                    if (studentData.department && studentData.department !== 'Not Assigned') {
                        sectionInfo += `  ${studentData.department}`;
                    }
                    if (studentData.yearLevel && studentData.yearLevel !== 'Not Assigned') {
                        sectionInfo += `  Year ${studentData.yearLevel}`;
                    }
                } else {
                    sectionInfo = 'Not Assigned';
                }
                document.getElementById('profileSection').textContent = sectionInfo;
                
                document.getElementById('profileAgeGender').textContent = 
                    `${studentData.age || 0} years - ${studentData.gender || 'Not Specified'}`;
                document.getElementById('profileEmail').textContent = 
                    studentData.email || user.email;
                document.getElementById('profileContact').textContent = 
                    studentData.contactNumber || 'Not Provided';
                document.getElementById('profileMedical').textContent = 
                    studentData.medicalCondition || 'None';
                document.getElementById('profileHeight').textContent = 
                    studentData.height || 0;
                document.getElementById('profileWeight').textContent = 
                    studentData.weight || 0;
                
                // Calculate and display BMI
                if (studentData.height && studentData.weight && studentData.height > 0 && studentData.weight > 0) {
                    const bmi = calculateBMI(studentData.weight, studentData.height);
                    document.getElementById('profileBMI').textContent = bmi;
                } else {
                    document.getElementById('profileBMI').textContent = '0.00';
                }
                
                // Account Activity
                if (studentData.lastLogin) {
                try {
                    // Handle both ISO string and Firestore Timestamp
                    let lastLoginDate;
                    if (studentData.lastLogin.toDate) {
                        lastLoginDate = studentData.lastLogin.toDate();
                    } else {
                        lastLoginDate = new Date(studentData.lastLogin);
                    }
                    
                    document.getElementById('lastLogin').textContent = lastLoginDate.toLocaleDateString('en-US', {
                        year: 'numeric',
                        month: 'long',
                        day: 'numeric',
                        hour: '2-digit',
                        minute: '2-digit'
                    });
                } catch (error) {
                    console.error('Error parsing lastLogin:', error);
                    document.getElementById('lastLogin').textContent = 'Recently';
                }
            } else {
                document.getElementById('lastLogin').textContent = 'Never';
            }

            if (studentData.createdAt) {
                try {
                    // Handle both ISO string and Firestore Timestamp
                    let createdDate;
                    if (studentData.createdAt.toDate) {
                        // Firestore Timestamp
                        createdDate = studentData.createdAt.toDate();
                    } else if (typeof studentData.createdAt === 'string') {
                        // ISO string
                        createdDate = new Date(studentData.createdAt);
                    } else if (studentData.createdAt.seconds) {
                        // Firestore Timestamp object with seconds
                        createdDate = new Date(studentData.createdAt.seconds * 1000);
                    } else {
                        // Direct Date object
                        createdDate = new Date(studentData.createdAt);
                    }
                    
                    // Check if date is valid
                    if (!isNaN(createdDate.getTime())) {
                        document.getElementById('accountCreated').textContent = createdDate.toLocaleDateString('en-US', {
                            year: 'numeric',
                            month: 'long',
                            day: 'numeric'
                        });
                    } else {
                        document.getElementById('accountCreated').textContent = 'Not Available';
                    }
                } catch (error) {
                    console.error('Error parsing createdAt:', error, studentData.createdAt);
                    document.getElementById('accountCreated').textContent = 'Not Available';
                }
            } else {
                document.getElementById('accountCreated').textContent = 'Not Available';
            }
                
                if (studentData.createdAt) {
                const createdDate = new Date(studentData.createdAt);
                document.getElementById('accountCreated').textContent = createdDate.toLocaleDateString('en-US', {
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric'
                });
            } else {
                // If no createdAt exists, use the current date as fallback
                const fallbackDate = new Date();
                document.getElementById('accountCreated').textContent = fallbackDate.toLocaleDateString('en-US', {
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric'
                });
            }
                
                
                    updateProfileUI();
                    updateProfileAvatar(); // Add this line
                    // Update last login time
                    await updateLastLogin(studentDocId);
            }
        } catch (error) {
            console.error('Error loading profile:', error);
            // Show minimal info even on error
            let displayName = '';
            if (user.displayName) {
                displayName = user.displayName;
            } else {
                const nameInfo = extractNameFromEmail(user.email);
                displayName = `${nameInfo.firstName} ${nameInfo.lastName}`.trim();
            }
            document.getElementById('profileName').textContent = displayName;
            
            // Extract ID from email even on error
            const extractedId = extractUmakIdFromEmail(user.email);
            document.getElementById('profileId').textContent = `ID: ${extractedId}`;
            
            document.getElementById('profileEmail').textContent = user.email;
            document.getElementById('lastLogin').textContent = 'Now';
            document.getElementById('accountCreated').textContent = new Date().toLocaleDateString();

             updateProfileUI();
             updateProfileAvatar();
        }
    }
            // Hamburger Menu and Drawer functionality
            const hamburger = document.getElementById('hamburger');
            const mobileDrawer = document.getElementById('mobileDrawer');
            const drawerOverlay = document.getElementById('drawerOverlay');
            const mobileNavLinks = document.querySelectorAll('.mobile-nav-link');

            // Toggle drawer
            if (hamburger) {
                hamburger.addEventListener('click', (e) => {
                    e.stopPropagation();
                    hamburger.classList.toggle('active');
                    mobileDrawer.classList.toggle('active');
                    drawerOverlay.classList.toggle('active');
                    document.body.style.overflow = mobileDrawer.classList.contains('active') ? 'hidden' : '';
                });
            }

            // Close drawer when overlay is clicked
            if (drawerOverlay) {
                drawerOverlay.addEventListener('click', () => {
                    hamburger.classList.remove('active');
                    mobileDrawer.classList.remove('active');
                    drawerOverlay.classList.remove('active');
                    document.body.style.overflow = '';
                });
            }

            // Close drawer when nav link is clicked
            mobileNavLinks.forEach(link => {
                link.addEventListener('click', () => {
                    hamburger.classList.remove('active');
                    mobileDrawer.classList.remove('active');
                    drawerOverlay.classList.remove('active');
                    document.body.style.overflow = '';
                });
            });
    async function updateLastLogin(studentId) {
        try {
            const studentRef = doc(db, 'students', studentId);
            await updateDoc(studentRef, {
                lastLogin: new Date().toISOString()
            });
            console.log('Last login updated');
        } catch (error) {
            console.error('Error updating last login:', error);
        }
    }

    onAuthStateChanged(auth, async (user) => {
        const loadingScreen = document.getElementById('loadingScreen');
        const mainContent = document.getElementById('mainContent');

        if (user) {
            try {
                await loadStudentProfile(user);
                loadingScreen.style.display = 'none';
                mainContent.style.display = 'block';
            } catch (error) {
                console.error('Error loading profile:', error);
                loadingScreen.style.display = 'none';
                mainContent.style.display = 'block';
            }
        } else {
            window.location.href = '../login/index.html';
        }
    });

    window.handleLogout = async function() {
        if (confirm('Are you sure you want to logout?')) {
            try {
                await signOut(auth);
                window.location.href = '../login/index.html';
            } catch (error) {
                console.error('Error logging out:', error);
            }
        }
    };

    window.editProfile = function() {
        const modal = new bootstrap.Modal(document.getElementById('editProfileModal'));
        
        // Populate form with current data
        const data = window.currentStudentData || {};
        document.getElementById('editAge').value = data.age || '';
        document.getElementById('editGender').value = data.gender || '';
        document.getElementById('editEmail').value = data.email || '';
        document.getElementById('editContact').value = data.contactNumber || '';
        document.getElementById('editHeight').value = data.height || '';
        document.getElementById('editWeight').value = data.weight || '';
        document.getElementById('editMedical').value = data.medicalCondition || '';
        
        modal.show();
    };

    window.saveProfile = async function() {
    const form = document.getElementById('editProfileForm');
    if (!form.checkValidity()) {
        form.reportValidity();
        return;
    }
    
    try {
        // Extract UMak ID from email when saving
        const email = document.getElementById('editEmail').value;
        const extractedId = extractUmakIdFromEmail(email);
        const nameInfo = extractNameFromEmail(email);
        
        const height = parseFloat(document.getElementById('editHeight').value) || 0;
        const weight = parseFloat(document.getElementById('editWeight').value) || 0;
        
        // Get old height and weight to check if BMI changed
        const oldHeight = window.currentStudentData?.height || 0;
        const oldWeight = window.currentStudentData?.weight || 0;
        
        let firstName = nameInfo.firstName;
        let lastName = nameInfo.lastName;

        if (auth.currentUser?.displayName) {
            const nameParts = auth.currentUser.displayName.split(' ');
            if (nameParts.length >= 2) {
                firstName = nameParts[0];
                lastName = nameParts.slice(1).join(' ');
            } else {
                firstName = auth.currentUser.displayName;
                lastName = '';
            }
        }

        const updatedData = {
            firstName: firstName,
            lastName: lastName,
            age: parseInt(document.getElementById('editAge').value) || 0,
            gender: document.getElementById('editGender').value,
            email: email,
            contactNumber: document.getElementById('editContact').value,
            height: height,
            weight: weight,
            medicalCondition: document.getElementById('editMedical').value,
            umakId: extractedId,
            updatedAt: new Date().toISOString()
        };
        
        console.log('Updating student profile:', updatedData);
        
        // Import necessary Firestore functions if not already imported
        const { collection, addDoc } = await import('https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js');
        
        // Update student profile
        const studentRef = doc(db, 'students', window.currentStudentId);
        await updateDoc(studentRef, updatedData);
        
        // Check if height and weight changed and are valid
        const bmiChanged = (height !== oldHeight || weight !== oldWeight) && height > 0 && weight > 0;
        
        if (bmiChanged) {
            // Calculate BMI
            const bmi = calculateBMI(weight, height);
            const category = getBMICategory(bmi);
            
            // Store BMI record in BMI collection
            const bmiData = {
                studentId: window.currentStudentId,
                studentName: `${nameInfo.firstName} ${nameInfo.lastName}`.trim(),
                umakId: extractedId,
                section: window.currentStudentData?.section || 'Not Assigned',
                email: email,
                height: height,
                weight: weight,
                bmi: parseFloat(bmi),
                category: category,
                testType: 'pre', // Default to pre-test, can be updated by professor later
                recordedAt: new Date().toISOString(),
                recordedBy: 'student', // Indicates this was self-recorded
                updatedAt: new Date().toISOString()
            };
            
            console.log('Creating BMI record:', bmiData);
            
            // Add to BMI collection
            await addDoc(collection(db, 'BMI'), bmiData);
            
            console.log('BMI record created successfully');
            alert('Profile and BMI record updated successfully!');
        } else {
            alert('Profile updated successfully!');
        }
        
        bootstrap.Modal.getInstance(document.getElementById('editProfileModal')).hide();
        
        // Reload profile
        const user = auth.currentUser;
        await loadStudentProfile(user);
        updateProfileUI();
        updateProfileAvatar();
    } catch (error) {
        console.error('Error updating profile:', error);
        alert('Failed to update profile. Please try again.');
    }
};

    // Notification dropdown functions
    window.toggleNotificationDropdown = function() {
        const dropdown = document.getElementById('notificationDropdown');
        dropdown.classList.toggle('show');
    };

    window.closeNotificationDropdown = function() {
        const dropdown = document.getElementById('notificationDropdown');
        dropdown.classList.remove('show');
    };

    window.viewAllNotificationsFromDropdown = function() {
        alert('View all notifications feature would open here');
        closeNotificationDropdown();
    };

    // Close dropdown when clicking outside
    document.addEventListener('click', function(event) {
        const dropdown = document.getElementById('notificationDropdown');
        const bellBtn = document.getElementById('notificationBellBtn');
        if (dropdown.classList.contains('show') && 
            !dropdown.contains(event.target) && 
            !bellBtn.contains(event.target)) {
            dropdown.classList.remove('show');
        }
    });
 
            document.addEventListener('DOMContentLoaded', () => {
    const notificationBtn = document.getElementById('notificationBellBtn');
    if (notificationBtn) {
        notificationBtn.addEventListener('click', (e) => {
            e.stopPropagation();
            toggleNotificationDropdown(e);
            setTimeout(() => {
                document.addEventListener('click', closeProfileOnClickOutside);
            }, 100);
        });
    }
});
// Profile dropdown toggle
window.toggleProfileDropdown = function() {
    const isMobile = window.innerWidth < 1024;
    const dropdown = document.getElementById(isMobile ? 'profileDropdownMobile' : 'profileDropdown');
    const notificationDropdown = document.getElementById('notificationDropdown');
    
    // Close notification dropdown when opening profile
    if (notificationDropdown) {
        notificationDropdown.classList.add('hidden');
    }
    
    dropdown.classList.toggle('hidden');
    if (!dropdown.classList.contains('hidden')) {
        setTimeout(() => {
            document.addEventListener('click', closeProfileOnClickOutside);
        }, 100);
    } else {
        document.removeEventListener('click', closeProfileOnClickOutside);
    }
};

// Close dropdowns when clicking outside
function closeProfileOnClickOutside(event) {
    const isMobile = window.innerWidth < 1024;
    const dropdown = document.getElementById(isMobile ? 'profileDropdownMobile' : 'profileDropdown');
    const notificationDropdown = document.getElementById('notificationDropdown');
    const profileBtn = document.getElementById('profilePictureBtn');
    const profileBtnMobile = document.getElementById('profilePictureBtnMobile');
    const notificationBtn = document.getElementById('notificationBellBtn');
    
    // Close profile dropdown if clicked outside
    if (!dropdown.contains(event.target) && !profileBtn?.contains(event.target) && !profileBtnMobile?.contains(event.target)) {
        dropdown.classList.add('hidden');
    }
    
    // Close notification dropdown if clicked outside
    if (notificationDropdown && !notificationDropdown.contains(event.target) && !notificationBtn?.contains(event.target)) {
        notificationDropdown.classList.add('hidden');
    }
    
    // Remove listener if both are closed
    if (dropdown.classList.contains('hidden') && (!notificationDropdown || notificationDropdown.classList.contains('hidden'))) {
        document.removeEventListener('click', closeProfileOnClickOutside);
    }
}

    // Toggle notification dropdown
    window.toggleNotificationDropdown = function(event) {
        event?.stopPropagation();
        const dropdown = document.getElementById('notificationDropdown');
        
        if (dropdown.classList.contains('hidden')) {
            dropdown.classList.remove('hidden');
            loadNotificationDropdown();
            // Close profile dropdown if open
            const profileDropdown = document.getElementById('profileDropdown');
            const profileDropdownMobile = document.getElementById('profileDropdownMobile');
            if (profileDropdown) profileDropdown.classList.add('hidden');
            if (profileDropdownMobile) profileDropdownMobile.classList.add('hidden');
        } else {
            dropdown.classList.add('hidden');
        }
    };

    window.closeNotificationDropdown = function() {
    document.getElementById('notificationDropdown').classList.add('hidden');
    };

    window.closeNotificationDropdownMobile = function() {
        document.getElementById('notificationDropdownMobile').classList.add('hidden');
    };

    window.toggleNotificationDropdownMobile = function(event) {
        event?.stopPropagation();
        const dropdown = document.getElementById('notificationDropdownMobile');

        if (dropdown.classList.contains('hidden')) {
            dropdown.classList.remove('hidden');
            loadNotificationDropdown();
            const profileDropdownMobile = document.getElementById('profileDropdownMobile');
            if (profileDropdownMobile) profileDropdownMobile.classList.add('hidden');
        } else {
            dropdown.classList.add('hidden');
        }
    };
        // Load notification dropdown
async function loadNotificationDropdown() {
    try {
        if (!window.currentStudentData || !window.currentStudentData.section) return;

        const notificationsQuery = query(
            collection(db, 'notifications'),
            where('section', '==', window.currentStudentData.section)
        );
        
        const notificationsSnapshot = await getDocs(notificationsQuery);
        const dropdownBody = document.getElementById('notificationDropdownBody');
        const dropdownBodyMobile = document.getElementById('notificationDropdownBodyMobile');
        
        if (!notificationsSnapshot.empty) {
            const notifications = [];
            notificationsSnapshot.forEach(doc => {
                notifications.push({ id: doc.id, ...doc.data() });
            });
            
            notifications.sort((a, b) => {
                const dateA = a.createdAt?.toDate?.() || new Date(0);
                const dateB = b.createdAt?.toDate?.() || new Date(0);
                return dateB - dateA;
            });
            
            let html = '';
            notifications.slice(0, 5).forEach(notification => {
                const createdDate = notification.createdAt?.toDate?.();
                const dateStr = createdDate ? createdDate.toLocaleDateString('en-US', {
                    month: 'short',
                    day: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                }) : 'Recently';
                
                html += `
                    <div class="p-4 border-b border-gray-100 hover:bg-gray-50 transition-colors cursor-pointer">
                        <strong class="text-gray-900 text-sm block mb-1 font-semibold">${notification.title || 'Notification'}</strong>
                        <p class="text-gray-600 text-sm mb-1 leading-relaxed">${notification.message || ''}</p>
                        <small class="text-gray-400 text-xs">${dateStr}</small>
                    </div>
                `;
            });
            
            dropdownBody.innerHTML = html;
            if (dropdownBodyMobile) dropdownBodyMobile.innerHTML = dropdownBody.innerHTML;
            if (dropdownBodyMobile) dropdownBodyMobile.innerHTML = html;
        } else {
            dropdownBody.innerHTML = `
                <div class="p-8 text-center text-gray-400">
                    <i class="bi bi-bell-slash text-5xl mb-3 block"></i>
                    <p class="text-gray-600">No notifications yet</p>
                </div>
            `;
        }
    } catch (error) {
        console.error('Error loading notifications:', error);
    }
}
        function updateProfileUI() {
    if (!auth.currentUser || !window.currentStudentData) return;
    
    const photoURL = auth.currentUser?.photoURL || 'https://ui-avatars.com/api/?name=' + encodeURIComponent(window.currentStudentData?.firstName || 'User') + '&background=3b82f6&color=fff&size=128';
    
    const profileBtn = document.getElementById('profilePictureBtn');
    const profileBtnMobile = document.getElementById('profilePictureBtnMobile');
    if (profileBtn) profileBtn.src = photoURL;
    if (profileBtnMobile) profileBtnMobile.src = photoURL;
    
    const dropdownPic = document.getElementById('profileDropdownPicture');
    const dropdownPicMobile = document.getElementById('profileDropdownPictureMobile');
    if (dropdownPic) dropdownPic.src = photoURL;
    if (dropdownPicMobile) dropdownPicMobile.src = photoURL;
    
    let displayName = '';
    if (auth.currentUser?.displayName) {
        displayName = auth.currentUser.displayName;
    } else if (window.currentStudentData?.firstName || window.currentStudentData?.lastName) {
        displayName = `${window.currentStudentData?.firstName || ''} ${window.currentStudentData?.lastName || ''}`.trim();
    } else {
        displayName = 'Student';
    }
    
    const dropdownName = document.getElementById('profileDropdownName');
    const dropdownNameMobile = document.getElementById('profileDropdownNameMobile');
    if (dropdownName) dropdownName.textContent = displayName;
    if (dropdownNameMobile) dropdownNameMobile.textContent = displayName;
    
    const dropdownEmail = document.getElementById('profileDropdownEmail');
    const dropdownEmailMobile = document.getElementById('profileDropdownEmailMobile');
    if (dropdownEmail) dropdownEmail.textContent = window.currentStudentData?.email || auth.currentUser?.email || '';
    if (dropdownEmailMobile) dropdownEmailMobile.textContent = window.currentStudentData?.email || auth.currentUser?.email || '';
}
        // Update profile avatar image
    function updateProfileAvatar() {
        if (!auth.currentUser) return;
        
        const photoURL = auth.currentUser.photoURL;
        const avatarImage = document.getElementById('profileAvatarImage');
        const avatarIcon = document.getElementById('profileAvatarIcon');
        
        if (photoURL) {
            avatarImage.src = photoURL;
            avatarImage.style.display = 'block';
            avatarIcon.style.display = 'none';
        } else {
            avatarImage.style.display = 'none';
            avatarIcon.style.display = 'block';
        }
    }
        // Check if redirected from test page to edit profile
window.addEventListener('DOMContentLoaded', () => {
    const urlParams = new URLSearchParams(window.location.search);
    if (urlParams.get('editProfile') === 'true') {
        // Wait for profile to load, then auto-open edit modal
        setTimeout(() => {
            if (window.currentStudentData) {
                editProfile();
                // Show a small notification
                const notification = document.createElement('div');
                notification.className = 'fixed top-4 right-4 bg-blue-500 text-white px-6 py-3 rounded-lg shadow-lg z-[10000] animate-slide-in';
                notification.innerHTML = '<i class="bi bi-info-circle me-2"></i>Please complete your profile to take tests';
                document.body.appendChild(notification);
                setTimeout(() => {
                    notification.remove();
                }, 5000);
            }
        }, 1000);
    }
});
</script>
</body>
</html>