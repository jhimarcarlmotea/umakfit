<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UMakFit - Test Details</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=Manrope:wght@600;800&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <style>
    @import url("https://cdnjs.cloudflare.com/ajax/libs/meyer-reset/2.0/reset.min.css");
    
    * {
        -webkit-font-smoothing: antialiased;
        box-sizing: border-box;
        font-family: 'Inter', sans-serif;
    }
    
    html, body {
        margin: 0;
        height: 100%;
    }
    
    button:focus-visible {
        outline: 2px solid #4a90e2 !important;
    }
    
    a {
        text-decoration: none;
    }

    body {
        background:#f8fafc;
        min-height: 100vh;
    }

    /* Navbar Styles - From first document */
    .navbar-custom {
        background: linear-gradient(180deg, rgba(30, 58, 138, 1) 0%, rgba(59, 130, 246, 1) 100%);
        padding: 20px 0;
        box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        border-bottom: none;
        height: auto;
    }

    .navbar-brand {
        display: flex;
        align-items: center;
        gap: 15px;
        margin: 0;
        padding: 0;
    }

    .navbar-brand-img {
        height: 60px;
        width: auto;
        object-fit: contain;
    }

    .navbar-brand-text {
        font-family: "Manrope", Helvetica;
        font-weight: 800;
        font-size: 28px;
        background: linear-gradient(90deg, rgba(245, 158, 11, 1) 0%, rgba(255, 229, 0, 1) 100%);
        -webkit-background-clip: text;
        background-clip: text;
        -webkit-text-fill-color: transparent;
        line-height: 1;
    }

    .nav-container {
        display: flex;
        align-items: center;
        justify-content: space-between;
        flex-wrap: wrap;
        gap: 20px;
    }

    .nav-pills-custom {
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
        padding: 0;
        margin: 0;
        list-style: none;
    }

    .nav-link-custom {
        font-family: "Manrope", Helvetica;
        font-weight: 600;
        color: #000000;
        font-size: 14px;
        padding: 12px 18px;
        border-radius: 8px;
        background-color: #ffffff;
        transition: all 0.3s;
        border: none;
        display: flex;
        align-items: center;
        gap: 8px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        text-decoration: none;
    }

    .nav-link-custom:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(0,0,0,0.15);
        color: #000000;
    }

    .nav-link-custom i {
        font-size: 14px;
    }

    .nav-link-custom.active {
        background: linear-gradient(90deg, rgba(251, 191, 36, 1) 0%, rgba(245, 158, 11, 1) 100%);
        box-shadow: 0 4px 8px rgba(245, 158, 11, 0.3);
    }

    .btn-logout-nav {
        background: linear-gradient(90deg, rgba(251, 191, 36, 1) 0%, rgba(245, 158, 11, 1) 100%);
        border: none;
        color: #000000;
        padding: 8px 20px;
        border-radius: 8px;
        font-family: "Manrope", Helvetica;
        font-weight: 600;
        font-size: 14px;
        cursor: pointer;
        transition: all 0.3s;
        box-shadow: 0 2px 4px rgba(245, 158, 11, 0.3);
        display: inline-flex;
        align-items: center;
        gap: 8px;
    }

    .btn-logout-nav:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(245, 158, 11, 0.4);
    }

    /* Main Content */
    .main-content {
    max-width: 1400px;
    margin: 0 auto;
    padding: 1.5rem; /* CHANGED from 2rem */
}

/* Back Button */
.back-button {
    display: inline-flex;
    align-items: center;
    gap: 6px; /* CHANGED from 8px */
    padding: 8px 16px; /* CHANGED from 10px 20px */
    border-radius: 8px; /* CHANGED from 13px */
    border: 1px solid #111b66;
    background-color: white;
    color: #1e3a8a;
    font-family: "Inter", Helvetica;
    font-weight: 500;
    font-size: 14px; /* CHANGED from 16px */
    cursor: pointer;
    transition: all 0.3s;
    box-shadow: 0px 2px 4px rgba(0,0,0,0.15); /* CHANGED */
    margin-bottom: 1.5rem; /* CHANGED from 2rem */
}

.back-button:hover {
    transform: translateY(-1px); /* CHANGED from -2px */
    box-shadow: 0px 4px 8px rgba(0,0,0,0.2); /* CHANGED */
}
    /* Test Header */
    .test-header {
    text-align: center;
    margin-bottom: 2rem; /* CHANGED from 3rem */
}

.test-badge {
    display: inline-block;
    background: linear-gradient(90deg, rgba(254, 243, 199, 1) 0%, rgba(253, 230, 138, 1) 100%);
    padding: 10px 32px; /* CHANGED from 12px 40px */
    border-radius: 8px; /* CHANGED from 11px */
    margin-bottom: 0.75rem; /* CHANGED from 1rem */
}

.test-badge-icon {
    width: 56px; /* CHANGED from 79px */
    height: 56px; /* CHANGED from 79px */
    margin: 0 auto;
}

.test-category {
    font-family: "Inter", Helvetica;
    font-weight: 600;
    color: #785600;
    font-size: 15px; /* CHANGED from 20px */
    text-transform: uppercase;
    letter-spacing: 0.3px; /* CHANGED from 0.5px */
}

.test-title {
    font-family: "Inter", Helvetica;
    font-weight: 700; /* CHANGED from 600 */
    color: #1e3a8a;
    font-size: 2rem; /* CHANGED from 36px */
    margin: 0.75rem 0; /* CHANGED from 1rem 0 */
    line-height: 1.3; /* ADDED */
}

.test-meta {
    font-family: "Inter", Helvetica;
    font-weight: 600;
    color: #1e3a8a;
    font-size: 15px; /* CHANGED from 20px */
}

    /* Info Cards */
    .info-cards {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 1.5rem; /* CHANGED from 2rem */
    margin-bottom: 2rem; /* CHANGED from 3rem */
}

.info-card {
    text-align: center;
}

.info-card-icon {
    width: 44px; /* CHANGED from 57px */
    height: 44px; /* CHANGED from 57px */
    margin: 0 auto 0.75rem; /* CHANGED from 1rem */
}

.info-card-title {
    font-family: "Inter", Helvetica;
    font-weight: 700; /* CHANGED from 600 */
    color: #1e3a8a;
    font-size: 17px; /* CHANGED from 24px */
    margin-bottom: 0.5rem;
    letter-spacing: 0.3px; /* ADDED */
}

.info-card-text {
    font-family: "Inter", Helvetica;
    font-weight: 500; /* CHANGED from 600 */
    color: #6b7280; /* CHANGED from #9f9f9f */
    font-size: 14px; /* CHANGED from 20px */
    line-height: 1.5; /* CHANGED from 1.6 */
}

.info-divider {
    width: 1px;
    height: 100%;
    background: linear-gradient(180deg, transparent, #e5e7eb, transparent);
}

    /* Content Sections */
   .content-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 1.5rem; /* CHANGED from 2rem */
    margin-bottom: 2rem; /* CHANGED from 3rem */
}

.content-card {
    background: white;
    border-radius: 12px; /* CHANGED from 7px */
    padding: 1.5rem; /* CHANGED from 2rem */
    box-shadow: 0px 2px 8px rgba(0,0,0,0.1); /* CHANGED */
}

.content-card-header {
    display: flex;
    align-items: center;
    gap: 0.75rem; /* CHANGED from 1rem */
    margin-bottom: 1.25rem; /* CHANGED from 1.5rem */
}

.content-card-icon {
    width: 28px; /* CHANGED from 33px */
    height: 28px; /* CHANGED from 33px */
}

.content-card-title {
    font-family: "Inter", Helvetica;
    font-weight: 700; /* CHANGED from 600 */
    color: #1e3a8a;
    font-size: 18px; /* CHANGED from 24px */
}

.video-placeholder {
    width: 100%;
    height: 220px; /* CHANGED from 279px */
    background: #f3f4f6;
    border-radius: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    margin-bottom: 0.875rem; /* CHANGED from 1rem */
}

.video-placeholder img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    border-radius: 8px;
}

.video-description {
    font-family: "Inter", Helvetica;
    font-weight: 500; /* CHANGED from 600 */
    color: #6b7280; /* CHANGED from #9f9f9f */
    font-size: 13px; /* CHANGED from 15px */
    text-align: center;
    line-height: 1.4; /* ADDED */
}
    /* Protocol Steps */
    .protocol-steps {
    display: flex;
    flex-direction: column;
    gap: 0.875rem; /* CHANGED from 1rem */
}

.protocol-step {
    display: flex;
    align-items: flex-start;
    gap: 0.875rem; /* CHANGED from 1rem */
}

.step-number {
    width: 24px; /* CHANGED from 27px */
    height: 24px; /* CHANGED from 26px */
    background-color: #3b82f6;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
    font-family: "Inter", Helvetica;
    font-weight: 600;
    color: white;
    font-size: 13px; /* CHANGED from 16px */
}

.step-text {
    font-family: "Inter", Helvetica;
    font-weight: 500; /* CHANGED from 600 */
    color: #1e3a8a;
    font-size: 13px; /* CHANGED from 14px */
    padding-top: 2px; /* CHANGED from 3px */
    line-height: 1.5; /* ADDED */
}
    /* Safety Tips */
    .safety-section {
    background: linear-gradient(90deg, rgba(254, 243, 199, 1) 0%, rgba(253, 230, 138, 1) 100%);
    border-radius: 12px; /* CHANGED from 6px */
    padding: 1.5rem; /* CHANGED from 2rem */
    margin-bottom: 2rem; /* CHANGED from 3rem */
}

.safety-header {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    margin-bottom: 1.25rem; /* CHANGED from 1.5rem */
}

.safety-icon {
    width: 20px; /* CHANGED from 23px */
    height: 20px; /* CHANGED from 23px */
}

.safety-title {
    font-family: "Inter", Helvetica;
    font-weight: 700; /* CHANGED from 600 */
    color: #785600;
    font-size: 17px; /* CHANGED from 20px */
}

.safety-tips-grid {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 0.875rem; /* CHANGED from 1rem */
}

.safety-tip {
    background: white;
    border-radius: 8px; /* CHANGED from 7px */
    padding: 0.875rem; /* CHANGED from 1rem */
    box-shadow: 0px 2px 6px rgba(0,0,0,0.15); /* CHANGED */
    text-align: center;
}

.safety-tip-text {
    font-family: "Inter", Helvetica;
    font-weight: 600;
    color: #785600;
    font-size: 14px; /* CHANGED from 20px */
    line-height: 1.4; /* ADDED */
}

    /* Start Test Button */
   .start-test-container {
    text-align: center;
    margin-top: 2rem; /* CHANGED from 3rem */
    margin-bottom: 2rem; /* ADDED */
}

.btn-start-test {
    background: linear-gradient(90deg, rgba(18, 27, 103, 1) 0%, rgba(59, 130, 246, 1) 100%);
    border: none;
    color: white;
    padding: 12px 40px; /* CHANGED from 15px 50px */
    border-radius: 8px; /* CHANGED from 5px */
    font-family: "Inter", Helvetica;
    font-weight: 600; /* CHANGED from 500 */
    font-size: 15px; /* CHANGED from 16px */
    cursor: pointer;
    transition: all 0.3s;
    box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3); /* CHANGED */
}

.btn-start-test:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 16px rgba(59, 130, 246, 0.4); /* CHANGED */
}

    /* Loading Screen */
    .loading {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(255, 255, 255, 0.98);
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 9999;
        flex-direction: column;
        gap: 20px;
    }

    .spinner {
        border: 4px solid #e5e7eb;
        border-top: 4px solid #3b82f6;
        border-radius: 50%;
        width: 50px;
        height: 50px;
        animation: spin 1s linear infinite;
    }

    @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }

    .loading-text {
        font-family: "Inter", sans-serif;
        font-weight: 500;
        color: #475569;
        font-size: 16px;
    }

    /* Responsive */
    @media (max-width: 992px) {
    .main-content {
        padding: 1.25rem; /* ADDED */
    }

    .info-cards {
        grid-template-columns: 1fr;
        gap: 1.25rem; /* ADDED */
    }
    
    .content-grid {
        grid-template-columns: 1fr;
        gap: 1.25rem; /* ADDED */
    }
    
    .safety-tips-grid {
        grid-template-columns: repeat(2, 1fr);
    }
}

@media (max-width: 768px) {
    .main-content {
        padding: 1rem; /* ADDED */
    }

    .test-badge-icon {
        width: 48px; /* ADDED */
        height: 48px; /* ADDED */
    }

    .test-title {
        font-size: 1.5rem; /* CHANGED from 28px */
    }

    .test-meta {
        font-size: 13px; /* ADDED */
    }

    .info-card-title {
        font-size: 15px; /* ADDED */
    }

    .info-card-text {
        font-size: 13px; /* ADDED */
    }

    .content-card-title {
        font-size: 16px; /* ADDED */
    }

    .video-placeholder {
        height: 180px; /* ADDED */
    }
    
    .safety-tips-grid {
        grid-template-columns: 1fr;
        gap: 0.75rem; /* ADDED */
    }

    .btn-start-test {
        padding: 10px 32px; /* ADDED */
        font-size: 14px; /* ADDED */
    }
}

@media (max-width: 576px) {
    .test-category {
        font-size: 13px; /* ADDED */
    }

    .test-title {
        font-size: 1.25rem; /* ADDED */
    }

    .safety-tip-text {
        font-size: 13px; /* ADDED */
    }
}
    </style>
</head>
<body>
    <div id="loadingScreen" class="loading">
        <div class="spinner"></div>
        <div class="loading-text">Loading Test Details...</div>
    </div>

    <div id="mainContent" style="display: none;">
        <!-- Navigation -->
        <nav class="navbar navbar-expand-lg navbar-custom">
            <div class="container">
                <div class="nav-container w-100">
                    <a class="navbar-brand" href="#">
                        <img src="https://c.animaapp.com/vkhEa8zW/img/screenshot-2025-09-19-2-53-51-pm-removebg-preview-3@2x.png" 
                             alt="UMak Logo" class="navbar-brand-img">
                        <span class="navbar-brand-text">UMakFit</span>
                    </a>
                    
                    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                        <span class="navbar-toggler-icon"></span>
                    </button>
                    
                    <div class="collapse navbar-collapse" id="navbarNav">
                        <ul class="nav-pills-custom ms-auto">
                            <li class="nav-item">
                                <a class="nav-link-custom" href="./studentDashboard.html">
                                    <i class="bi bi-speedometer2"></i> Dashboard
                                </a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link-custom" href="./studentProfile.html">
                                    <i class="bi bi-person-circle"></i> Profile
                                </a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link-custom active" href="./test.html">
                                    <i class="bi bi-clipboard-check"></i> Test
                                </a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link-custom" href="./progress.html">
                                    <i class="bi bi-graph-up"></i> Progress
                                </a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link-custom" href="#">
                                    <i class="bi bi-book"></i> Learn
                                </a>
                            </li>
                            <li class="nav-item d-flex align-items-center gap-2 ms-2">
                                <button class="btn-logout-nav" onclick="handleLogout()">
                                    <i class="bi bi-box-arrow-right"></i> Logout
                                </button>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </nav>

        <div class="main-content">
            <!-- Back Button -->
            <button class="back-button" onclick="window.history.back()">
                <i class="bi bi-arrow-left"></i> Back to test
            </button>

            <!-- Test Header -->
            <div class="test-header">
                <div class="test-badge">
                    <img class="test-badge-icon" id="testBadgeIcon" src="https://c.animaapp.com/pVU46Rgb/img/image-152@2x.png" alt="Test Icon">
                </div>
                <div class="test-category" id="testCategory">LOADING...</div>
                <h1 class="test-title" id="testTitle">Loading Test...</h1>
                <div class="test-meta" id="testMeta">‚è±Ô∏è Duration: Loading... | üéØ Difficulty: Loading...</div>
            </div>

            <!-- Info Cards -->
            <div class="info-cards">
                <div class="info-card">
                    <img class="info-card-icon" id="objectiveIcon" src="https://c.animaapp.com/HN7hFbsr/img/image-148@2x.png" alt="Objective Icon">
                    <h3 class="info-card-title">OBJECTIVE</h3>
                    <p class="info-card-text" id="objectiveText">Loading objective...</p>
                </div>
                
                <div class="info-card">
                    <img class="info-card-icon" id="scoringIcon" src="https://c.animaapp.com/HN7hFbsr/img/image-157@2x.png" alt="Scoring Icon">
                    <h3 class="info-card-title">SCORING</h3>
                    <p class="info-card-text" id="scoringText">Loading scoring information...</p>
                </div>
                
                <div class="info-card">
                    <img class="info-card-icon" id="requirementsIcon" src="https://c.animaapp.com/HN7hFbsr/img/image-158@2x.png" alt="Requirements Icon">
                    <h3 class="info-card-title">REQUIREMENTS</h3>
                    <p class="info-card-text" id="requirementsText">Loading requirements...</p>
                </div>
            </div>

            <!-- Content Grid -->
            <div class="content-grid">
                <!-- Video Demonstration -->
                <div class="content-card">
                    <div class="content-card-header">
                        <img class="content-card-icon" src="https://c.animaapp.com/pVU46Rgb/img/image-159@2x.png" alt="Video Icon">
                        <h2 class="content-card-title">Video Demonstration</h2>
                    </div>
                    <div class="video-placeholder">
                        <img id="testVideo" src="https://c.animaapp.com/pVU46Rgb/img/image-82.png" alt="Test demonstration">
                    </div>
                    <p class="video-description" id="videoDescription">Loading video description...</p>
                </div>

                <!-- Test Protocol -->
                <div class="content-card">
                    <div class="content-card-header">
                        <img class="content-card-icon" src="https://c.animaapp.com/pVU46Rgb/img/image-160@2x.png" alt="Protocol Icon">
                        <h2 class="content-card-title">Test Protocol</h2>
                    </div>
                    <div class="protocol-steps" id="protocolSteps">
                        <!-- Protocol steps will be dynamically inserted here -->
                    </div>
                </div>
            </div>

            <!-- Safety Tips -->
            <div class="safety-section">
                <div class="safety-header">
                    <img class="safety-icon" src="https://c.animaapp.com/pVU46Rgb/img/image-161@2x.png" alt="Safety Icon">
                    <h3 class="safety-title">Safety Tips</h3>
                </div>
                <div class="safety-tips-grid" id="safetyTipsGrid">
                    <!-- Safety tips will be dynamically inserted here -->
                </div>
            </div>

            <!-- Start Test Button -->
            <div class="start-test-container">
                <button class="btn-start-test" id="startTestBtn" onclick="startTest()">Start Test Now</button>
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getAuth, onAuthStateChanged, signOut } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';
        import { getFirestore, doc, getDoc } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';

        const firebaseConfig = {
            apiKey: "AIzaSyAgaLunqEf2gs6dSpF_sz1hV5XQ5Wm52jo",
            authDomain: "umakfit-e3b1d.firebaseapp.com",
            projectId: "umakfit-e3b1d",
            storageBucket: "umakfit-e3b1d.appspot.com",
            messagingSenderId: "276569891504",
            appId: "1:276569891504:web:39b1732b519f4d8b785175"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        let currentUser = null;
        let currentTest = null;

        // Test data mapping
        const testData = {
    'Push-Up Test': {
        category: 'STRENGTH TEST',
        icon: 'https://c.animaapp.com/HN7hFbsr/img/image-149@2x.png',
        badgeIcon: 'https://c.animaapp.com/pVU46Rgb/img/image-152@2x.png',
        getDuration: (target) => target ? `Target: ${target} push-ups` : '1 minute',
        difficulty: 'Intermediate',
        objective: 'Measure upper body muscular endurance by performing maximum push-ups in 1 minute',
        scoring: 'Based on number of proper form push-ups completed. Score improves with consistency',
        requirements: 'Open space, mat optional, timer ready, proper warm-up completed',
        video: 'https://c.animaapp.com/pVU46Rgb/img/image-82.png',
        videoDescription: 'Watch this video to learn proper push-up form and technique',
        protocol: [
            'Lie face down with hands shoulder-width apart',
            'Keep body straight from head to heels',
            'Lower until chest nearly touches floor',
            'Push up until arms fully extended',
            'Perform maximum reps in 1 minute',
            'Record your total count'
        ],
        safetyTips: [
            'Keep core engaged',
            'Maintain proper form',
            'Breathe consistently',
            'Stop if pain occurs'
        ]
    },
    '3-Minute Step Test': {
        category: 'CARDIO ENDURANCE TEST',
        icon: 'https://c.animaapp.com/HN7hFbsr/img/image-148@2x.png',
        badgeIcon: 'https://c.animaapp.com/pVU46Rgb/img/image-152@2x.png',
        getDuration: (target) => target ? `${target} minutes` : '3 minutes',
        difficulty: 'Beginner',
        objective: 'Measure cardiovascular endurance by stepping up and down on a platform for 3 minutes',
        scoring: 'Based on heart rate recovery after the test. Lower recovery heart rate indicates better fitness',
        requirements: '12-inch step platform, timer, heart rate monitor (optional)',
        video: 'https://c.animaapp.com/pVU46Rgb/img/image-82.png',
        videoDescription: 'Watch this video to learn proper step test technique',
        protocol: [
            'Find a 12-inch step or platform',
            'Step up with right foot, then left foot',
            'Step down with right foot, then left foot',
            'Maintain a steady pace of 24 steps per minute',
            'Continue for exactly 3 minutes',
            'Measure heart rate immediately after'
        ],
        safetyTips: [
            'Use a stable platform',
            'Wear supportive shoes',
            'Stop if feeling dizzy',
            'Keep a steady pace'
        ]
    },
    'Sit-and-Reach': {
        category: 'FLEXIBILITY TEST',
        icon: 'https://c.animaapp.com/HN7hFbsr/img/image-48@2x.png',
        badgeIcon: 'https://c.animaapp.com/pVU46Rgb/img/image-152@2x.png',
        getDuration: (target) => target ? `Target: ${target} cm` : '2 minutes',
        difficulty: 'Beginner',
        objective: 'Measure flexibility of the lower back and hamstring muscles',
        scoring: 'Based on how far you can reach beyond your toes. Further reach indicates better flexibility',
        requirements: 'Sit-and-reach box or tape measure, flat surface',
        video: 'https://c.animaapp.com/pVU46Rgb/img/image-82.png',
        videoDescription: 'Watch this video to learn proper sit-and-reach technique',
        protocol: [
            'Sit on floor with legs extended straight ahead',
            'Place feet flat against the box or measuring point',
            'Slowly reach forward with both hands',
            'Hold the stretch for 2 seconds',
            'Record the farthest point reached',
            'Perform 3 attempts and record the best'
        ],
        safetyTips: [
            'Warm up properly',
            'Avoid bouncing',
            'Stretch slowly and steadily',
            'Stop if you feel sharp pain'
        ]
    },
    'Plank Hold': {
        category: 'CORE STABILITY TEST',
        icon: 'https://c.animaapp.com/HN7hFbsr/img/image-150@2x.png',
        badgeIcon: 'https://c.animaapp.com/pVU46Rgb/img/image-152@2x.png',
        getDuration: (target) => target ? `Target: ${target} seconds` : 'Maximum hold',
        difficulty: 'Intermediate',
        objective: 'Measure core endurance by holding a plank position for as long as possible',
        scoring: 'Based on time held in proper form. Longer hold indicates better core endurance',
        requirements: 'Mat or soft surface, timer',
        video: 'https://c.animaapp.com/pVU46Rgb/img/image-82.png',
        videoDescription: 'Watch this video to learn proper plank form',
        protocol: [
            'Start in push-up position on forearms',
            'Keep body straight from head to heels',
            'Engage core and glute muscles',
            'Hold position without sagging or raising hips',
            'Breathe steadily throughout',
            'Record time when form breaks'
        ],
        safetyTips: [
            'Keep hips level',
            'Don\'t hold your breath',
            'Stop if back hurts',
            'Engage core muscles'
        ]
    }
};

        function getTestData(testName) {
    // Return test data based on test name
    return testData[testName] || {
        category: 'FITNESS TEST',
        icon: 'https://c.animaapp.com/HN7hFbsr/img/image-148@2x.png',
        badgeIcon: 'https://c.animaapp.com/pVU46Rgb/img/image-152@2x.png',
        getDuration: () => 'Varies',
        difficulty: 'Moderate',
        objective: 'Complete the test according to instructions',
        scoring: 'Based on performance metrics',
        requirements: 'Follow test-specific requirements',
        video: 'https://c.animaapp.com/pVU46Rgb/img/image-82.png',
        videoDescription: 'Watch this video for demonstration',
        protocol: ['Follow the test instructions carefully'],
        safetyTips: ['Warm up properly', 'Stop if you feel pain', 'Maintain proper form', 'Stay hydrated']
    };
}
        function getTargetLabel(testName) {
    const normalized = testName.toLowerCase();
    if (normalized.includes('push-up') || normalized.includes('pushup')) return 'push-ups';
    if (normalized.includes('sit-up') || normalized.includes('situp')) return 'sit-ups';
    if (normalized.includes('plank')) return 'seconds';
    if (normalized.includes('step test')) return 'minutes';
    if (normalized.includes('sit-and-reach')) return 'cm';
    return 'units';
}
        function populateTestDetails(test) {
    const testInfo = getTestData(test.testName);
    
    // Update header
    document.getElementById('testBadgeIcon').src = testInfo.badgeIcon;
    document.getElementById('testCategory').textContent = testInfo.category;
    document.getElementById('testTitle').textContent = test.testName;
    
    // Update meta with dynamic duration based on target
    const duration = typeof testInfo.getDuration === 'function' 
        ? testInfo.getDuration(test.testTarget) 
        : testInfo.duration;
    document.getElementById('testMeta').textContent = `‚è±Ô∏è Duration: ${duration} | üéØ Difficulty: ${testInfo.difficulty}`;
    
    // Update info cards
    document.getElementById('objectiveIcon').src = testInfo.icon;
    document.getElementById('objectiveText').textContent = testInfo.objective;
    document.getElementById('scoringIcon').src = testInfo.icon;
    document.getElementById('scoringText').textContent = testInfo.scoring;
    document.getElementById('requirementsIcon').src = testInfo.icon;
    
    // Update requirements text to include target if available
    let requirementsText = testInfo.requirements;
    if (test.testTarget) {
        const targetLabel = getTargetLabel(test.testName);
        requirementsText += ` | Target: ${test.testTarget} ${targetLabel}`;
    }
    document.getElementById('requirementsText').textContent = requirementsText;
    
    // UPDATE VIDEO SECTION - Use uploaded video if available
    const videoPlaceholder = document.querySelector('.video-placeholder');
if (test.videoURL) {
    // Show video thumbnail with play button overlay
    let videoId = '';
    
    // Handle different YouTube URL formats
    if (test.videoURL.includes('youtube.com/watch?v=')) {
        videoId = test.videoURL.split('v=')[1].split('&')[0];
    } else if (test.videoURL.includes('youtu.be/')) {
        videoId = test.videoURL.split('youtu.be/')[1].split('?')[0];
    } else if (test.videoURL.includes('youtube.com/embed/')) {
        videoId = test.videoURL.split('embed/')[1].split('?')[0];
    }
    
    if (videoId) {
        // Create clickable thumbnail with YouTube thumbnail
        videoPlaceholder.innerHTML = `
            <div style="position: relative; width: 100%; height: 100%; cursor: pointer; border-radius: 8px; overflow: hidden;" onclick="window.open('${test.videoURL}', '_blank')">
                <img src="https://img.youtube.com/vi/${videoId}/maxresdefault.jpg" 
                     alt="Video Thumbnail" 
                     style="width: 100%; height: 100%; object-fit: cover;"
                     onerror="this.src='https://img.youtube.com/vi/${videoId}/hqdefault.jpg'">
                <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); 
                            background: rgba(255, 0, 0, 0.9); width: 80px; height: 80px; 
                            border-radius: 50%; display: flex; align-items: center; justify-content: center;
                            box-shadow: 0 4px 12px rgba(0,0,0,0.3);">
                    <div style="width: 0; height: 0; border-left: 25px solid white; 
                                border-top: 15px solid transparent; border-bottom: 15px solid transparent;
                                margin-left: 5px;"></div>
                </div>
                <div style="position: absolute; bottom: 0; left: 0; right: 0; 
                            background: linear-gradient(to top, rgba(0,0,0,0.8), transparent); 
                            padding: 20px; color: white; font-weight: 600;">
                    üé• Click to Watch on YouTube
                </div>
            </div>
        `;
        document.getElementById('videoDescription').textContent = 'üì∫ Click the video to watch the instruction from your professor';
    } else {
        // Fallback if video ID extraction fails
        videoPlaceholder.innerHTML = `
            <div style="padding: 40px; text-align: center; background: #fee2e2; border-radius: 8px;">
                <div style="font-size: 48px; margin-bottom: 15px;">‚ö†Ô∏è</div>
                <p style="color: #991b1b; font-weight: 600; margin: 0 0 10px 0; font-size: 16px;">
                    Video URL format not supported
                </p>
                <p style="color: #7f1d1d; font-size: 13px; margin: 0;">
                    Please contact your professor
                </p>
            </div>
        `;
        document.getElementById('videoDescription').textContent = 'Unable to load video';
    }
} else {
    // Use default placeholder image
    videoPlaceholder.innerHTML = `
        <div style="display: flex; align-items: center; justify-content: center; flex-direction: column; gap: 15px; padding: 40px; background: #f3f4f6; border-radius: 8px;">
            <div style="font-size: 64px; opacity: 0.5;">üìπ</div>
            <p style="color: #6b7280; font-size: 15px; margin: 0; font-weight: 500;">
                No instruction video available for this test
            </p>
        </div>
    `;
    document.getElementById('videoDescription').textContent = testInfo.videoDescription;
}
    
    // Update protocol steps
    const protocolStepsContainer = document.getElementById('protocolSteps');
    protocolStepsContainer.innerHTML = '';
    testInfo.protocol.forEach((step, index) => {
        const stepElement = document.createElement('div');
        stepElement.className = 'protocol-step';
        stepElement.innerHTML = `
            <div class="step-number">${index + 1}</div>
            <div class="step-text">${step}</div>
        `;
        protocolStepsContainer.appendChild(stepElement);
    });
    
    // Update safety tips
    const safetyTipsContainer = document.getElementById('safetyTipsGrid');
    safetyTipsContainer.innerHTML = '';
    testInfo.safetyTips.forEach(tip => {
        const tipElement = document.createElement('div');
        tipElement.className = 'safety-tip';
        tipElement.innerHTML = `<p class="safety-tip-text">${tip}</p>`;
        safetyTipsContainer.appendChild(tipElement);
    });
    
    // Store test ID for starting the test
    document.getElementById('startTestBtn').setAttribute('data-test-id', test.id);
}
       
        async function loadTestDetails(testId) {
            try {
                const testDoc = await getDoc(doc(db, 'scheduledTests', testId));
                if (testDoc.exists()) {
                    currentTest = { id: testDoc.id, ...testDoc.data() };
                    populateTestDetails(currentTest);
                } else {
                    console.error('Test not found');
                    alert('Test not found. Please try again.');
                    window.history.back();
                }
            } catch (error) {
                console.error('Error loading test details:', error);
                alert('Error loading test details. Please try again.');
                window.history.back();
            }
        }

        function getUrlParams() {
            const urlParams = new URLSearchParams(window.location.search);
            return {
                testId: urlParams.get('testId'),
                testName: urlParams.get('testName')
            };
        }

        onAuthStateChanged(auth, async (user) => {
            const loadingScreen = document.getElementById('loadingScreen');
            const mainContent = document.getElementById('mainContent');

            if (user) {
                try {
                    currentUser = user;
                    const { testId } = getUrlParams();
                    
                    if (testId) {
                        await loadTestDetails(testId);
                    } else {
                        alert('No test specified. Redirecting to test page.');
                        window.location.href = './test.html';
                    }
                    
                    loadingScreen.style.display = 'none';
                    mainContent.style.display = 'block';
                } catch (error) {
                    console.error('Error loading page:', error);
                    alert('Error loading page. Please try again.');
                }
            } else {
                window.location.href = '../login/index.html';
            }
        });

        window.handleLogout = async function() {
            if (confirm('Are you sure you want to logout?')) {
                try {
                    await signOut(auth);
                    window.location.href = '../login/index.html';
                } catch (error) {
                    console.error('Error logging out:', error);
                    alert('Error logging out. Please try again.');
                }
            }
        };

       window.startTest = function() {
    if (currentTest) {
        // Navigate to the actual test taking page
        window.location.href = `./activetest.html?testId=${currentTest.id}&testName=${encodeURIComponent(currentTest.testName)}`;
    } else {
        alert('Test data not loaded. Please try again.');
    }
};
    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>