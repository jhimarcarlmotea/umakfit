<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UMakFit - Test Result</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=Manrope:wght@600;800&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <style>
    @import url("https://cdnjs.cloudflare.com/ajax/libs/meyer-reset/2.0/reset.min.css");
    
    * {
        -webkit-font-smoothing: antialiased;
        box-sizing: border-box;
        font-family: 'Inter', sans-serif;
    }
    
    html, body {
        margin: 0;
        height: 100%;
    }
    
    button:focus-visible {
        outline: 2px solid #4a90e2 !important;
    }
    
    a {
        text-decoration: none;
    }

    body {
    background: #f8fafc;
    min-height: 100vh;
}

    .font-manrope { 
    font-family: 'Manrope', sans-serif; 
}

    @keyframes slideDown {
        from {
            opacity: 0;
            transform: translateY(-10px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    .slide-down {
        animation: slideDown 0.3s ease;
    }
    /* Main Content */
    .main-content {
        max-width: 1200px;
        margin: 0 auto;
        padding: 2rem;
    }

    /* Result Container */
    .result-container {
    background: white;
    border-radius: 24px;
    padding: 0;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
    margin-bottom: 2rem;
    overflow: hidden;
    border: 1px solid #e2e8f0;
}

    /* Hero Section with Score */
    .hero-section {
    background: white;
    padding: 3rem 2rem;
    text-align: center;
    position: relative;
    border-bottom: 1px solid #e2e8f0;
}

.hero-section::before {
    display: none;
}

    @keyframes pulse {
        0%, 100% { transform: scale(1); opacity: 1; }
        50% { transform: scale(1.1); opacity: 0.8; }
    }

    .hero-content {
        position: relative;
        z-index: 1;
    }

    .completion-badge {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    background: #f0fdf4;
    padding: 10px 24px;
    border-radius: 50px;
    margin-bottom: 1.5rem;
    border: 1px solid #86efac;
}

.completion-badge span {
    font-family: "Inter", Helvetica;
    font-weight: 600;
    color: #059669;
    font-size: 14px;
    text-transform: uppercase;
    letter-spacing: 1px;
}

    .score-wrapper {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 2rem;
        margin: 2rem 0;
    }

    .score-circle {
    position: relative;
    width: 200px;
    height: 200px;
    }

    .score-ring-bg {
        fill: none;
        stroke: #f1f5f9;
        stroke-width: 16;
    }

    .score-ring-progress {
        fill: none;
        stroke: url(#scoreGradient);
        stroke-width: 16;
        stroke-linecap: round;
        stroke-dasharray: 565;
        stroke-dashoffset: 565;
        animation: fillScore 2s ease-out forwards;
    }

    @keyframes fillScore {
        to {
            stroke-dashoffset: calc(565 - (565 * var(--score)) / 100);
        }
    }


    .score-content {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        text-align: center;
    }

   .score-number {
    font-family: "Inter", Helvetica;
    font-weight: 800;
    font-size: 4rem;
    color: #1e293b;
    line-height: 1;
    }

    .score-label {
        font-family: "Inter", Helvetica;
        font-weight: 600;
        color: #64748b;
        font-size: 14px;
        text-transform: uppercase;
        letter-spacing: 1px;
        margin-top: 8px;
    }

    .score-details {
        text-align: left;
    }

    .test-title {
    font-family: "Inter", Helvetica;
    font-weight: 800;
    color: #1e293b;
    font-size: 2rem;
    margin-bottom: 1rem;
}

    .score-rating {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        padding: 12px 24px;
        border-radius: 50px;
        font-family: "Inter", Helvetica;
        font-weight: 700;
        font-size: 16px;
        text-transform: uppercase;
        letter-spacing: 1px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        backdrop-filter: blur(10px);
        border: 2px solid rgba(255, 255, 255, 0.3);
    }

    .rating-excellent {
    background: #f0fdf4;
    color: #059669;
    border: 2px solid #86efac;
    }

    .rating-good {
        background: #eff6ff;
        color: #2563eb;
        border: 2px solid #93c5fd;
    }

    .rating-fair {
        background: #fffbeb;
        color: #d97706;
        border: 2px solid #fcd34d;
    }

    .rating-needs-improvement {
        background: #fef2f2;
        color: #dc2626;
        border: 2px solid #fca5a5;
    }

    .stat-badge {
    background: #f8fafc;
    padding: 16px 24px;
    border-radius: 12px;
    border: 1px solid #e2e8f0;
}

.stat-badge-value {
    font-family: "Inter", Helvetica;
    font-weight: 700;
    color: #1e293b;
    font-size: 18px;
}

    /* Content Section */
    .content-section {
        padding: 3rem 2rem;
    }

    /* Details Grid */
    .details-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 1.5rem;
        margin-bottom: 2rem;
    }

    .detail-card {
        background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
        border-radius: 16px;
        padding: 1.5rem;
        border-left: 4px solid #667eea;
        transition: all 0.3s;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
    }

    .detail-card:hover {
        transform: translateY(-4px);
        box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
    }

    .detail-icon {
        font-size: 24px;
        margin-bottom: 0.5rem;
    }

    .detail-label {
        font-family: "Inter", Helvetica;
        font-weight: 700;
        color: #64748b;
        font-size: 12px;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        margin-bottom: 0.5rem;
    }

    .detail-value {
        font-family: "Inter", Helvetica;
        font-weight: 700;
        color: #1e293b;
        font-size: 18px;
        word-break: break-word;
    }

    /* Recommendation Section */
    .recommendation-section {
    background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
    border-radius: 16px;
    padding: 2rem;
    margin-bottom: 2rem;
    border: 2px solid #bae6fd;
    box-shadow: 0 2px 8px rgba(14, 165, 233, 0.1);
}

.recommendation-title {
    font-family: "Inter", Helvetica;
    font-weight: 700;
    color: #0c4a6e;
    font-size: 20px;
    margin: 0;
}

.recommendation-text {
    font-family: "Inter", Helvetica;
    font-weight: 500;
    color: #075985;
    font-size: 15px;
    line-height: 1.8;
    margin: 0;
}

.loading-recommendation {
    display: flex;
    align-items: center;
    gap: 10px;
    color: #0c4a6e;
}

.loading-spinner {
    width: 20px;
    height: 20px;
    border: 3px solid #e0f2fe;
    border-top: 3px solid #0ea5e9;
    border-radius: 50%;
    animation: spin 1s linear infinite;
}

    @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }

    /* Action Buttons */
    .action-buttons {
        display: flex;
        gap: 1rem;
        justify-content: center;
        flex-wrap: wrap;
    }

    .btn-action {
        padding: 16px 36px;
        border-radius: 12px;
        border: none;
        font-family: "Inter", Helvetica;
        font-weight: 700;
        font-size: 15px;
        cursor: pointer;
        transition: all 0.3s;
        display: inline-flex;
        align-items: center;
        gap: 10px;
        text-decoration: none;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    }

    .btn-primary {
    background: #1e293b;
    color: white;
    box-shadow: 0 4px 12px rgba(30, 41, 59, 0.25);
    }

    .btn-primary:hover {
        background: #334155;
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(30, 41, 59, 0.35);
        color: white;
    }

    .btn-secondary {
        background: white;
        color: #1e293b;
        border: 2px solid #e2e8f0;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
    }

    .btn-secondary:hover {
        background: #f8fafc;
        transform: translateY(-2px);
        box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1);
        color: #1e293b;
    }

    /* Loading Screen */
    .loading {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: white;
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 9999;
    flex-direction: column;
    gap: 24px;
    }

    .spinner {
        border: 5px solid #f1f5f9;
        border-top: 5px solid #3b82f6;
        border-radius: 50%;
        width: 60px;
        height: 60px;
        animation: spin 1s linear infinite;
    }

    .loading-text {
        font-family: "Inter", sans-serif;
        font-weight: 600;
        color: #1e293b;
        font-size: 18px;
    }

    /* Responsive */
    @media (max-width: 768px) {
        .main-content {
            padding: 1rem;
        }

        .hero-section {
            padding: 2rem 1rem;
        }

        .score-wrapper {
            flex-direction: column;
            gap: 1.5rem;
        }

        .score-details {
            text-align: center;
        }

        .test-title {
            font-size: 1.5rem;
        }

        .score-circle {
            width: 150px;
            height: 150px;
        }

        .score-number {
            font-size: 2.5rem;
        }

        .stat-badges {
            justify-content: center;
        }

        .details-grid {
            grid-template-columns: 1fr;
        }

        .action-buttons {
            flex-direction: column;
        }

        .btn-action {
            width: 100%;
            justify-content: center;
        }
    }
        /* Hamburger Menu Styles */
        .hamburger {
            display: none;
            flex-direction: column;
            gap: 4px;
            cursor: pointer;
            z-index: 60;
        }

        .hamburger span {
            width: 25px;
            height: 3px;
            background: linear-gradient(135deg, #EAD38A 0%, #C5A046 50%, #8B6D2D 100%);
            border-radius: 2px;
            transition: all 0.3s ease;
        }

        .hamburger.active span:nth-child(1) {
            transform: rotate(45deg) translate(5px, 5px);
        }

        .hamburger.active span:nth-child(2) {
            opacity: 0;
        }

        .hamburger.active span:nth-child(3) {
            transform: rotate(-45deg) translate(7px, -6px);
        }

        /* Mobile Drawer */
        .mobile-drawer {
            position: fixed;
            top: 0;
            right: -100%;
            width: 280px;
            height: 100vh;
            background: linear-gradient(135deg, #0D1B2A 0%, #1A2B3C 50%, #2C4A5E 100%);
            z-index: 55;
            transition: right 0.3s ease;
            box-shadow: -5px 0 15px rgba(0, 0, 0, 0.3);
            overflow-y: auto;
        }

        .mobile-drawer.active {
            right: 0;
        }

        .drawer-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100vh;
            background: rgba(0, 0, 0, 0.5);
            z-index: 50;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }

        .drawer-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        @media (max-width: 1023px) {
            .hamburger {
                display: flex;
            }
        }
    </style>
</head>
<body>
    <div id="loadingScreen" class="loading">
        <div class="spinner"></div>
        <div class="loading-text">Processing your results...</div>
    </div>

    <div id="mainContent" style="display: none;">
        <!-- Navigation -->
<nav class="shadow-lg" style="background: linear-gradient(135deg, #0D1B2A 0%, #1A2B3C 50%, #2C4A5E 100%);">
    <div class="container mx-auto px-3 sm:px-4 py-4 sm:py-5">
        <div class="flex flex-wrap items-center justify-between gap-3 sm:gap-4">
            <!-- Logo -->
            <a href="#" class="flex items-center gap-2 sm:gap-3">
                <img src="UMakfit Logo (2).png" 
                     alt="UMak Logo" class="h-12 sm:h-14 md:h-16 w-auto object-contain">
                <span class="text-xl sm:text-2xl md:text-3xl font-extrabold font-manrope" style="background: linear-gradient(135deg, #EAD38A 0%, #C5A046 50%, #8B6D2D 100%); -webkit-background-clip: text; background-clip: text; -webkit-text-fill-color: transparent;">
                    UMakFit
                </span>
            </a>
            
            <!-- Desktop Navigation -->
            <div class="hidden lg:flex items-center gap-2 flex-wrap">
                <a href="./studentDashboard.html" class="px-3 xl:px-4 py-2.5 xl:py-3 bg-white/20 text-white rounded-lg font-semibold text-sm flex items-center gap-2 hover:bg-white/30 transition-all">
                    <i class="bi bi-speedometer2"></i> 
                    <span class="hidden xl:inline">Dashboard</span>
                </a>
                <a href="./test.html" class="px-3 xl:px-4 py-2.5 xl:py-3 bg-white text-gray-900 rounded-lg font-semibold text-sm flex items-center gap-2 shadow-sm hover:shadow-md hover:-translate-y-0.5 transition-all">
                    <i class="bi bi-clipboard-check"></i> 
                    <span class="hidden xl:inline">Test</span>
                </a>
                <a href="./studentlesson.html" class="px-3 xl:px-4 py-2.5 xl:py-3 bg-white/20 text-white rounded-lg font-semibold text-sm flex items-center gap-2 hover:bg-white/30 transition-all">
                    <i class="bi bi-book"></i> 
                    <span class="hidden xl:inline">Lesson</span>
                </a>
                <a href="./studentgrades.html" class="px-3 xl:px-4 py-2.5 xl:py-3 bg-white/20 text-white rounded-lg font-semibold text-sm flex items-center gap-2 hover:bg-white/30 transition-all">
                    <i class="bi bi-award"></i> 
                    <span class="hidden xl:inline">Grades</span>
                </a>
                <a href="./progress.html" class="px-3 xl:px-4 py-2.5 xl:py-3 bg-white/20 text-white rounded-lg font-semibold text-sm flex items-center gap-2 hover:bg-white/30 transition-all">
                    <i class="bi bi-graph-up"></i> 
                    <span class="hidden xl:inline">Progress</span>
                </a>
                <a href="./achievements.html" class="px-3 xl:px-4 py-2.5 xl:py-3 bg-white/20 text-white rounded-lg font-semibold text-sm flex items-center gap-2 hover:bg-white/30 transition-all">
                    <i class="bi bi-trophy"></i> 
                    <span class="hidden xl:inline">Achievements</span>
                </a>
                
                <!-- Profile Dropdown -->
                <div class="relative">
                    <img src="" alt="Profile" id="profilePictureBtn" onclick="toggleProfileDropdown()"
                         class="w-9 h-9 xl:w-10 xl:h-10 rounded-full border-2 border-white/30 cursor-pointer hover:border-white/60 hover:scale-105 transition-all object-cover">
                    
                    <div id="profileDropdown" class="hidden absolute right-0 mt-2 w-64 sm:w-72 bg-white rounded-xl shadow-2xl z-[9999] slide-down">
                        <div class="p-4 sm:p-6 border-b-2 border-gray-200 text-center">
                            <img src="" alt="Profile" id="profileDropdownPicture" class="w-16 h-16 sm:w-20 sm:h-20 rounded-full mx-auto mb-2 sm:mb-3 border-3 border-blue-500 object-cover">
                            <h6 id="profileDropdownName" class="font-bold text-gray-900 text-base sm:text-lg">Loading...</h6>
                            <p id="profileDropdownEmail" class="text-xs sm:text-sm text-gray-500 mt-1 truncate px-2">Loading...</p>
                        </div>
                        <div class="p-2">
                            <a href="./studentProfile.html" class="flex items-center gap-3 px-3 sm:px-4 py-2.5 sm:py-3 rounded-lg hover:bg-gray-100 transition-colors">
                                <i class="bi bi-person-circle text-blue-500 text-lg sm:text-xl"></i>
                                <span class="font-medium text-gray-700 text-sm sm:text-base">View Profile</span>
                            </a>
                            <div class="h-px bg-gray-200 my-1 sm:my-2"></div>
                            <div onclick="handleLogout()" class="flex items-center gap-3 px-3 sm:px-4 py-2.5 sm:py-3 rounded-lg hover:bg-red-50 transition-colors cursor-pointer text-red-500">
                                <i class="bi bi-box-arrow-right text-lg sm:text-xl"></i>
                                <span class="font-medium text-sm sm:text-base">Logout</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Mobile Right Icons -->
<div class="flex lg:hidden items-center gap-2 sm:gap-3">
    <!-- Mobile Profile -->
    <div class="relative">
        <img src="" alt="Profile" id="profilePictureBtnMobile" onclick="toggleProfileDropdown()"
            class="w-9 h-9 sm:w-10 sm:h-10 rounded-full border-2 border-white/30 cursor-pointer hover:border-white/60 object-cover">
        
        <!-- Mobile Profile Dropdown -->
        <div id="profileDropdownMobile" class="hidden fixed right-2 top-20 w-64 sm:w-72 bg-white rounded-xl shadow-2xl z-[9999] slide-down">
            <div class="p-4 sm:p-6 border-b-2 border-gray-200 text-center">
                <img src="" alt="Profile" id="profileDropdownPictureMobile" class="w-16 h-16 sm:w-20 sm:h-20 rounded-full mx-auto mb-2 sm:mb-3 border-3 border-blue-500 object-cover">
                <h6 id="profileDropdownNameMobile" class="font-bold text-gray-900 text-base sm:text-lg">Loading...</h6>
                <p id="profileDropdownEmailMobile" class="text-xs sm:text-sm text-gray-500 mt-1 truncate px-2">Loading...</p>
            </div>
            <div class="p-2">
                <a href="./studentProfile.html" class="flex items-center gap-3 px-3 sm:px-4 py-2.5 sm:py-3 rounded-lg hover:bg-gray-100 transition-colors">
                    <i class="bi bi-person-circle text-blue-500 text-lg sm:text-xl"></i>
                    <span class="font-medium text-gray-700 text-sm sm:text-base">View Profile</span>
                </a>
                <div class="h-px bg-gray-200 my-1 sm:my-2"></div>
                <div onclick="handleLogout()" class="flex items-center gap-3 px-3 sm:px-4 py-2.5 sm:py-3 rounded-lg hover:bg-red-50 transition-colors cursor-pointer text-red-500">
                    <i class="bi bi-box-arrow-right text-lg sm:text-xl"></i>
                    <span class="font-medium text-sm sm:text-base">Logout</span>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Hamburger Menu Button -->
    <div class="hamburger" id="hamburger">
        <span></span>
        <span></span>
        <span></span>
    </div>
</div>
         </nav>
       <!-- Mobile Drawer Overlay -->
<div class="drawer-overlay" id="drawerOverlay"></div>

<!-- Mobile Drawer -->
<div class="mobile-drawer" id="mobileDrawer">
    <div class="p-6 pt-8">
        <!-- Drawer Header -->
        <div class="flex items-center gap-3 mb-8 pb-6 border-b border-white/20">
            <img src="https://c.animaapp.com/vkhEa8zW/img/screenshot-2025-09-19-2-53-51-pm-removebg-preview-3@2x.png" 
                 alt="UMak Logo" class="h-12 w-auto object-contain">
            <span class="text-2xl font-extrabold font-manrope" style="background: linear-gradient(135deg, #EAD38A 0%, #C5A046 50%, #8B6D2D 100%); -webkit-background-clip: text; background-clip: text; -webkit-text-fill-color: transparent;">
                UMakFIT
            </span>
        </div>

        <!-- Navigation Links - BAGUHIN MO LANG YUNG ACTIVE LINK BASED SA PAGE -->
        <nav class="space-y-2">
            <a href="./studentDashboard.html" class="mobile-nav-link block text-white/80 hover:text-white hover:bg-white/10 font-medium py-3 px-4 rounded-lg transition-all">
                <i class="bi bi-speedometer2 mr-3"></i>Dashboard
            </a>
            <a href="./test.html" class="mobile-nav-link block text-white bg-white/10 font-semibold py-3 px-4 rounded-lg transition-all">
                <i class="bi bi-clipboard-check mr-3"></i>Test
            </a>
            <a href="./studentlesson.html" class="mobile-nav-link block text-white/80 hover:text-white hover:bg-white/10 font-medium py-3 px-4 rounded-lg transition-all">
                <i class="bi bi-book mr-3"></i>Lessons
            </a>
            <a href="./studentgrades.html" class="mobile-nav-link block text-white/80 hover:text-white hover:bg-white/10 font-medium py-3 px-4 rounded-lg transition-all">
                <i class="bi bi-award mr-3"></i>Grades
            </a>
            <a href="./progress.html" class="mobile-nav-link block text-white/80 hover:text-white hover:bg-white/10 font-medium py-3 px-4 rounded-lg transition-all">
                <i class="bi bi-graph-up mr-3"></i>Progress
            </a>
            <a href="./achievements.html" class="mobile-nav-link block text-white/80 hover:text-white hover:bg-white/10 font-medium py-3 px-4 rounded-lg transition-all">
                <i class="bi bi-trophy mr-3"></i>Achievements
            </a>
        </nav>
    </div>
</div>
        <div class="main-content">
            <div class="result-container">
                <!-- Hero Section with Score -->
                <div class="hero-section">
                    <div class="hero-content">
                        <div class="completion-badge">
                            <i class="bi bi-check-circle-fill"></i>
                            <span>Test Completed</span>
                        </div>
                        
                        <div class="score-wrapper">
                            <div class="score-circle">
                                <svg class="score-ring" viewBox="0 0 180 180">
                                    <defs>
                                        <linearGradient id="scoreGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                                            <stop offset="0%" style="stop-color:#10b981;stop-opacity:1" />
                                            <stop offset="100%" style="stop-color:#3b82f6;stop-opacity:1" />
                                        </linearGradient>
                                    </defs>
                                    <circle class="score-ring-bg" cx="90" cy="90" r="80" />
                                    <circle class="score-ring-progress" cx="90" cy="90" r="80" id="scoreProgress" />
                                </svg>
                                <div class="score-content">
                                    <div class="score-number" id="scoreValue">--</div>
                                    <div class="score-label">SCORE</div>
                                </div>
                            </div>
                            
                            <div class="score-details">
                                <h1 class="test-title" id="testName">--</h1>
                                <div id="scoreRating"></div>
                            </div>
                        </div>
                        
                        <div class="stat-badges" id="statBadges">
                        <div class="stat-badge">
                            <div class="stat-badge-label">Result</div>
                            <div class="stat-badge-value" id="testResult">--</div>
                        </div>
                        <div class="stat-badge">
                            <div class="stat-badge-label">Completed</div>
                            <div class="stat-badge-value" id="completedDate">--</div>
                        </div>
                        <!-- Duration badge will be added dynamically if timerValue exists -->
                    </div>
                    </div>
                </div>

                <!-- Content Section -->
                <div class="content-section">
                    <div class="recommendation-section" id="recommendationSection">
                        <div class="recommendation-header">
                            <span class="recommendation-icon">üí°</span>
                            <h3 class="recommendation-title">Personalized Recommendations</h3>
                        </div>
                        <div id="recommendationContent">
                            <div class="loading-recommendation">
                                <div class="loading-spinner"></div>
                                <span>Generating personalized recommendations for you...</span>
                            </div>
                        </div>
                    </div>

                    <div class="action-buttons" id="mainActionButtons">
                        <button onclick="goToTests()" class="btn-action btn-primary">
                            <i class="bi bi-clipboard-check"></i> View All Tests
                        </button>
                        <a href="./progress.html" class="btn-action btn-secondary">
                            <i class="bi bi-graph-up"></i> Track My Progress
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getAuth, onAuthStateChanged, signOut } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';
        import { getFirestore, doc, getDoc, collection, query, where, getDocs } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';

        const firebaseConfig = {
            apiKey: "AIzaSyAgaLunqEf2gs6dSpF_sz1hV5XQ5Wm52jo",
            authDomain: "umakfit-e3b1d.firebaseapp.com",
            projectId: "umakfit-e3b1d",
            storageBucket: "umakfit-e3b1d.appspot.com",
            messagingSenderId: "276569891504",
            appId: "1:276569891504:web:39b1732b519f4d8b785175"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

function calculateScore(testName, result, testTarget = null) {
    const normalized = testName.toLowerCase();
    
    let numericValue = 0;
    
    // Extract numeric value from result
    if (typeof result === 'object' && result !== null) {
        numericValue = result.value || result.result || result.score || result.count || 0;
    } else if (typeof result === 'string') {
        const match = result.match(/(\d+\.?\d*)/);
        if (match) {
            numericValue = parseFloat(match[1]);
        } else {
            numericValue = parseFloat(result) || 0;
        }
    } else {
        numericValue = parseFloat(result) || 0;
    }
    
    console.log(`üéØ Score Calculation: ${testName} | Value: ${numericValue} | Target: ${testTarget}`);
    
    // If no target set, use default scoring
    if (!testTarget || testTarget <= 0) {
        return calculateDefaultScore(normalized, numericValue);
    }
    
    // REPETITION TESTS (push-ups, sit-ups, curl-ups)
    if (normalized.includes('push-up') || normalized.includes('pushup') || 
        normalized.includes('sit-up') || normalized.includes('situp') ||
        normalized.includes('curl-up') || normalized.includes('curl up')) {
        
        // Perfect score if meets or exceeds target
        if (numericValue >= testTarget) return 100;
        
        const percentage = (numericValue / testTarget) * 100;
        if (percentage >= 90) return 95;
        if (percentage >= 80) return 90;
        if (percentage >= 70) return 85;
        if (percentage >= 60) return 80;
        if (percentage >= 50) return 75;
        if (percentage >= 40) return 70;
        return Math.max(50, Math.round(percentage));
    }
    
    // PLANK (seconds)
    if (normalized.includes('plank')) {
        if (numericValue >= testTarget) return 100;
        
        const percentage = (numericValue / testTarget) * 100;
        if (percentage >= 90) return 95;
        if (percentage >= 80) return 90;
        if (percentage >= 70) return 85;
        if (percentage >= 60) return 80;
        if (percentage >= 50) return 75;
        return Math.max(50, Math.round(percentage));
    }
    
    // GRIP STRENGTH (kg)
    if (normalized.includes('grip')) {
        if (numericValue >= testTarget) return 100;
        
        const percentage = (numericValue / testTarget) * 100;
        if (percentage >= 90) return 95;
        if (percentage >= 80) return 90;
        if (percentage >= 70) return 85;
        if (percentage >= 60) return 80;
        if (percentage >= 50) return 75;
        return Math.max(50, Math.round(percentage));
    }
    
    // SIT-AND-REACH (cm)
    if (normalized.includes('sit-and-reach')) {
        if (numericValue >= testTarget) return 100;
        
        const percentage = (numericValue / testTarget) * 100;
        if (percentage >= 90) return 95;
        if (percentage >= 80) return 90;
        if (percentage >= 70) return 85;
        if (percentage >= 60) return 80;
        if (percentage >= 50) return 75;
        return Math.max(50, Math.round(percentage));
    }
    
    // 1-MILE RUN (seconds - LOWER IS BETTER)
    if (normalized.includes('mile') || normalized.includes('run')) {
        // If student time is <= target, perfect score
        if (numericValue <= testTarget) return 100;
        
        const percentage = (testTarget / numericValue) * 100;
        if (percentage >= 90) return 95;
        if (percentage >= 80) return 90;
        if (percentage >= 70) return 85;
        if (percentage >= 60) return 80;
        if (percentage >= 50) return 75;
        return Math.max(50, Math.round(percentage));
    }
    
    // STEP TEST (heart rate - LOWER IS BETTER)
    if (normalized.includes('step test') || normalized.includes('3-minute')) {
        if (numericValue <= testTarget) return 100;
        
        const percentage = (testTarget / numericValue) * 100;
        if (percentage >= 90) return 95;
        if (percentage >= 80) return 90;
        if (percentage >= 70) return 85;
        if (percentage >= 60) return 80;
        if (percentage >= 50) return 75;
        return Math.max(50, Math.round(percentage));
    }
    
    // BMI
    if (normalized.includes('bmi')) {
        const bmi = numericValue;
        if (bmi >= 18.5 && bmi <= 24.9) return 100;
        if (bmi >= 17.0 && bmi < 18.5) return 85;
        if (bmi >= 25.0 && bmi < 27.0) return 85;
        if (bmi >= 16.0 && bmi < 17.0) return 70;
        if (bmi >= 27.0 && bmi < 30.0) return 70;
        return 60;
    }
    
    // SKINFOLD
    if (normalized.includes('skinfold')) {
        const difference = Math.abs(numericValue - testTarget);
        const percentage = Math.abs(1 - difference / testTarget) * 100;
        return Math.max(50, Math.round(percentage));
    }
    
    // Default for other tests
    return calculateDefaultScore(normalized, numericValue);
}

            function calculateDefaultScore(normalized, numericValue) {
                if (normalized.includes('push-up') || normalized.includes('pushup')) {
                    if (numericValue >= 40) return 100;
                    if (numericValue >= 30) return 90;
                    if (numericValue >= 20) return 80;
                    return 70;
                }
                if (normalized.includes('curl-up')) {
                    if (numericValue >= 75) return 100;
                    if (numericValue >= 50) return 90;
                    if (numericValue >= 30) return 80;
                    return 70;
                }
                if (normalized.includes('grip')) {
                    if (numericValue >= 60) return 100;
                    if (numericValue >= 50) return 90;
                    if (numericValue >= 40) return 80;
                    return 70;
                }
                if (normalized.includes('plank')) {
                    if (numericValue >= 120) return 100;
                    if (numericValue >= 90) return 90;
                    if (numericValue >= 60) return 80;
                    return 70;
                }
                if (normalized.includes('sit-and-reach')) {
                    if (numericValue >= 20) return 100;
                    if (numericValue >= 15) return 90;
                    if (numericValue >= 10) return 80;
                    return 70;
                }
                return 75;
            }

        function getRating(score) {
            if (score >= 90) return { text: 'Excellent', class: 'rating-excellent' };
            if (score >= 80) return { text: 'Good', class: 'rating-good' };
            if (score >= 70) return { text: 'Fair', class: 'rating-fair' };
            return { text: 'Needs Improvement', class: 'rating-needs-improvement' };
        }

        async function generateRecommendation(testName, result, score, timerValue) {
            console.log('ü§ñ Calling AI API for personalized recommendation...');
            console.log('Test:', testName, '| Score:', score, '| Result:', result);
            
            try {
                const prompt = `You are a professional fitness coach with expertise in physical fitness assessments. A student just completed a ${testName} test with the following results:
- Result: ${result}
- Score: ${score}/100
- Timer: ${timerValue}

Based on their performance, provide a unique, personalized recommendation (2-3 sentences) that:
1. Specifically acknowledges their ${score >= 80 ? 'strong' : score >= 60 ? 'good' : 'initial'} performance
2. Gives actionable, test-specific advice to improve their score
3. Is encouraging and motivating

Make each recommendation unique and tailored to their exact score and test type. Be conversational and supportive. Do not use markdown or special formatting.`;

                const response = await fetch("https://api.anthropic.com/v1/messages", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                    },
                    body: JSON.stringify({
                        model: "claude-sonnet-4-20250514",
                        max_tokens: 1000,
                        messages: [
                            { role: "user", content: prompt }
                        ],
                    })
                });

                if (!response.ok) {
                    throw new Error(`API Error: ${response.status}`);
                }

                const data = await response.json();
                
                if (data.content && data.content.length > 0) {
                    console.log('‚úÖ AI Recommendation generated successfully!');
                    console.log('Response:', data.content[0].text);
                    return data.content[0].text;
                } else {
                    throw new Error('No recommendation in API response');
                }
            } catch (error) {
                console.error('‚ùå AI API Failed:', error);
                console.log('Showing error message to user...');
                
                return `Your score of ${score}/100 has been recorded successfully. Please check back later for personalized fitness advice, or consult with your instructor for specific guidance on improving your ${testName} performance.`;
            }
        }

        async function loadTestResult() {
            const urlParams = new URLSearchParams(window.location.search);
            const resultId = urlParams.get('resultId');
            const testId = urlParams.get('testId');

            if (!resultId) {
                alert('No result found');
                window.location.href = './test.html';
                return;
            }

            try {
                const resultDoc = await getDoc(doc(db, 'testResults', resultId));
                
                if (resultDoc.exists()) {
                    const data = resultDoc.data();
                    
                    const score = calculateScore(data.testName, data.result, data.testTarget);
                    const rating = getRating(score);
                    
                    // Update score with animation
                    const scoreProgress = document.getElementById('scoreProgress');
                    scoreProgress.style.setProperty('--score', score);
                    
                    document.getElementById('scoreValue').textContent = score;
                    document.getElementById('scoreRating').innerHTML = `<span class="score-rating ${rating.class}"><i class="bi bi-star-fill"></i> ${rating.text}</span>`;
                    document.getElementById('testName').textContent = data.testName;
                    document.getElementById('testResult').textContent = data.result;
                    document.getElementById('completedDate').textContent = new Date(data.submittedAt).toLocaleDateString('en-US', { 
                        month: 'short', 
                        day: 'numeric',
                        year: 'numeric'
                    });

                    // Only show duration if timerValue exists
                    if (data.timerValue) {
                        const statBadges = document.getElementById('statBadges');
                        const durationBadge = document.createElement('div');
                        durationBadge.className = 'stat-badge';
                        durationBadge.innerHTML = `
                            <div class="stat-badge-label">Duration</div>
                            <div class="stat-badge-value">${data.timerValue}</div>
                        `;
                        statBadges.appendChild(durationBadge);
                    }
                    
                    document.getElementById('loadingScreen').style.display = 'none';
                    document.getElementById('mainContent').style.display = 'block';
                    
                    const recommendation = await generateRecommendation(
                        data.testName,
                        data.result,
                        score,
                        data.timerValue
                    );
                    
                    document.getElementById('recommendationContent').innerHTML = `
                        <p class="recommendation-text">${recommendation}</p>
                    `;

                    if (testId && score < 100) {
                        const testDoc = await getDoc(doc(db, 'scheduledTests', testId));
                        
                        if (testDoc.exists()) {
                            const testData = testDoc.data();
                            const attemptsAllowed = testData.attemptsAllowed || 1;
                            
                            const resultsQuery = query(
                                collection(db, 'testResults'),
                                where('testId', '==', testId),
                                where('studentId', '==', data.studentId)
                            );
                            
                            const resultsSnapshot = await getDocs(resultsQuery);
                            const currentAttempts = resultsSnapshot.size;
                            
                            if (currentAttempts < attemptsAllowed) {
                                const retrySection = document.createElement('div');
                                retrySection.style.cssText = `
                                    background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
                                    border-radius: 16px;
                                    padding: 2rem;
                                    margin: 2rem 0;
                                    text-align: center;
                                    border: 3px solid #f59e0b;
                                `;
                                
                                retrySection.innerHTML = `
                                    <h3 style="font-family: 'Inter', Helvetica; font-weight: 700; color: #92400e; font-size: 20px; margin-bottom: 1rem;">
                                        üîÑ Want to Improve Your Score?
                                    </h3>
                                    <p style="font-family: 'Inter', Helvetica; font-weight: 500; color: #78350f; font-size: 15px; margin-bottom: 1.5rem;">
                                        You have used <strong>${currentAttempts}</strong> out of <strong>${attemptsAllowed}</strong> attempts.<br>
                                        You can take this test again to try for a higher score!
                                    </p>
                                    <button onclick="retryTest('${testId}')" 
                                            style="background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); 
                                                   color: white; 
                                                   padding: 12px 32px; 
                                                   border: none; 
                                                   border-radius: 12px; 
                                                   font-family: 'Inter', Helvetica; 
                                                   font-weight: 700; 
                                                   font-size: 15px; 
                                                   cursor: pointer; 
                                                   box-shadow: 0 4px 12px rgba(245, 158, 11, 0.3);
                                                   transition: all 0.3s;">
                                        üéØ Take Attempt ${currentAttempts + 1}/${attemptsAllowed}
                                    </button>
                                `;
                                
                                const actionButtons = document.querySelector('.action-buttons');
                                actionButtons.parentNode.insertBefore(retrySection, actionButtons);
                            }
                        }
                    }
                    
                } else {
                    alert('Result not found');
                    window.location.href = './test.html';
                }
            } catch (error) {
                console.error('Error loading result:', error);
                alert('Error loading result');
                window.location.href = './test.html';
            }
        }

        window.handleLogout = async function() {
            if (confirm('Are you sure you want to logout?')) {
                try {
                    await signOut(auth);
                    window.location.href = '../login/index.html';
                } catch (error) {
                    console.error('Error logging out:', error);
                    alert('Error logging out. Please try again.');
                }
            }
        };

        window.retryTest = function(testId) {
            if (confirm('üîÑ Do you want to take this test again to improve your score?\n\n‚úÖ Click OK to retry the test\n‚ùå Click Cancel to go back to test list')) {
                window.location.href = `./testdetails.html?testId=${testId}`;
            } else {
                window.location.href = './test.html';
            }
        };

        window.goToTests = function() {
            const urlParams = new URLSearchParams(window.location.search);
            const testId = urlParams.get('testId');
            const scoreValue = parseInt(document.getElementById('scoreValue').textContent) || 0;
            
            if (scoreValue === 100) {
                if (confirm('üéâ Congratulations on your perfect score!\n\nClick OK to view other available tests.')) {
                    window.location.href = './test.html';
                }
            } else {
                window.location.href = './test.html';
            }
        };

          let currentUser = null;

        onAuthStateChanged(auth, async (user) => {
            if (user) {
                currentUser = user;
                updateProfileUI();
                await loadTestResult();
            } else {
                window.location.href = '../login/index.html';
            }
        });
        // Hamburger Menu and Drawer functionality
        const hamburger = document.getElementById('hamburger');
        const mobileDrawer = document.getElementById('mobileDrawer');
        const drawerOverlay = document.getElementById('drawerOverlay');
        const mobileNavLinks = document.querySelectorAll('.mobile-nav-link');

        // Toggle drawer
        if (hamburger) {
            hamburger.addEventListener('click', (e) => {
                e.stopPropagation();
                hamburger.classList.toggle('active');
                mobileDrawer.classList.toggle('active');
                drawerOverlay.classList.toggle('active');
                document.body.style.overflow = mobileDrawer.classList.contains('active') ? 'hidden' : '';
            });
        }

        // Close drawer when overlay is clicked
        if (drawerOverlay) {
            drawerOverlay.addEventListener('click', () => {
                hamburger.classList.remove('active');
                mobileDrawer.classList.remove('active');
                drawerOverlay.classList.remove('active');
                document.body.style.overflow = '';
            });
        }

        // Close drawer when nav link is clicked
        mobileNavLinks.forEach(link => {
            link.addEventListener('click', () => {
                hamburger.classList.remove('active');
                mobileDrawer.classList.remove('active');
                drawerOverlay.classList.remove('active');
                document.body.style.overflow = '';
            });
        });

    window.toggleProfileDropdown = function() {
        const isMobile = window.innerWidth < 1024;
        const dropdown = document.getElementById(isMobile ? 'profileDropdownMobile' : 'profileDropdown');
        
        dropdown.classList.toggle('hidden');
        if (!dropdown.classList.contains('hidden')) {
            setTimeout(() => {
                document.addEventListener('click', closeProfileOnClickOutside);
            }, 100);
        } else {
            document.removeEventListener('click', closeProfileOnClickOutside);
        }
    };

    function closeProfileOnClickOutside(event) {
        const isMobile = window.innerWidth < 1024;
        const dropdown = document.getElementById(isMobile ? 'profileDropdownMobile' : 'profileDropdown');
        const profileBtn = document.getElementById('profilePictureBtn');
        const profileBtnMobile = document.getElementById('profilePictureBtnMobile');
        
        if (!dropdown.contains(event.target) && !profileBtn?.contains(event.target) && !profileBtnMobile?.contains(event.target)) {
            dropdown.classList.add('hidden');
            document.removeEventListener('click', closeProfileOnClickOutside);
        }
    }

    function updateProfileUI() {
        if (!currentUser) return;
        
        const photoURL = currentUser.photoURL || 'https://ui-avatars.com/api/?name=' + encodeURIComponent(currentUser.displayName || 'User') + '&background=3b82f6&color=fff&size=128';
        
        const profileBtn = document.getElementById('profilePictureBtn');
        const profileBtnMobile = document.getElementById('profilePictureBtnMobile');
        if (profileBtn) profileBtn.src = photoURL;
        if (profileBtnMobile) profileBtnMobile.src = photoURL;
        
        const dropdownPic = document.getElementById('profileDropdownPicture');
        const dropdownPicMobile = document.getElementById('profileDropdownPictureMobile');
        if (dropdownPic) dropdownPic.src = photoURL;
        if (dropdownPicMobile) dropdownPicMobile.src = photoURL;
        
        const dropdownName = document.getElementById('profileDropdownName');
        const dropdownNameMobile = document.getElementById('profileDropdownNameMobile');
        if (dropdownName) dropdownName.textContent = currentUser.displayName || 'Student';
        if (dropdownNameMobile) dropdownNameMobile.textContent = currentUser.displayName || 'Student';
        
        const dropdownEmail = document.getElementById('profileDropdownEmail');
        const dropdownEmailMobile = document.getElementById('profileDropdownEmailMobile');
        if (dropdownEmail) dropdownEmail.textContent = currentUser.email || '';
        if (dropdownEmailMobile) dropdownEmailMobile.textContent = currentUser.email || '';
    }
    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>