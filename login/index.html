<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UmakFit - Secure Login</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Fonts & Icons -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Manrope:wght@400;600;700;800&family=Montserrat:wght@700;800;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    
    <style>
        * {
            font-family: 'Inter', 'Manrope', sans-serif;
            -webkit-font-smoothing: antialiased;
        }
        
        .font-manrope {
            font-family: 'Manrope', sans-serif;
        }
        
        .font-montserrat {
            font-family: 'Montserrat', sans-serif;
        }
        
        body {
            overflow-x: hidden;
            width: 100vw;
            margin: 0;
            padding: 0;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }
        
        /* Animated background */
        .animated-bg {
            background: linear-gradient(145deg, #0b1e33 0%, #1e3a8a 50%, #2563eb 100%);
            position: relative;
            overflow: hidden;
            flex: 1;
        }
        
        .animated-bg::before {
            content: '';
            position: absolute;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 60%);
            animation: pulse 15s ease infinite;
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); opacity: 0.3; }
            50% { transform: scale(1.2); opacity: 0.1; }
        }
        
        /* Floating shapes */
        .floating-shape {
            position: absolute;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 50%;
            animation: float 20s infinite;
        }
        
        .shape-1 {
            width: 300px;
            height: 300px;
            top: -100px;
            left: -100px;
            background: radial-gradient(circle, rgba(59,130,246,0.2) 0%, transparent 70%);
            animation-delay: -5s;
        }
        
        .shape-2 {
            width: 400px;
            height: 400px;
            bottom: -150px;
            right: -150px;
            background: radial-gradient(circle, rgba(6,182,212,0.2) 0%, transparent 70%);
            animation-delay: -10s;
        }
        
        .shape-3 {
            width: 200px;
            height: 200px;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: radial-gradient(circle, rgba(251,191,36,0.1) 0%, transparent 70%);
            animation-delay: -15s;
        }
        
        @keyframes float {
            0%, 100% { transform: translate(0, 0) scale(1); }
            25% { transform: translate(5%, 5%) scale(1.05); }
            50% { transform: translate(10%, -5%) scale(0.95); }
            75% { transform: translate(-5%, 5%) scale(1.1); }
        }
        
        /* Login card animation */
        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
             .login-card {
            animation: slideUp 0.6s ease-out;
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
        }
        
        /* Google button animation */
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .spinner {
            border: 4px solid #e5e7eb;
            border-top: 4px solid #3b82f6;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
        }
        
        /* Google button custom */
        .google-btn {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
            border-radius: 40px !important;
        }
        
        .google-btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(59, 130, 246, 0.1);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }
        
        .google-btn:hover::before {
            width: 300px;
            height: 300px;
        }
        
        .google-btn:hover {
            border-color: #2563eb;
            background: #f8fafc;
            transform: translateY(-2px);
            box-shadow: 0 10px 25px -5px rgba(59, 130, 246, 0.3);
        }
        
        /* Loading overlay */
           .loading-overlay {
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
        }
        
        /* Error message */
        .error-message {
            animation: shake 0.5s ease;
        }
        
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }
        
        /* Logo glow */
            .logo-glow {
            filter: drop-shadow(0 0 8px rgba(255,255,255,0.3));
            transition: all 0.3s ease;
        }
        
        .logo-glow:hover {
            filter: drop-shadow(0 0 12px rgba(255,255,255,0.5));
            transform: scale(1.05);
        }
        
        
        /* Login card large */
        .login-card-large {
            width: 100%;
            max-width: 650px;
            padding: 3rem 3.5rem;
        }
        
        @media (max-width: 768px) {
            .login-card-large {
                padding: 2.5rem 2rem;
                max-width: 500px;
            }
        }

        /* Mobile Drawer Styles */
        .mobile-drawer {
            position: fixed;
            top: 0;
            right: -100%;
            width: 280px;
            height: 100vh;
            background: linear-gradient(135deg, #0D1B2A 0%, #1A2B3C 50%, #2C4A5E 100%);
            z-index: 55;
            transition: right 0.3s ease;
            box-shadow: -5px 0 15px rgba(0, 0, 0, 0.3);
            overflow-y: auto;
        }

        .mobile-drawer.active {
            right: 0;
        }

        .drawer-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100vh;
            background: rgba(0, 0, 0, 0.5);
            z-index: 50;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }

        .drawer-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .hamburger {
            display: none;
            flex-direction: column;
            gap: 4px;
            cursor: pointer;
            z-index: 60;
        }

        .hamburger span {
            width: 25px;
            height: 3px;
            background: linear-gradient(135deg, #EAD38A 0%, #C5A046 50%, #8B6D2D 100%);
            border-radius: 2px;
            transition: all 0.3s ease;
        }

        .hamburger.active span:nth-child(1) {
            transform: rotate(45deg) translate(5px, 5px);
        }

        .hamburger.active span:nth-child(2) {
            opacity: 0;
        }

        .hamburger.active span:nth-child(3) {
            transform: rotate(-45deg) translate(7px, -6px);
        }

        @media (max-width: 768px) {
            .hamburger {
                display: flex;
            }
            
            .desktop-nav {
                display: none;
            }
        }
    </style>
</head>
<body class="flex flex-col min-h-screen">

    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="loading-overlay fixed inset-0 flex flex-col justify-center items-center z-[1100] hidden">
        <div class="spinner"></div>
        <div class="mt-5 text-blue-900 font-semibold text-lg" id="loadingText">Checking your account status...</div>
    </div>

<header class="shadow-lg fixed w-full top-0 z-50" style="background: linear-gradient(135deg, #0D1B2A 0%, #1A2B3C 50%, #2C4A5E 100%);">
        <nav class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-20">
                <!-- Logo -->
                <div class="flex items-center gap-3">
                    <div class="w-16 h-16 flex items-center justify-center overflow-visible">
                        <img src="UMakfit Logo (2).png" alt="UMakFIT Logo" class="w-20 h-20 object-contain">
                    </div>
                    <span class="text-xl sm:text-2xl md:text-3xl font-extrabold font-montserrat" style="background: linear-gradient(135deg, #EAD38A 0%, #C5A046 50%, #8B6D2D 100%); -webkit-background-clip: text; background-clip: text; -webkit-text-fill-color: transparent;">
                        UMakFIT
                    </span>
                </div>

                <!-- Desktop Navigation -->
                <div class="desktop-nav hidden md:flex items-center gap-8">
                    <a href="./UmakfitLandingpage.html#features" class="text-white/80 hover:text-white font-medium transition-colors">Features</a>
                    <a href="./UmakfitLandingpage.html#benefits" class="text-white/80 hover:text-white font-medium transition-colors">Benefits</a>
                    <a href="./UmakfitAbout.html" class="text-white/80 hover:text-white font-medium transition-colors">About</a>
                     <a href="./UmakfitLandingpage.html#contact" class="text-white/80 hover:text-white font-medium transition-colors">Contact</a>
                </div>

                <!-- Login Button (Desktop) -->
                <a href="./index.html" class="hidden md:block text-blue-900 px-6 py-2.5 rounded-lg font-medium hover:shadow-lg transform hover:-translate-y-0.5 transition-all" style="background: linear-gradient(135deg, #EAD38A 0%, #C5A046 50%, #8B6D2D 100%);">
                    Login to UmakFit
                </a>

                <!-- Hamburger Menu (Mobile) -->
                <div class="hamburger" id="hamburger">
                    <span></span>
                    <span></span>
                    <span></span>
                </div>
            </div>
        </nav>

        <!-- Mobile Drawer Overlay -->
        <div class="drawer-overlay" id="drawerOverlay"></div>

        <!-- Mobile Drawer -->
        <div class="mobile-drawer" id="mobileDrawer">
            <div class="p-6 pt-8">
                <!-- Drawer Header -->
                <div class="flex items-center gap-3 mb-8 pb-6 border-b border-white/20">
                    <div class="w-12 h-12 bg-gradient-to-br from-blue-500 to-blue-900 rounded-xl flex items-center justify-center text-2xl">
                        üèÉ
                    </div>
                    <span class="text-2xl font-extrabold font-montserrat" style="background: linear-gradient(135deg, #EAD38A 0%, #C5A046 50%, #8B6D2D 100%); -webkit-background-clip: text; background-clip: text; -webkit-text-fill-color: transparent;">
                        UMakFIT
                    </span>
                </div>

               <!-- Navigation Links -->
                <nav class="space-y-2 mb-8">
                    <a href="./UmakfitLandingpage.html#features" class="mobile-nav-link block text-white/80 hover:text-white font-medium py-3 px-4 rounded-lg hover:bg-white/10 transition-all">
                        Features
                    </a>
                    <a href="./UmakfitLandingpage.html#benefits" class="mobile-nav-link block text-white/80 hover:text-white font-medium py-3 px-4 rounded-lg hover:bg-white/10 transition-all">
                        Benefits
                    </a>
                    <a href="./UmakfitAbout.html" class="mobile-nav-link block text-white/80 hover:text-white font-medium py-3 px-4 rounded-lg hover:bg-white/10 transition-all">
                        About
                    </a>
                    <a href="./UmakfitLandingpage.html#contact" class="mobile-nav-link block text-white/80 hover:text-white font-medium py-3 px-4 rounded-lg hover:bg-white/10 transition-all">
                        Contact
                    </a>
                </nav>

                <!-- Login Button (Mobile) -->
                <a href="./index.html" class="block w-full text-center text-blue-900 px-6 py-3 rounded-lg font-medium hover:shadow-lg transition-all" style="background: linear-gradient(135deg, #EAD38A 0%, #C5A046 50%, #8B6D2D 100%);">
                    Login to UmakFit
                </a>
            </div>
        </div>
    </header>


    <!-- Main Content - Animated Background (may top padding para di matakpan ng fixed navbar) -->
    <div class="animated-bg flex flex-col flex-1 pt-20">
        
        <!-- Floating Shapes -->
        <div class="floating-shape shape-1"></div>
        <div class="floating-shape shape-2"></div>
        <div class="floating-shape shape-3"></div>
        
        <!-- LOGIN CARD - PINALAKI -->
        <div class="flex-1 flex items-center justify-center px-4 py-16 relative z-20">
            <div class="w-full max-w-[650px]">
                <div class="bg-white/95 backdrop-blur-sm rounded-[50px] p-12 md:p-14 shadow-2xl border border-white/30 login-card login-card-large">
                    
                    
                    <!-- Welcome Text - PINALAKI -->
                    <h1 class="font-bold text-4xl md:text-5xl lg:text-6xl text-gray-900 text-center mb-4">
                        Log in to UMakFit
                    </h1>
                    <p class="font-medium text-base md:text-lg text-gray-600 text-center mb-10 leading-relaxed px-4">
                        Sign in to access your fitness dashboard and track your progress
                    </p>
                    <!-- University Badge - PINALAKI -->
                    <div class="w-fit mx-auto px-8 py-4 rounded-full bg-gradient-to-r from-amber-50 to-yellow-50 flex items-center justify-center gap-4 mb-10 border border-amber-200/80 shadow-md">
                        <span class="font-semibold text-amber-800 text-base tracking-wide">University of Makati</span>
                    </div>

                    <!-- Error Message -->
                    <div id="errorMessage" class="error-message hidden text-red-700 text-sm text-center mb-6 p-4 bg-red-50 rounded-xl border-l-4 border-red-600 font-medium"></div>

                    <!-- Google Sign In Button - PINALAKI -->
                    <button class="google-btn w-full h-16 bg-white border-2 border-gray-200 rounded-full flex items-center justify-center gap-4 mt-4 hover:border-blue-500 transition-all" onclick="handleGoogleSignIn()">
                        <img class="w-6 h-6" src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" alt="Google" />
                        <span class="font-semibold text-gray-700 text-base md:text-lg">Continue with Umak Gmail</span>
                    </button>

                    <!-- Features - PINALAKI DIN -->
                    <div class="flex flex-wrap justify-center gap-8 mt-10 pt-8 border-t border-gray-200">
                        <div class="flex items-center gap-2 text-gray-500 text-sm font-medium">
                            <i class="fas fa-shield-alt text-blue-500 text-base"></i>
                            <span>Secure Login</span>
                        </div>
                        <div class="flex items-center gap-2 text-gray-500 text-sm font-medium">
                            <i class="fas fa-lock text-blue-500 text-base"></i>
                            <span>UMak Email Only</span>
                        </div>
                        <div class="flex items-center gap-2 text-gray-500 text-sm font-medium">
                            <i class="fas fa-bolt text-blue-500 text-base"></i>
                            <span>Instant Access</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Footer -->
<footer class="text-white py-8 sm:py-12" style="background: linear-gradient(135deg, #0D1B2A 0%, #1A2B3C 50%, #2C4A5E 100%);">
    <div class="container mx-auto px-4 sm:px-6 lg:px-8 max-w-7xl">
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8 lg:gap-12 text-center lg:text-left">
            <!-- About UmakFit & College of Human Kinetics -->
            <div>
                <div class="flex items-center justify-center lg:justify-start gap-3 mb-4">
                    <img src="UMakfit Logo (2).png" alt="UMak Logo" class="h-12 w-auto object-contain">
                    <div>
                        <h6 class="font-bold text-lg lg:text-xl mb-1" style="color: #EAD38A;">UMakFit</h6>
                        <p class="text-xs lg:text-sm font-medium" style="color: #C5A046;">College of Human Kinetics</p>
                    </div>
                </div>
                <p class="text-sm lg:text-base leading-relaxed text-white/70">
                    UMakFit is the official fitness assessment and tracking platform of the College of Human Kinetics at University of Makati.
                    Our mission is to promote health, wellness, and physical fitness through comprehensive assessment and personalized tracking.
                </p>
                <div class="mt-4 flex flex-wrap gap-2 justify-center lg:justify-start">
                    <span class="px-3 py-1 rounded-full text-xs font-semibold" style="background: rgba(255,255,255,0.08);">Fitness Tracking</span>
                    <span class="px-3 py-1 rounded-full text-xs font-semibold" style="background: rgba(255,255,255,0.08);">Performance Assessment</span>
                    <span class="px-3 py-1 rounded-full text-xs font-semibold" style="background: rgba(255,255,255,0.08);">Health & Wellness</span>
                </div>
            </div>

            <!-- Quick Links -->
            <div>
                <h6 class="font-bold text-lg lg:text-xl mb-4 lg:mb-6" style="color: #EAD38A;">Quick Links</h6>
                <div class="grid grid-cols-2 gap-4 lg:gap-6">
                    <div class="space-y-3">
                        <a href="./UmakfitLandingpage.html#features" class="block text-white/70 hover:text-white hover:translate-x-1 transition-all duration-200 text-sm lg:text-base">
                            <i class="bi bi-list-check mr-2"></i>Features
                        </a>
                        <a href="./UmakfitLandingpage.html#benefits" class="block text-white/70 hover:text-white hover:translate-x-1 transition-all duration-200 text-sm lg:text-base">
                            <i class="bi bi-star mr-2"></i>Benefits
                        </a>
                        <a href="./UmakfitAbout.html" class="block text-white/70 hover:text-white hover:translate-x-1 transition-all duration-200 text-sm lg:text-base">
                            <i class="bi bi-info-circle mr-2"></i>About
                        </a>
                    </div>
                    <div class="space-y-3">
                        <a href="#" class="block text-white/70 hover:text-white hover:translate-x-1 transition-all duration-200 text-sm lg:text-base">
                            <i class="bi bi-envelope mr-2"></i>Contact
                        </a>
                        <a href="./index.html" class="block text-white/70 hover:text-white hover:translate-x-1 transition-all duration-200 text-sm lg:text-base">
                            <i class="bi bi-person-circle mr-2"></i>Student Login
                        </a>
                        <a href="./index.html" class="block text-white/70 hover:text-white hover:translate-x-1 transition-all duration-200 text-sm lg:text-base">
                            <i class="bi bi-person-badge mr-2"></i>Faculty Login
                        </a>
                    </div>
                </div>
            </div>

            <!-- Contact & Social -->
            <div>
                <h6 class="font-bold text-lg lg:text-xl mb-4 lg:mb-6" style="color: #EAD38A;">Get In Touch</h6>
                <div class="space-y-4 lg:space-y-5">
                    <div class="flex items-start gap-3">
                        <i class="bi bi-geo-alt-fill text-lg lg:text-xl mt-1" style="color: #EAD38A;"></i>
                        <p class="text-sm lg:text-base text-white/70">
                            College of Human Kinetics<br>
                            University of Makati<br>
                            3rd floor, Administration Building, University of Makati,
                            JP Rizal Ext., West Rembo, Taguig City
                        </p>
                    </div>
                    <div class="flex items-center gap-3">
                        <i class="bi bi-envelope-fill text-lg lg:text-xl" style="color: #EAD38A;"></i>
                        <a href="mailto:chk@umak.edu.ph" class="text-white/70 hover:text-white transition-colors text-sm lg:text-base">
                            chk@umak.edu.ph
                        </a>
                    </div>
                    <div class="flex items-center gap-3">
                        <i class="bi bi-telephone-fill text-lg lg:text-xl" style="color: #EAD38A;"></i>
                        <span class="text-white/70 text-sm lg:text-base">+63 933 189 7230</span>
                    </div>
                    <div class="flex items-center gap-4 pt-3 justify-center lg:justify-start">
                        <a href="https://www.facebook.com/profile.php?id=61577064971920" target="_blank" rel="noopener" class="p-2.5 rounded-lg transition-all duration-200 hover:scale-110" style="background: rgba(255,255,255,0.1);">
                            <i class="bi bi-facebook text-white text-lg lg:text-xl"></i>
                        </a>
                        <a href="#" class="p-2.5 rounded-lg transition-all duration-200 hover:scale-110" style="background: rgba(255,255,255,0.1);">
                            <i class="bi bi-twitter text-white text-lg lg:text-xl"></i>
                        </a>
                        <a href="#" class="p-2.5 rounded-lg transition-all duration-200 hover:scale-110" style="background: rgba(255,255,255,0.1);">
                            <i class="bi bi-instagram text-white text-lg lg:text-xl"></i>
                        </a>
                        <a href="#" class="p-2.5 rounded-lg transition-all duration-200 hover:scale-110" style="background: rgba(255,255,255,0.1);">
                            <i class="bi bi-youtube text-white text-lg lg:text-xl"></i>
                        </a>
                    </div>
                </div>
            </div>
        </div>

        <!-- Divider -->
        <div class="mt-8 lg:mt-12 pt-6 lg:pt-8" style="border-top: 1px solid rgba(255,255,255,0.1);">
            <div class="flex flex-col lg:flex-row justify-between items-center gap-4">
                <p class="text-xs lg:text-sm text-white/50 text-center lg:text-left">
                    ¬© 2025 University of Makati - College of Human Kinetics. All Rights Reserved.
                </p>
                <div class="flex flex-wrap justify-center gap-3 lg:gap-4">
                    <a href="https://umak.edu.ph" target="_blank" rel="noopener"class="text-xs lg:text-sm text-white/50 hover:text-white transition-colors">
                        University of Makati
                    </a>
                    <span style="color: rgba(255,255,255,0.3);">‚Ä¢</span>
                    <a href="https://library.umak.edu.ph" target="_blank" rel="noopener" class="text-xs lg:text-sm text-white/50 hover:text-white transition-colors">
                        UMak Online Library
                    </a>
                    <span style="color: rgba(255,255,255,0.3);">‚Ä¢</span>
                    <a href="https://tbl.umak.edu.ph" target="_blank" rel="noopener" class="text-xs lg:text-sm text-white/50 hover:text-white transition-colors">
                        TBL Hub
                    </a>
                </div>
            </div>
        </div>
    </div>
</footer>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.2/js/bootstrap.bundle.min.js"></script>
    
    <script type="module">
        // Firebase imports and config
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getAuth, GoogleAuthProvider, signInWithPopup, signOut } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';
        import { getFirestore, doc, setDoc, getDoc, collection, query, where, getDocs } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';
        import { getDatabase, ref, set, onDisconnect, serverTimestamp, onValue } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js';

        const firebaseConfig = {
            apiKey: "AIzaSyAgaLunqEf2gs6dSpF_sz1hV5XQ5Wm52jo",
            authDomain: "umakfit-e3b1d.firebaseapp.com",
            projectId: "umakfit-e3b1d",
            storageBucket: "umakfit-e3b1d.appspot.com",
            messagingSenderId: "276569891504",
            appId: "1:276569891504:web:39b1732b519f4d8b785175"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const database = getDatabase(app);
        const googleProvider = new GoogleAuthProvider();

        googleProvider.setCustomParameters({
            prompt: 'select_account',
            hd: 'umak.edu.ph'
        });

        window.auth = auth;
        window.db = db;
        window.database = database;
        window.googleProvider = googleProvider;
        window.signInWithPopup = signInWithPopup;
        window.signOut = signOut;
        window.doc = doc;
        window.setDoc = setDoc;
        window.getDoc = getDoc;
        window.collection = collection;
        window.query = query;
        window.where = where;
        window.getDocs = getDocs;
        window.ref = ref;
        window.set = set;
        window.onDisconnect = onDisconnect;
        window.serverTimestamp = serverTimestamp;
        window.onValue = onValue;
    </script>

    <script>
        // Mobile Menu Toggle
        document.addEventListener('DOMContentLoaded', function() {
            // Mobile menu elements
            const hamburger = document.getElementById('hamburger');
            const mobileDrawer = document.getElementById('mobileDrawer');
            const drawerOverlay = document.getElementById('drawerOverlay');
           const mobileNavLinks = document.querySelectorAll('.mobile-drawer a');

            // Toggle mobile drawer
            if (hamburger && mobileDrawer && drawerOverlay) {
                hamburger.addEventListener('click', function(e) {
                    e.stopPropagation();
                    hamburger.classList.toggle('active');
                    mobileDrawer.classList.toggle('active');
                    drawerOverlay.classList.toggle('active');
                    document.body.style.overflow = mobileDrawer.classList.contains('active') ? 'hidden' : '';
                });

                // Close drawer when overlay is clicked
                drawerOverlay.addEventListener('click', function() {
                    hamburger.classList.remove('active');
                    mobileDrawer.classList.remove('active');
                    drawerOverlay.classList.remove('active');
                    document.body.style.overflow = '';
                });

                // Close drawer when any nav link is clicked, then allow navigation
                mobileNavLinks.forEach(link => {
                    link.addEventListener('click', function() {
                        hamburger.classList.remove('active');
                        mobileDrawer.classList.remove('active');
                        drawerOverlay.classList.remove('active');
                        document.body.style.overflow = '';
                        // Navigation proceeds naturally ‚Äî no preventDefault()
                    });
                });
            }

            // LOGO FALLBACK
            const logoImg = document.querySelector('img[alt="UMakFIT Logo"]');
            
            function setupLogoFallback(img) {
                if (!img) return;
                img.onerror = function() {
                    console.log('‚ö†Ô∏è Logo not found, showing text logo');
                    this.style.display = 'none';
                    const wrapper = this.parentElement;
                    if (wrapper) {
                        wrapper.innerHTML = '<span style="color: #fbbf24; font-weight: 800; font-size: 42px; text-shadow: 0 2px 10px rgba(0,0,0,0.2);">U</span>';
                    }
                };
            }
            
            setupLogoFallback(logoImg);

            // Clear session on load
            try {
                if (window.signOut) {
                    window.signOut(window.auth).catch(() => {});
                }
            } catch (e) {}
        });

        // LOADING FUNCTIONS
        function showLoading(message = 'Checking your account status...') {
            const overlay = document.getElementById('loadingOverlay');
            const text = document.getElementById('loadingText');
            if (overlay && text) {
                overlay.classList.remove('hidden');
                overlay.style.display = 'flex';
                text.textContent = message;
            }
        }

        function hideLoading() {
            const overlay = document.getElementById('loadingOverlay');
            if (overlay) {
                overlay.classList.add('hidden');
                overlay.style.display = 'none';
            }
        }

        function showError(message) {
            const errorDiv = document.getElementById('errorMessage');
            if (errorDiv) {
                errorDiv.textContent = message;
                errorDiv.classList.remove('hidden');
                errorDiv.style.display = 'block';
                setTimeout(() => {
                    errorDiv.classList.add('hidden');
                    errorDiv.style.display = 'none';
                }, 5000);
            }
        }

        // AUTH FUNCTIONS
        async function setupUserPresence(user) {
            try {
                let userRole = 'student';
                const userEmail = user.email.toLowerCase();
                try {
                    const emailLookupRef = window.doc(window.db, 'users', userEmail.replace(/\./g, '_'));
                    const emailLookupSnap = await window.getDoc(emailLookupRef);
                    if (emailLookupSnap.exists()) userRole = emailLookupSnap.data().role || 'student';
                } catch (error) {}
                
                const userPresenceRef = window.ref(window.database, `presence/${user.uid}`);
                await window.set(userPresenceRef, {
                    status: 'online',
                    lastActive: window.serverTimestamp(),
                    userId: user.uid,
                    email: user.email,
                    name: user.displayName || user.email.split('@')[0],
                    role: userRole,
                    lastLogin: new Date().toISOString()
                });

                const connectedRef = window.ref(window.database, '.info/connected');
                window.onValue(connectedRef, (snap) => {
                    if (snap.val() === true) {
                        window.onDisconnect(userPresenceRef).remove();
                    }
                });
            } catch (error) {}
        }

        async function updatePresenceRole(userId, role) {
            try {
                const userPresenceRef = window.ref(window.database, `presence/${userId}`);
                await window.set(userPresenceRef, { 
                    status: 'online', 
                    lastActive: window.serverTimestamp(), 
                    userId: userId, 
                    role: role 
                }, { merge: true });
            } catch (error) {}
        }

        async function checkProfessorStatus(user) {
            try {
                const professorRef = window.doc(window.db, 'professors', user.uid);
                const professorSnap = await window.getDoc(professorRef);
                if (professorSnap.exists()) return professorSnap.data();
                
                const professorsQuery = window.query(window.collection(window.db, 'professors'), window.where('email', '==', user.email.toLowerCase()));
                const professorsSnapshot = await window.getDocs(professorsQuery);
                if (!professorsSnapshot.empty) return professorsSnapshot.docs[0].data();
            } catch (error) {}
            return null;
        }

        async function checkAccountStatus(user) {
            try {
                const userEmail = user.email.toLowerCase();
                const emailLookupRef = window.doc(window.db, 'users', userEmail.replace(/\./g, '_'));
                const emailLookupSnap = await window.getDoc(emailLookupRef);
                if (emailLookupSnap.exists() && emailLookupSnap.data().status === 'inactive') return false;
                
                const collections = ['professors', 'secretaries', 'deans'];
                for (const collectionName of collections) {
                    const q = window.query(window.collection(window.db, collectionName), window.where('email', '==', userEmail));
                    const snapshot = await window.getDocs(q);
                    if (!snapshot.empty && snapshot.docs[0].data().status === 'inactive') return false;
                }
                return true;
            } catch (error) {
                return true;
            }
        }

        async function checkSecretaryStatus(user) {
    try {
        // First check secretaries collection by UID
        const secretaryRef = window.doc(window.db, 'secretaries', user.uid);
        const secretarySnap = await window.getDoc(secretaryRef);
        if (secretarySnap.exists()) return secretarySnap.data();
        
        // Then check secretaries collection by email
        const secretariesQuery = window.query(window.collection(window.db, 'secretaries'), window.where('email', '==', user.email.toLowerCase()));
        const secretariesSnapshot = await window.getDocs(secretariesQuery);
        if (!secretariesSnapshot.empty) return secretariesSnapshot.docs[0].data();
        
        // NEW: Check users collection for role = 'secretary'
        const userEmailKey = user.email.toLowerCase().replace(/\./g, '_');
        const userDocRef = window.doc(window.db, 'users', userEmailKey);
        const userDocSnap = await window.getDoc(userDocRef);
        
        if (userDocSnap.exists() && userDocSnap.data().role === 'secretary') {
            return {
                id: user.uid,
                email: user.email.toLowerCase(),
                role: 'secretary',
                ...userDocSnap.data()
            };
        }
        
        // Also check users collection by email field query
        const usersQuery = window.query(
            window.collection(window.db, 'users'), 
            window.where('email', '==', user.email.toLowerCase()),
            window.where('role', '==', 'secretary')
        );
        const usersSnapshot = await window.getDocs(usersQuery);
        if (!usersSnapshot.empty) {
            return usersSnapshot.docs[0].data();
        }
        
    } catch (error) {
        console.log('Error checking secretary status:', error);
    }
    return null;
}

        async function checkDeanStatus(user) {
            try {
                const deanRef = window.doc(window.db, 'deans', user.uid);
                const deanSnap = await window.getDoc(deanRef);
                if (deanSnap.exists()) return deanSnap.data();
                
                const deansQuery = window.query(window.collection(window.db, 'deans'), window.where('email', '==', user.email.toLowerCase()));
                const deansSnapshot = await window.getDocs(deansQuery);
                if (!deansSnapshot.empty) return deansSnapshot.docs[0].data();
            } catch (error) {}
            return null;
        }

        async function checkStudentStatus(user) {
            try {
                const studentsQuery = window.query(window.collection(window.db, 'students'), window.where('email', '==', user.email.toLowerCase()));
                const studentsSnapshot = await window.getDocs(studentsQuery);
                if (!studentsSnapshot.empty) {
                    const studentDoc = studentsSnapshot.docs[0];
                    const studentData = studentDoc.data();
                    return { 
                        id: studentDoc.id, 
                        ...studentData,
                        emailVerified: studentData.emailVerified || false,
                        privacyAccepted: studentData.privacyAccepted || false
                    };
                }
            } catch (error) {}
            return null;
        }

        async function checkUserStatus(user) {
            try {
                const isAccountActive = await checkAccountStatus(user);
                if (!isAccountActive) {
                    await window.signOut(window.auth);
                    hideLoading();
                    showError('Your account has been deactivated. Please contact the administrator.');
                    return;
                }

                const currentTime = new Date().toISOString();
                await setupUserPresence(user);
                
                const deanData = await checkDeanStatus(user);
                if (deanData) {
                    await updatePresenceRole(user.uid, 'dean');
                    showLoading('Welcome back Dean! Redirecting to your dashboard...');
                    setTimeout(() => { window.location.href = '../dean/dean.html'; }, 1000);
                    return;
                }
                
                const secretaryData = await checkSecretaryStatus(user);
                if (secretaryData) {
                    await updatePresenceRole(user.uid, 'secretary');
                    showLoading('Welcome back Secretary! Redirecting to your dashboard...');
                    setTimeout(() => { window.location.href = '../secretary/secretary.html'; }, 1000);
                    return;
                }
                
                const professorData = await checkProfessorStatus(user);
                if (professorData) {
                    await updatePresenceRole(user.uid, 'professor');
                    showLoading('Welcome back Professor! Redirecting to your dashboard...');
                    setTimeout(() => { window.location.href = '../professor/professor.html'; }, 1000);
                    return;
                }
                
                const studentData = await checkStudentStatus(user);
                if (studentData) {
                    await updatePresenceRole(user.uid, 'student');
                    
                    if (studentData.emailVerified && studentData.privacyAccepted) {
                        showLoading('Login successful! Loading your dashboard...');
                        setTimeout(() => { window.location.href = '../student/studentDashboard.html'; }, 1000);
                    } else if (!studentData.emailVerified) {
                        showLoading('Please verify your email...');
                        setTimeout(() => { window.location.href = 'otp-verification.html'; }, 1000);
                    } else if (studentData.emailVerified && !studentData.privacyAccepted) {
                        showLoading('Please accept Data Privacy Agreement...');
                        setTimeout(() => { window.location.href = 'dataprivacy.html'; }, 1000);
                    }
                    return;
                }
                
                showError('Your account is not yet registered in the system. Please contact your college secretary.');
                await window.signOut(window.auth);
                hideLoading();
                
            } catch (error) {
                showError('Error checking account status. Please try again.');
                await window.signOut(window.auth);
                hideLoading();
            }
        }

        async function handleGoogleSignIn() {
            showLoading('Connecting to Google...');

            try {
                try { await window.signOut(window.auth); } catch (e) {}

                window.googleProvider.setCustomParameters({
                    prompt: 'select_account',
                    hd: 'umak.edu.ph'
                });

                const result = await window.signInWithPopup(window.auth, window.googleProvider);
                
                if (!result.user.email.endsWith('@umak.edu.ph')) {
                    await window.signOut(window.auth);
                    hideLoading();
                    showError('Please use your UMak Gmail account (@umak.edu.ph)');
                    return;
                }
                
                await checkUserStatus(result.user);

            } catch (error) {
                hideLoading();
                let errorMessage = 'Failed to sign in with Google';
                if (error.code === 'auth/popup-closed-by-user') {
                    errorMessage = 'Sign in was cancelled. Please try again.';
                } else if (error.code === 'auth/popup-blocked') {
                    errorMessage = 'Popup blocked. Please allow popups for this site.';
                }
                showError(errorMessage);
            }
        }

        window.handleGoogleSignIn = handleGoogleSignIn;
    </script>
</body>
</html>